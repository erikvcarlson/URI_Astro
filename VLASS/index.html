<!DOCTYPE html>
<html class="client-js" lang="en" dir="ltr"><head>
<meta charset="UTF-8">
<title>Reduction of VLA Sky Survey Measurement Sets - CASA Guides</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"YL9iAJfPYOs2uRiPjp6bOQAAAAU","wgCSPNonce":!1,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgTitle":"Reduction of VLA Sky Survey Measurement Sets - CASA Guides","wgCurRevisionId":29799,"wgRevisionId":29799,"wgArticleId":3925,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages using deprecated source tags"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgRelevantArticleId":3925,
"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRedirectedFrom":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial","wgSmjUseCdn":!0,"wgSmjUseChem":!0,"wgSmjDisplayMath":[],"wgSmjExtraInlineMath":[],"wgSmjScale":1,"wgSmjEnableMenu":!0,"wgSmjDisplayAlign":"left","wgInternalRedirectTargetUrl":"/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","mediawiki.toc.styles":"ready","mediawiki.skinning.content.externallinks":"ready","skins.monobook.responsive":"ready"};RLPAGEMODULES=["mediawiki.action.view.redirect","site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","skins.monobook.mobile"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.pygments%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.toc.styles%7Cskins.monobook.responsive&amp;only=styles&amp;skin=monobook">
<script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=monobook"></script>
<!--[if lt IE 9]><link rel="stylesheet" href="/skins/MonoBook/resources/screen-desktop.css?d010f" media="screen"/><![endif]-->
<style>
@media screen and (max-width: 550px) {
	#sidebar .generated-sidebar,#p-search-mobilejs,#p-tb-mobilejs,#p-lang-mobilejs,#t-contributions{display:none}#p-cactions,#p-personal,#p-tb,#p-lang,#sidebar-mobilejs{position:absolute;top:-9999px;left:0}#p-cactions.mobile-menu-active,#p-personal.mobile-menu-active,#p-tb.mobile-menu-active,#p-lang.mobile-menu-active,#sidebar-mobilejs.mobile-menu-active{top:2em;left:0}.mobile-menu-active{position:absolute;z-index:10000;background:#ffffff;border:solid 1px #fabd23;border-left:0;padding:2em 2em 0 1.5em;font-size:125%}.mobile-menu-active *[id^='ca-nstab-'],.mobile-menu-active #ca-talk,.mobile-menu-active #ca-edit{position:absolute;top:-9999px;left:0}.mobile-menu-active ul{padding-top:1em}.mobile-menu-active li{white-space:nowrap}.mobile-menu-active a{display:block;padding:0.65em 0}.mobile-menu-active h3:first-child{margin-right:2em}.mobile-menu-active .pBody{margin-bottom:2em}.mobile-menu-active .mobile-close-button{width:20px;height:20px;background-image:url(/skins/MonoBook/resources/images/icon-close.gif?9a868);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-close.svg?a9af1);background-position:0 0;background-repeat:no-repeat;position:absolute;top:1em;right:0.75em;cursor:pointer}.menus-cover{display:none;top:0;left:0;width:100%;height:100%;z-index:9999}.menus-cover.visible{display:block}#menus-cover{position:fixed;opacity:0.45;background-color:#ffffff}#menus-cover-background{position:absolute;background-color:#f9f9f9;background-image:url(/skins/MonoBook/resources/images/headbg.jpg?78766);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/headbg.svg?0be07);background-position:0 0;background-repeat:no-repeat;opacity:0.55}#p-cactions-mobile li#ca-edit-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-edit.gif?a6fe6);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-edit.svg?badf7)}#p-cactions-mobile li#t-contributions-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-user.gif?d13ac);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-user.svg?9bf49)}}
@media screen {
	body{margin:0}main{display:block}hr{box-sizing:content-box;height:0;overflow:visible}abbr[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title]{border-bottom:0;text-decoration:underline dotted}}pre,code,tt,kbd,samp{font-family:monospace,monospace}sub,sup{line-height:1}img{border:0}button::-moz-focus-inner,[type='button']::-moz-focus-inner,[type='reset']::-moz-focus-inner,[type='submit']::-moz-focus-inner{border-style:none;padding:0}legend{color:inherit;padding:0}   a{text-decoration:none;color:#0645ad;background:none}a:not([href]){cursor:pointer; }a:visited{color:#0b0080}a:active{color:#faa700}a:hover,a:focus{text-decoration:underline}a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.stub{color:#723}a.new,#p-personal a.new{color:#d33} a.mw-selflink{color:inherit;font-weight:bold;text-decoration:inherit}a.mw-selflink:hover{cursor:inherit;text-decoration:inherit}a.mw-selflink:active,a.mw-selflink:visited{color:inherit}a.new:visited,#p-personal a.new:visited{color:#a55858} .mw-parser-output a.extiw,.mw-parser-output a.external{color:#36b}.mw-parser-output a.extiw:visited,.mw-parser-output a.external:visited{color:#636; }.mw-parser-output a.extiw:active,.mw-parser-output a.external:active{color:#b63}.mw-parser-output a.external.free{word-wrap:break-word} img{border:0; vertical-align:middle}hr{height:1px;background-color:#a2a9b1;border:0;margin:0.2em 0} h1,h2,h3,h4,h5,h6{color:#000;margin:0;padding-top:0.5em;padding-bottom:0.17em;overflow:hidden}h1,h2{margin-bottom:0.6em;border-bottom:1px solid #a2a9b1}h3,h4,h5{margin-bottom:0.3em}h1{font-size:188%;font-weight:normal}h2{font-size:150%;font-weight:normal}h3{font-size:128%}h4{font-size:116%}h5{font-size:108%}h6{font-size:100%}p{margin:0.4em 0 0.5em 0}p img{margin:0}ul{margin:0.3em 0 0 1.6em;padding:0}ol{margin:0.3em 0 0 3.2em;padding:0;list-style-image:none}li{margin-bottom:0.1em}dt{font-weight:bold;margin-bottom:0.1em}dl{margin-top:0.2em;margin-bottom:0.5em}dd{margin-left:1.6em;margin-bottom:0.1em} pre,code,tt,kbd,samp,.mw-code{ font-family:monospace,monospace}code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;border-radius:2px;padding:1px 4px}pre,.mw-code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;padding:1em; white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} table{font-size:100%} fieldset{border:1px solid #2a4b8d;margin:1em 0 1em 0;padding:0 1em 1em}legend{padding:0.5em;font-size:95%}form{border:0;margin:0}textarea{width:100%;padding:0.1em;display:block;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box} .center{width:100%;text-align:center}*.center *{margin-left:auto;margin-right:auto} .small{font-size:94%}table.small{font-size:100%}   .toc,.mw-warning,.toccolours{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;font-size:95%} .toc{display:table;padding:7px} table.toc{border-collapse:collapse} table.toc td{padding:0}.toc h2{display:inline;border:0;padding:0;font-size:100%;font-weight:bold}.toc .toctitle{text-align:center}.toc ul{list-style-type:none;list-style-image:none;margin-left:0;padding:0;text-align:left}.toc ul ul{margin:0 0 0 2em} .tocnumber,.toctext{display:table-cell; text-decoration:inherit} .tocnumber{color:#202122;padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0} .mw-warning{margin-left:50px;margin-right:50px;text-align:center}  div.floatright,table.floatright{margin:0 0 0.5em 0.5em} div.floatleft,table.floatleft{margin:0 0.5em 0.5em 0} div.thumb{margin-bottom:0.5em;width:auto;background-color:transparent}div.thumbinner{border:1px solid #c8ccd1;padding:3px;background-color:#f8f9fa;font-size:94%;text-align:center; overflow:hidden}html .thumbimage{background-color:#fff;border:1px solid #c8ccd1}html .thumbcaption{border:0;line-height:1.4em;padding:3px;font-size:94%; text-align:left}.magnify{ float:right;margin-left:3px}.magnify a{display:block; text-indent:15px;white-space:nowrap;overflow:hidden; width:15px;height:11px;  background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e); -moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}img.thumbborder{border:1px solid #eaecf0}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right;margin-left:3px;margin-right:0} .mw-content-ltr .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e)} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left;margin-left:0;margin-right:3px} .mw-content-rtl .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.png?a9fb3);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.svg?38fd5)} div.tright{margin:0.5em 0 1.3em 1.4em} div.tleft{margin:0.5em 1.4em 1.3em 0} body.mw-hide-empty-elt .mw-empty-elt{display:none}   .catlinks{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;margin-top:1em;clear:both}textarea{  border:1px solid #c8ccd1}.editOptions{background-color:#eaecf0;color:#202122;border:1px solid #c8ccd1;border-top:0;padding:1em 1em 1.5em 1em;margin-bottom:2em}.usermessage{background-color:#ffce7b;border:1px solid #ffa500;color:#000;font-weight:bold;margin:2em 0 1em;padding:0.5em 1em;vertical-align:middle}#siteNotice{position:relative;text-align:center;margin:0}#localNotice{margin-bottom:0.9em} #siteSub{display:none}#contentSub,#contentSub2{font-size:84%;line-height:1.2em;margin:0 0 1.4em 1em;color:#54595d;width:auto}span.subpages{display:block} .client-nojs #t-print{display:none; }      .mw-content-ltr{ direction:ltr}.mw-content-rtl{ direction:rtl} .sitedir-ltr textarea,.sitedir-ltr input{ direction:ltr}.sitedir-rtl textarea,.sitedir-rtl input{ direction:rtl}.mw-userlink{word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;unicode-bidi:embed} mark{background-color:#ff0;color:#000}  wbr{display:inline-block}  input[type='submit'],input[type='button'],input[type='reset'],input[type='file']{direction:ltr} textarea[dir='ltr'],input[dir='ltr']{ direction:ltr}textarea[dir='rtl'],input[dir='rtl']{ direction:rtl} abbr[title],.explain[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title],.explain[title]{border-bottom:0;text-decoration:underline dotted}} span.comment{font-style:italic;unicode-bidi:-moz-isolate;unicode-bidi:isolate} #editform,#toolbar,#wpTextbox1{clear:both} #toolbar{height:22px} .mw-underline-always a{text-decoration:underline}.mw-underline-never a{text-decoration:none} li span.deleted,span.history-deleted{text-decoration:line-through;color:#72777d;font-style:italic} .not-patrolled{background-color:#ffa}.unpatrolled{font-weight:bold;color:#d33}div.patrollink{font-size:75%;text-align:right} td.mw-label{text-align:right;vertical-align:middle}td.mw-input{text-align:left}td.mw-submit{text-align:left;white-space:nowrap}.mw-input-with-label{white-space:nowrap;display:inline-block}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left} #catlinks{ text-align:left}.catlinks ul{display:inline;margin:0;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.25em;border-left:1px solid #a2a9b1;margin:0.125em 0;padding:0 0.5em}.catlinks li:first-child{padding-left:0.25em;border-left:0} .catlinks li a.mw-redirect{font-style:italic} .mw-hidden-cats-hidden{display:none}.catlinks-allhidden{display:none} p.mw-protect-editreasons,p.mw-filedelete-editreasons,p.mw-delete-editreasons{font-size:90%;text-align:right} .autocomment,.autocomment a,.autocomment a:visited{color:#72777d} .newpage,.minoredit,.botedit{font-weight:bold} .mw-warning-with-logexcerpt{clear:both}.mw-warning-with-logexcerpt ul li{font-size:90%} span.mw-revdelundel-link,strong.mw-revdelundel-link{font-size:90%}span.mw-revdelundel-hidden,input.mw-revdelundel-hidden{visibility:hidden}td.mw-revdel-checkbox,th.mw-revdel-checkbox{padding-right:10px;text-align:center} a.new{color:#ba0000} .plainlinks a.external{background:none !important; padding:0 !important; }  .rtl a.external.free,.rtl a.external.autonumber{direction:ltr;unicode-bidi:embed} .wikitable{background-color:#f8f9fa;color:#202122;margin:1em 0;border:1px solid #a2a9b1;border-collapse:collapse}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td{border:1px solid #a2a9b1;padding:0.2em 0.4em}.wikitable > tr > th,.wikitable > * > tr > th{background-color:#eaecf0;text-align:center}.wikitable > caption{font-weight:bold} .error,.warning,.success{font-size:larger}.error{color:#d33}.warning{color:#ac6600}.success{color:#14866d} .mw-infobox{border:2px solid #fc3;margin:0.5em;clear:left;overflow:hidden}.mw-infobox-left{margin:7px;float:left;width:35px}.mw-infobox-right{margin:0.5em 0.5em 0.5em 49px} .previewnote{margin-bottom:1em}.visualClear{clear:both} .mw-datatable{border:1px solid #a2a9b1;border-collapse:collapse}.mw-datatable td,.mw-datatable th{border:1px solid #a2a9b1;padding:0.2em 0.4em}.mw-datatable th{background-color:#eaeeff}.mw-datatable td{background-color:#fff}.mw-datatable tr:hover td{background-color:#eaf3ff}.mw-ajax-loader{background-image:url(resources/src/mediawiki.skinning/images/ajax-loader.gif?57f34);background-position:center center;background-repeat:no-repeat;padding:16px;position:relative;top:-16px}.mw-small-spinner{padding:10px !important; margin-right:0.6em;background-image:url(resources/src/mediawiki.skinning/images/spinner.gif?ca65b);background-position:center center;background-repeat:no-repeat} .mw-content-ltr ul,.mw-content-rtl .mw-content-ltr ul{ margin:0.3em 0 0 1.6em;padding:0}.mw-content-rtl ul,.mw-content-ltr .mw-content-rtl ul{ margin:0.3em 1.6em 0 0;padding:0}.mw-content-ltr ol,.mw-content-rtl .mw-content-ltr ol{ margin:0.3em 0 0 3.2em;padding:0}.mw-content-rtl ol,.mw-content-ltr .mw-content-rtl ol{ margin:0.3em 3.2em 0 0;padding:0} .mw-content-ltr dd,.mw-content-rtl .mw-content-ltr dd{margin-left:1.6em;margin-right:0} .mw-content-rtl dd,.mw-content-ltr .mw-content-rtl dd{margin-right:1.6em;margin-left:0}  h1:lang(anp),h1:lang(as),h1:lang(bh),h1:lang(bho),h1:lang(bn),h1:lang(gu),h1:lang(hi),h1:lang(kn),h1:lang(ks),h1:lang(ml),h1:lang(mr),h1:lang(my),h1:lang(mai),h1:lang(ne),h1:lang(new),h1:lang(or),h1:lang(pa),h1:lang(pi),h1:lang(sa),h1:lang(ta),h1:lang(te){line-height:1.6em !important; } h2:lang(anp),h3:lang(anp),h4:lang(anp),h5:lang(anp),h6:lang(anp),h2:lang(as),h3:lang(as),h4:lang(as),h5:lang(as),h6:lang(as),h2:lang(bho),h3:lang(bho),h4:lang(bho),h5:lang(bho),h6:lang(bho),h2:lang(bh),h3:lang(bh),h4:lang(bh),h5:lang(bh),h6:lang(bh),h2:lang(bn),h3:lang(bn),h4:lang(bn),h5:lang(bn),h6:lang(bn),h2:lang(gu),h3:lang(gu),h4:lang(gu),h5:lang(gu),h6:lang(gu),h2:lang(hi),h3:lang(hi),h4:lang(hi),h5:lang(hi),h6:lang(hi),h2:lang(kn),h3:lang(kn),h4:lang(kn),h5:lang(kn),h6:lang(kn),h2:lang(ks),h3:lang(ks),h4:lang(ks),h5:lang(ks),h6:lang(ks),h2:lang(ml),h3:lang(ml),h4:lang(ml),h5:lang(ml),h6:lang(ml),h2:lang(mr),h3:lang(mr),h4:lang(mr),h5:lang(mr),h6:lang(mr),h2:lang(my),h3:lang(my),h4:lang(my),h5:lang(my),h6:lang(my),h2:lang(mai),h3:lang(mai),h4:lang(mai),h5:lang(mai),h6:lang(mai),h2:lang(ne),h3:lang(ne),h4:lang(ne),h5:lang(ne),h6:lang(ne),h2:lang(new),h3:lang(new),h4:lang(new),h5:lang(new),h6:lang(new),h2:lang(or),h3:lang(or),h4:lang(or),h5:lang(or),h6:lang(or),h2:lang(pa),h3:lang(pa),h4:lang(pa),h5:lang(pa),h6:lang(pa),h2:lang(pi),h3:lang(pi),h4:lang(pi),h5:lang(pi),h6:lang(pi),h2:lang(sa),h3:lang(sa),h4:lang(sa),h5:lang(sa),h6:lang(sa),h2:lang(ta),h3:lang(ta),h4:lang(ta),h5:lang(ta),h6:lang(ta),h2:lang(te),h3:lang(te),h4:lang(te),h5:lang(te),h6:lang(te){line-height:1.2em}  ol:lang(azb) li,ol:lang(bcc) li,ol:lang(bgn) li,ol:lang(bqi) li,ol:lang(fa) li,ol:lang(glk) li,ol:lang(kk-arab) li,ol:lang(lrc) li,ol:lang(luz) li,ol:lang(mzn) li{list-style-type:persian}ol:lang(ckb) li,ol:lang(sdh) li{list-style-type:arabic-indic}ol:lang(hi) li,ol:lang(mai) li,ol:lang(mr) li,ol:lang(ne) li{list-style-type:devanagari}ol:lang(as) li,ol:lang(bn) li{list-style-type:bengali}ol:lang(or) li{list-style-type:oriya}.toc ul{margin:0.3em 0}  .mw-content-ltr .toc ul,.mw-content-rtl .mw-content-ltr .toc ul{text-align:left} .mw-content-rtl .toc ul,.mw-content-ltr .mw-content-rtl .toc ul{text-align:right} .mw-content-ltr .toc ul ul,.mw-content-rtl .mw-content-ltr .toc ul ul{margin:0 0 0 2em} .mw-content-rtl .toc ul ul,.mw-content-ltr .mw-content-rtl .toc ul ul{margin:0 2em 0 0}.toc .toctitle{direction:ltr}#mw-clearyourcache,#mw-sitecsspreview,#mw-sitejspreview,#mw-usercsspreview,#mw-userjspreview{direction:ltr;unicode-bidi:embed}#mw-revision-info,#mw-revision-info-current,#mw-revision-nav{direction:ltr}  div.tright,div.floatright,table.floatright{clear:right;float:right} div.tleft,div.floatleft,table.floatleft{float:left;clear:left} #mw-credits a{unicode-bidi:embed} .printfooter{display:none} .xdebug-error{position:absolute;z-index:99}.mw-editsection{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none} .mw-editsection,.mw-editsection-like{font-size:small;font-weight:normal;margin-left:1em;vertical-align:baseline; line-height:1em}  .mw-content-ltr .mw-editsection,.mw-content-rtl .mw-content-ltr .mw-editsection{margin-left:1em} .mw-content-rtl .mw-editsection,.mw-content-ltr .mw-content-rtl .mw-editsection{margin-right:1em} sup,sub{line-height:1}}
.messagebox,.errorbox,.warningbox,.successbox{color:#000;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:16px;border:1px solid;padding:12px 24px;word-wrap:break-word; overflow-wrap:break-word;overflow:hidden} .messagebox :only-child,.errorbox :only-child,.warningbox :only-child,.successbox :only-child{margin:0}.messagebox h2,.errorbox h2,.warningbox h2,.successbox h2{color:inherit;display:inline;margin:0 0.5em 0 0;border:0;font-size:1em;font-weight:bold}.messagebox{background-color:#eaecf0;border-color:#a2a9b1}.errorbox{background-color:#fee7e6;border-color:#d33}.warningbox{background-color:#fef6e7;border-color:#fc3}.successbox{background-color:#d5fdf4;border-color:#14866d}
.mw-wiki-logo{background-image:url(/images/casaguides_merged_logo.png?fe0db)}
@media print {
	.noprint, .catlinks,.magnify,.mw-cite-backlink,.mw-editsection,.mw-editsection-like,.mw-hidden-catlinks,.mw-indicators,.mw-redirectedfrom,.patrollink,.usermessage, #column-one,#footer-places,#mw-navigation,#siteNotice, #f-poweredbyico,#f-copyrightico,li#about,li#disclaimer,li#mobileview,li#privacy{display:none} body{background:#fff;color:#000;margin:0;padding:0} a{background:none !important; padding:0 !important; }a,a.external,a.new,a.stub{color:inherit !important; text-decoration:inherit !important; } .mw-parser-output a.external.text:after,.mw-parser-output a.external.autonumber:after{content:' (' attr(href) ')';word-break:break-all;word-wrap:break-word} .mw-parser-output a.external.text[href^='//']:after,.mw-parser-output a.external.autonumber[href^='//']:after{content:' (https:' attr(href) ')'}dt{font-weight:bold}h1,h2,h3,h4,h5,h6{font-weight:bold; page-break-after:avoid;page-break-before:avoid}p{margin:1em 0;line-height:1.2; orphans:3;widows:3}img,figure,.wikitable,.thumb{ page-break-inside:avoid}img{border:0;vertical-align:middle}pre,.mw-code{background:#fff;color:#000;border:1pt dashed #000;padding:1em;font-size:8pt;white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} sup,sub{line-height:1}ul{list-style-type:square} #globalWrapper{width:100% !important; min-width:0 !important; }.mw-body{background:#fff;color:#000;border:0 !important; padding:0 !important; margin:0 !important; direction:ltr}#column-content{margin:0 !important; }#column-content .mw-body{padding:1em;margin:0 !important; }.toc{background-color:#f9f9f9;border:1pt solid #aaa;padding:5px;display:table} .tocnumber,.toctext{display:table-cell} .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0}  table.floatright,div.floatright,div.tright{float:right;clear:right} table.floatleft,div.floatleft,div.tleft{float:left;clear:left} div.tleft{margin:0.5em 1.4em 1.3em 0} div.tright{margin:0.5em 0 1.3em 1.4em} table.floatright,div.floatright{margin:0 0 0.5em 0.5em;border:0} table.floatleft,div.floatleft{margin:0 0.5em 0.5em 0;border:0}.center{text-align:center} div.thumb{background-color:transparent;width:auto}div.thumb a{border-bottom:0}div.thumbinner{background-color:#fff;border:0;border-radius:2px;padding:5px;font-size:10pt;color:#666;text-align:center; overflow:hidden;min-width:100px}html .thumbcaption{text-align:left;line-height:1.4;padding:3px}img.thumbborder{border:1pt solid #ddd}  .wikitable,.mw_metadata{background:#fff;margin:1em 0;border:1pt solid #aaa;border-collapse:collapse;font-size:10pt}.wikitable > caption,.mw_metadata caption{padding:5px;font-size:10pt}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td,.mw_metadata th,.mw_metadata td{ background:#fff !important;  color:#000 !important; border:1pt solid #aaa;padding:0.4em 0.6em}.wikitable > tr > th,.wikitable > * > tr > th,.mw_metadata th{text-align:center}table.listing,table.listing td{border:1pt solid #000;border-collapse:collapse} .catlinks ul{display:inline;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.15;margin:0.1em 0;border-left:1pt solid #aaa;padding:0 0.4em}.catlinks li:first-child{border-left:0;padding-left:0.2em} .printfooter{padding:1em 0}#footer{background:#fff;color:#000;margin-top:1em;border-top:1pt solid #aaa;padding-top:5px;direction:ltr}}
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=monobook">
<meta name="generator" content="MediaWiki 1.35.2">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="CASA Guides (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://casaguides.nrao.edu/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="CASA Guides Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="canonical" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0">
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 rootpage-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 skin-monobook action-view" data-new-gr-c-s-check-loaded="14.1014.0" data-gr-ext-installed=""><div id="globalWrapper"><div id="column-content"><div id="content" class="mw-body" role="main"><a id="top"></a><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Reduction of VLA Sky Survey Measurement Sets - CASA Guides</h1><div id="bodyContent" class="mw-body-content"><div id="siteSub">From CASA Guides</div><div id="contentSub" lang="en" dir="ltr"><span class="mw-redirectedfrom">(Redirected from <a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial&amp;redirect=no" class="mw-redirect" title="VLA Radio galaxy 3C 129: P-band continuum tutorial">VLA Radio galaxy 3C 129: P-band continuum tutorial</a>)</span></div><div id="jump-to-nav"></div><a href="#column-one" class="mw-jump-link">Jump to navigation</a><a href="#searchInput" class="mw-jump-link">Jump to search</a><!-- start content --><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><br>
</p>
<p><b>This CASA Guide is for Version 5.7.0 of CASA.</b></p><p class="mw-empty-elt"></p> 
<p><b> Note: This guide may take up to 2-days to complete </b></p><p class="mw-empty-elt"></p> 
<p>If you are using a later version of CASA and this is the most recent available guide, then you should be able to use most, if not all, of this casaguide, as we try to limit script breaking changes in CASA development. 
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox" style=""></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Obtaining_the_raw_data"><span class="tocnumber">2</span> <span class="toctext">Obtaining the raw data</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Starting_CASA"><span class="tocnumber">3</span> <span class="toctext">Starting CASA</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Importing_the_raw_data_into_CASA"><span class="tocnumber">4</span> <span class="toctext">Importing the raw data into CASA</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Preliminary_data_inspection"><span class="tocnumber">5</span> <span class="toctext">Preliminary data inspection</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction"><span class="tocnumber">6</span> <span class="toctext">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Initial_data_editing"><span class="tocnumber">6.1</span> <span class="toctext">Initial data editing</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Dead_antennas"><span class="tocnumber">6.2</span> <span class="toctext">Dead antennas</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Hanning_smoothing"><span class="tocnumber">6.3</span> <span class="toctext">Hanning smoothing</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Antenna_Position_Corrections"><span class="tocnumber">6.4</span> <span class="toctext">Antenna Position Corrections</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Ionospheric_TEC_Corrections"><span class="tocnumber">6.5</span> <span class="toctext">Ionospheric TEC Corrections</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Requantizer_Gains"><span class="tocnumber">6.6</span> <span class="toctext">Requantizer Gains</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Automatic_flagging"><span class="tocnumber">7</span> <span class="toctext">Automatic flagging</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Absolute_Flux_Density_Calibration"><span class="tocnumber">8</span> <span class="toctext">Absolute Flux Density Calibration</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Delay_and_bandpass_calibration"><span class="tocnumber">9</span> <span class="toctext">Delay and bandpass calibration</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#Gain_calibration"><span class="tocnumber">10</span> <span class="toctext">Gain calibration</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Transfer_of_calibrations_to_the_target_field"><span class="tocnumber">11</span> <span class="toctext">Transfer of calibrations to the target field</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Statwt"><span class="tocnumber">12</span> <span class="toctext">Statwt</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#Imaging"><span class="tocnumber">13</span> <span class="toctext">Imaging</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Self_Calibration"><span class="tocnumber">14</span> <span class="toctext">Self Calibration</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="#Appendix:_Some_P-band_data_issues_you_may_want_to_know_about"><span class="tocnumber">15</span> <span class="toctext">Appendix: Some P-band data issues you may want to know about</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#Polarization_labeling"><span class="tocnumber">15.1</span> <span class="toctext">Polarization labeling</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Swapped_polarizations"><span class="tocnumber">15.2</span> <span class="toctext">Swapped polarizations</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Double_data_descriptor_entries"><span class="tocnumber">15.3</span> <span class="toctext">Double data descriptor entries</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Continuous_Radio_Frequency_Interference_.28RFI.29"><span class="tocnumber">15.4</span> <span class="toctext">Continuous Radio Frequency Interference (RFI)</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Two_spectral_window_setup"><span class="tocnumber">15.5</span> <span class="toctext">Two spectral window setup</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Bandpass_ripples"><span class="tocnumber">15.6</span> <span class="toctext">Bandpass ripples</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#High_cross-polarization"><span class="tocnumber">15.7</span> <span class="toctext">High cross-polarization</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Instrumental_Polarization_Calibration"><span class="tocnumber">15.8</span> <span class="toctext">Instrumental Polarization Calibration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#Useful_links"><span class="tocnumber">16</span> <span class="toctext">Useful links</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>This webpage provides a basic description on how to use CASA to reduce VLA Sky Survey (VLASS) data from the upper part of the new VLA low-band system, also known as P-band, covering roughly 220-480 MHz. The goal is to make a wide-field continuum stokes I image of a typical blank field using the full effective bandwidth. The dataset that will be downloaded in this guide has a size of 26.46 GB and will require a total of ~140 GB of disk space if all generated files are kept. 
</p><p><i>Note: Starting with CASA 5.0 IPython 5.1.0 is used for interactive CASA sessions. This does not allow to readily paste and execute multiple lines of code like in previous versions of the interpreter. If this is needed at any point in this tutorial, we use "%cpaste" to allow the copy/paste of loops, conditions, etc.. Press "Enter" (or "Return") after "--" at the end, this stops (or exits) the copy/paste prompt and will return you to the CASA prompt.</i>
</p>
<h2><span class="mw-headline" id="Obtaining_the_raw_data">Obtaining the raw data</span></h2>
<p>For this guide, we'll use some test data that was taken in B-configuration. To get a copy of the raw data, download <a rel="nofollow" class="external text" href="https://casa.nrao.edu/Data/EVLA/Pband/P_band_3C129.tgz">P_band_3C129.tgz</a> onto your computer running CASA and untar it (i.e. <i>tar -zxvf &lt;filename&gt;</i>).
</p><p><br>
Alternatively, the raw data can also be obtained from the NRAO archive, go to the <a rel="nofollow" class="external text" href="https://archive.nrao.edu/archive/advquery.jsp">NRAO advance archive query page</a>, and enter the following search parameter in the field <i>Archive File ID</i> (leave the rest on default):
</p>
<div style="text-align:justify;">
<pre style="background-color: #gray;">imag-test-copy.57080.956837025464
</pre>
</div>
<p>The search should return a single row for Archive File: imag-test-copy.57080.956837025464, taken on Feb. 27, 2015 (or "15-Feb-27 22:57:52"). Check the box next to it. Next, fill in your email and select the "SDM-BDF dataset (all files)" option. Note, you may find it easier to download a tar file, in which case, you'll want to check the box for Create MS or SDM tar file. Click "Get My Data" and follow the on-screen prompts to reach the next page, where you should click "Retrieve over internet". The next page should report that the data staging is in progress. Wait until you receive an e-mail reporting that your archive data is copied, which should take a few minutes. Download the data onto your computer running CASA and untar it (i.e. <i>tar -xvf &lt;filename&gt;</i>).
</p>
<h2><span class="mw-headline" id="Starting_CASA">Starting CASA</span></h2>
<p>Start CASA by typing 
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>casa -r <span class="m">5</span>.7.0-134
</pre></div>
<p>on the (linux) command line. This should start a CASA 5.7.0 interactive python (iPython) session, and open a separate log window. The CASA version is reported at startup, both in the python session and the log window.
</p>
<h2><span class="mw-headline" id="Importing_the_raw_data_into_CASA">Importing the raw data into CASA</span></h2>
<p>We will begin by importing our data into the measurement set format (CASA standard) from the binary format (SDM-BDF) as downloaded from the archive. We do this by means of the importasdm task. It is important to note that the importevla task has been deprecated.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">importasdm</span><span class="p">(</span><span class="n">asdm</span><span class="o">=</span><span class="s1">'imag-test-copy.57080.956837025464'</span><span class="p">,</span> <span class="n">vis</span> <span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">savecmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">)</span>
</pre></div>
<p>This task calls the external tool <i>asdm2MS</i> to perform the conversion. Together with the visibility data, also the flag commands from the VLA online system are imported. These flags are not directly applied, but stored in the <i>importflags.txt</i> file and applied later.
</p>
<h2><span class="mw-headline" id="Preliminary_data_inspection">Preliminary data inspection</span></h2>
<p>Inspect the observation set up with the <i>listobs</i> task. The following command will save the output to a file. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">listfile</span> <span class="o">=</span> <span class="s1">'3C129.listobs'</span><span class="p">)</span>
</pre></div>
<p>Alternatively, you can also output to the logger by running the command without the listfile argument. The sample listobs output shown has flag <i>verbose=False</i> for the sake of brevity.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<pre style="background-color: #fffacd;">================================================================================
           MeasurementSet Name:  /lustre/aoc/sciops/fschinze/P_band_tutorial/3C129.ms      MS Version 2
================================================================================
   Observer:      Project: uid://evla/sdm/X2
Observation: EVLA(27 antennas)
Data records: 4714983       Total elapsed time = 1422 seconds
   Observed from   27-Feb-2015/22:57:54.0   to   27-Feb-2015/23:21:36.0 (UTC)

Fields: 2
  ID   Code Name                RA               Decl           Epoch   SrcId      nRows
  0    NONE 3C147               05:42:36.127300 +49.51.07.17800 J2000   0        1307124
  1    NONE 3C129               04:48:58.200000 +45.02.01.00000 J2000   1        3407859
Spectral Windows:  (19 unique spectral windows and 1 unique polarization setups)
  SpwID  Name           #Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs
  0      EVLA_P#A0C0#0     128   TOPO     224.000       125.000     16000.0    231.9375       12  XX  XY  YX  YY
  1      EVLA_P#A0C0#1     128   TOPO     240.000       125.000     16000.0    247.9375       12  XX  XY  YX  YY
  2      EVLA_P#A0C0#2     128   TOPO     256.000       125.000     16000.0    263.9375       12  XX  XY  YX  YY
  3      EVLA_P#A0C0#3     128   TOPO     272.000       125.000     16000.0    279.9375       12  XX  XY  YX  YY
  4      EVLA_P#A0C0#4     128   TOPO     288.000       125.000     16000.0    295.9375       12  XX  XY  YX  YY
  5      EVLA_P#A0C0#5     128   TOPO     304.000       125.000     16000.0    311.9375       12  XX  XY  YX  YY
  6      EVLA_P#A0C0#6     128   TOPO     320.000       125.000     16000.0    327.9375       12  XX  XY  YX  YY
  7      EVLA_P#A0C0#7     128   TOPO     336.000       125.000     16000.0    343.9375       12  XX  XY  YX  YY
  8      EVLA_P#A0C0#8     128   TOPO     352.000       125.000     16000.0    359.9375       12  XX  XY  YX  YY
  9      EVLA_P#A0C0#9     128   TOPO     368.000       125.000     16000.0    375.9375       12  XX  XY  YX  YY
  10     EVLA_P#A0C0#10    128   TOPO     384.000       125.000     16000.0    391.9375       12  XX  XY  YX  YY
  11     EVLA_P#A0C0#11    128   TOPO     400.000       125.000     16000.0    407.9375       12  XX  XY  YX  YY
  12     EVLA_P#A0C0#12    128   TOPO     416.000       125.000     16000.0    423.9375       12  XX  XY  YX  YY
  13     EVLA_P#A0C0#13    128   TOPO     432.000       125.000     16000.0    439.9375       12  XX  XY  YX  YY
  14     EVLA_P#A0C0#14    128   TOPO     448.000       125.000     16000.0    455.9375       12  XX  XY  YX  YY
  15     EVLA_P#A0C0#15    128   TOPO     464.000       125.000     16000.0    471.9375       12  XX  XY  YX  YY
  16     EVLA_P#B0D0#16     64   TOPO     310.000       500.000     32000.0    325.7500       15  XX  XY  YX  YY
  17     EVLA_P#B0D0#17   1024   TOPO     310.000        62.500     64000.0    341.9688       15  XX  XY  YX  YY
  18     EVLA_P#B0D0#18     64   TOPO     342.000       500.000     32000.0    357.7500       15  XX  XY  YX  YY
Antennas: 27 'name'='station'
   ID=   0-3: 'ea01'='N12', 'ea02'='N16', 'ea03'='W28', 'ea05'='E20',
   ID=   4-7: 'ea06'='N20', 'ea07'='N32', 'ea08'='E28', 'ea09'='W08',
   ID=  8-11: 'ea10'='E36', 'ea11'='W12', 'ea12'='N36', 'ea13'='W04',
   ID= 12-15: 'ea14'='E08', 'ea15'='E24', 'ea16'='W24', 'ea17'='E04',
   ID= 16-19: 'ea18'='W36', 'ea19'='MAS', 'ea20'='N04', 'ea21'='E32',
   ID= 20-23: 'ea22'='N24', 'ea23'='E16', 'ea24'='W32', 'ea25'='W20',
   ID= 24-26: 'ea26'='E12', 'ea27'='N08', 'ea28'='N28'
 
</pre>
<p>You can inspect the output text file <i>3C129.listobs</i> in your favorite text editor (e.g., <i>gedit</i>). When taking some time to familiarize yourself with the output format, you will see that:
</p>
<ul><li>The observation consists of 5 scans, namely:</li></ul>
<ol><li>3C147 (hardware setup)</li>
<li>3C147 (setting requantizers)</li>
<li>3C147 (primary calibrator)</li>
<li>3C129 (target)</li>
<li>3C129 (target)</li></ol>
<ul><li>The frequency coverage is 222 - 478 MHz, divided into 16 x 16 MHz spectral windows, each having 128 x 0.125 MHz channels. There are also two spectral windows with 64x0.5 MHz and one spectral window with 1024x0.0625 MHz.</li>
<li>Visibilities are recorded every 2 seconds in full polarization (4 polarization products labelled XX,XY,YX,YY).</li>
<li>Of the 28 VLA antennas labelled ea01 - ea028, antenna ea04 is not participating in this observation.</li>
<li>Source, antenna and spectral window IDs start at zero, but scan IDs start at one.</li></ul>
<p><br>
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_plotants.png" class="image"><img alt="" src="/images/thumb/7/77/3C129_pband_plotants.png/200px-3C129_pband_plotants.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/7/77/3C129_pband_plotants.png/300px-3C129_pband_plotants.png 1.5x, /images/thumb/7/77/3C129_pband_plotants.png/400px-3C129_pband_plotants.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_plotants.png" class="internal" title="Enlarge"></a></div>Figure 1: Plotants() figure showing configuration of the antennas in the array.</div></div></div> 
<p>The array configuration can be inspected using:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotants</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">figfile</span><span class="o">=</span><span class="s1">'3C129_pband_plotants.png'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span id="Initial_processing_steps_-_Hanning_smoothing,_Antenna_Position,_Requantizer_Gain,_Ionospheric_Correction"></span><span class="mw-headline" id="Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></h2>
<h3><span class="mw-headline" id="Initial_data_editing">Initial data editing</span></h3>
<p>When importing the data, we saved the flags from the online system to an ASCII text file. This gives us the opportunity to review the flag commands before applying them. For our data set, the flag file is called <i>importflags.txt</i>. Open this file with your favorite text editor. The bulk of the flag commands refer to times when the VLA is slewing (<i>ANTENNA_NOT_ON_SOURCE</i>) or when the movable secondary reflector of the VLA's Cassegrain system is not in place (<i>SUBREFLECTOR_ERROR</i>). The latter can cause antenna gain variations (amplitude and phase), so it is safest to apply all the flags. In order to remove visibilities that are pure zero, and flag antennas that are partly blocked by other antennas (shadowing), which occurs mostly in compact configurations when observing along a VLA arm, two lines need to be appended to <i>importflags.txt</i>. These are:
</p>
<pre>mode='clip' clipzeros=True
mode='shadow' tolerance=0.0
</pre>
<p>After this, execute in CASA:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'list'</span><span class="p">,</span> <span class="n">inpfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">'any'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>This call, before applying the new flags to the data, created a new flagbackup file called flagdata_1 which can be used by the task <i>flagmanager</i> to restore the state of the measurement set prior applying the flags from <i>importflags.txt</i>.
</p>
<h3><span class="mw-headline" id="Dead_antennas">Dead antennas</span></h3><p>
It is important to identify dead antennas / polarizations early on, so we can exclude them from further data processing. A convenient way of doing this is through the <i>plotms</i> task on bright calibrator(s) (see the <i>listobs()</i> output), in our case 3C147 (see Fig. 2a).</p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="image"><img alt="" src="/images/thumb/6/63/3C129_pband_3C147_prebp.png/200px-3C129_pband_3C147_prebp.png" decoding="async" width="200" height="124" class="thumbimage" srcset="/images/thumb/6/63/3C129_pband_3C147_prebp.png/300px-3C129_pband_3C147_prebp.png 1.5x, /images/thumb/6/63/3C129_pband_3C147_prebp.png/400px-3C129_pband_3C147_prebp.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="internal" title="Enlarge"></a></div>Figure 2a: <i>plotms</i> output before RFI flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> 
           <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span><span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> 
           <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp.png'</span><span class="p">)</span>
</pre></div>
<p>This will load the <i>plotms</i> window that will iterate over all the baselines to antenna ea01. The plot will display the amplitude vs frequency plot with the colors representing the different spectral windows. Note that we are only plotting the XX and YY correlation here. This is because we expect most of the power in the linear cross correlation products to be in these two correlations. Notice that some spectral windows in particular are badly affected due to radio frequency interference (RFI). This is the issue that we will deal with after identifying dead antennas. If you page through the baselines using the green forward button in the <i>plotms</i> viewer, you will notice that the amplitude is particularly low when you encounter ea19. If we create a quick plot of the baselines to ea19 (put <i>ea19</i> in the antenna field), we can see that there is no power in any of the polarizations. This indicates that this antenna was dead and should be flagged. It is also good to check for high power levels in cross-hand correlations in comparison to the parallel-hand correlations, which would uncover swapped polarization labels and severely mis-aligned dipoles. At the end of this tutorial we provide some hints on solving for swapped or mislabeled dipole polarizations. In addition to the dead antenna, we also make sure that the first two scans are flagged, which were not labelled as setup scans but were used to set the attenuators and requantizers udring the observations.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea19'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">scan</span><span class="o">=</span><span class="s1">'1~2'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Hanning_smoothing">Hanning smoothing</span></h3><p>
During the data inspection above, we also notice sharp RFI peaks. Often this is due to Gibbs ringing (Gibbs phenomenon), and to prevent this phenomenon it is best to Hanning smooth the data at this juncture. The default P-band setup contains 16x16 MHz spectral windows. For Hanning smoothing we will select the first 16 spectral windows. This will also make the hanning smoothed dataset smaller and faster to process. Now is a good time to get a cup of coffee while the task is hanning smoothing the data. </p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/200px-Prebp_hanning_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/300px-Prebp_hanning_casa_5.5.0.png 1.5x, /images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/400px-Prebp_hanning_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 2b: <i>plotms</i> output after Hanning smooth and first flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">hanningsmooth</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span><span class="n">spw</span><span class="o">=</span><span class="s1">'0~15'</span><span class="p">)</span>
</pre></div>
<p>Once the task is finished we should replot the primary calibrator to see the effect of hanning smoothing on the data and the RFI (Fig. 2b). 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning.png'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Antenna_Position_Corrections">Antenna Position Corrections</span></h3>
<p>It is always a good idea to check if the antenna position offsets need corrections. Antenna positional errors translate to an error in the measured visibilities and, if present, they need to be accounted for before we proceed with any of the other calibration steps. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'antpos'</span><span class="p">)</span>
</pre></div>
<p>The logger output shows that there are 13 antennas with positional offsets: 
</p>
<pre>
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea03&nbsp;:  0.00290   0.00000   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea08&nbsp;:  0.00000   0.00390   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea10&nbsp;: -0.00170   0.00000   0.00400
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea11&nbsp;:  0.00000   0.00160  -0.00170
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea13&nbsp;:  0.00000   0.00050   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea16&nbsp;: -0.00180   0.00680   0.00230
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea18&nbsp;:  0.00470   0.00350   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea21&nbsp;: -0.00160   0.00000   0.00210
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea23&nbsp;:  0.00140   0.00200  -0.00150
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea24&nbsp;:  0.00380   0.00000  -0.00340
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea25&nbsp;:  0.00330   0.00000  -0.00110
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea26&nbsp;:  0.00000   0.00190   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea27&nbsp;: -0.00120   0.00070   0.00000


</pre>
<h3><span class="mw-headline" id="Ionospheric_TEC_Corrections">Ionospheric TEC Corrections</span></h3>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="image"><img alt="" src="/images/thumb/9/95/Pband_vla_tecu_new.png/200px-Pband_vla_tecu_new.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/9/95/Pband_vla_tecu_new.png/300px-Pband_vla_tecu_new.png 1.5x, /images/thumb/9/95/Pband_vla_tecu_new.png/400px-Pband_vla_tecu_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="internal" title="Enlarge"></a></div>Figure 3: TEC value (in units of TEC/m^2) vs time generated by <i>tec_maps.create()</i></div></div></div> 
<p>Low frequency observations are affected by the ionosphere. A delay in the signal path is introduced between the two polarization of light that varies both as a function of time and line of sight (direction dependent). The delay is proportional to the Total Electron Content (TEC) along the line of sight (TEC), and is inversely proportional to the square of the frequency (1/^2). GPS measurements at two different frequencies provide us with an estimate of the TEC per square meter. This correction has been implemented in CASA which we shall apply as a calibration table with the <i>gencal</i> task. The task requires a TEC map that we will generate with CASA recipes. For more information, see the section on <a rel="nofollow" class="external text" href="https://casa.nrao.edu/casadocs/casa-5.0.0/synthesis-calibration/preparing-for-calibration/#title5">ionospheric corrections</a> in the CASA documentation archives. For some versions of CASA, the first plot to the right (Figure 3) may not be generated if you have already run plotants: to generate this plot, you will need to restart CASA. If the IONEX data file was not downloaded, you might be missing the curl package in the environment you are running CASA in. In such a case you can provide the required file manually by downloading: <a rel="nofollow" class="external free" href="ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z">ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z</a> (for the tutorial it is also also available in an unzipped version <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/igsg0580.15i">here</a>), unziping it, and placing it in the directory from which you started CASA. The current implementation in CASA is in the development stage, however since the CASA 5.0 release both the Faraday rotation correction and dispersive delay corrections for the ionosphere are enabled. In previous releases only Faraday rotation corrections are enabled. In this example we will generate the calibration table and apply it throughout calibration. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">tec_maps</span>
<span class="c1">#</span>
<span class="n">tec_image</span><span class="p">,</span> <span class="n">tec_rms_image</span><span class="p">,</span> <span class="n">plotname</span> <span class="o">=</span> <span class="n">tec_maps</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">doplot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#[NOTE: If you are using CASA 5.0.0, or earlier this should be: tec_image, tec_rms_image = tec_maps.create(vis='3C129_pband.ms', doplot=True)]</span>
<span class="c1">#</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'tecim'</span><span class="p">,</span><span class="n">infile</span><span class="o">=</span><span class="n">tec_image</span><span class="p">)</span>
<span class="c1"># Spatial plots like shown in Figure 4 can be looked at using the CASA viewer for the TEC values</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_TEC.im'</span><span class="p">)</span>
<span class="c1"># and for TEC rms</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_RMS_TEC.im'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_tec_new.png" class="image"><img alt="" src="/images/thumb/d/db/Pband_tec_new.png/200px-Pband_tec_new.png" decoding="async" width="200" height="121" class="thumbimage" srcset="/images/thumb/d/db/Pband_tec_new.png/300px-Pband_tec_new.png 1.5x, /images/thumb/d/db/Pband_tec_new.png/400px-Pband_tec_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_tec_new.png" class="internal" title="Enlarge"></a></div>Figure 4: TEC map movie generated by the TEC tasks.</div></div></div> 
<p>A word of caution regarding the TEC map generation: the IGS website updates measurements only two weeks after the date of observation.
</p>
<h3><span class="mw-headline" id="Requantizer_Gains">Requantizer Gains</span></h3>
<p>The next step will correct the visibility amplitudes for the signal leveling (requantizer gains) that occurs at the inputs of the WIDAR correlator. These levels (per antenna, per polarization, per spectral window) are stored with the measurement set (in the <i>SYSPOWER</i> sub-table). This step is currently not essential, since the levels get set only once at the start of an observation and bandpass calibration will correct for this. But it will make your bandpass plots look better if you have multiple spectral windows. And, more importantly, in general it is possible to trigger the setting of requantizers throughout an observation. This is the case for new observations, when a P-band scan is preceded by a P-band setup scan, which itself is preceded by a scan with a different telescope configuration.  
</p><p>The correction is done by means of the <i>gencal</i> task, where information in the <i>SYSPOWER</i> sub-table gets translated into a gain table. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'rq'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.rq'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Automatic_flagging">Automatic flagging</span></h2>
<p>It is worthwhile noting at this juncture that the standard P-band setup will ensure that the worst of the RFI is restricted to four of the spectral windows. This particular dataset is an example of higher than average levels of RFI across the band. Before throwing away bad spectral windows by hand, we'll let the automated flaggers in CASA have a go at it.  The main task for this is <i>flagdata()</i>. While working on your data, <i>flagdata()</i> produces an abundance of output, not all of which is easy to understand. To help with this, we can get the flag status of our data before and after auto-flagging by running <i>flagdata()</i> in the <i>summary</i> mode. This first call provides the flag statistics of the flagging up to now, before any auto-flagging:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">summary_1</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
</pre></div>
<p>This returns a python dictionary with flagged versus total visibilities along various axes (antenna, scan, spw, field, correlation, etc.). For example, if we want to know the percentage flagged per scan, run the following (note that the scans may not appear in sorted order):
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
</pre></div>
<p>For this example, you will notice that scans 1 and 2 (the dummy scans on 3C147) are 100 percent flagged, which is what we did during the initial flagging.
</p><p>We will run <i>flagdata()</i> in the <i>TFCROP</i> mode, which will (per scan, per baseline, per spectral window, per polarization) look for visibility amplitude outliers. It uses a 5-piece polynomial in an attempt to remove any intrinsic bandpass (amplitude) structure (we did not calibrate for bandpass yet). We run the task twice to allow for slightly deeper flagging and separate treatment of the parallel and cross-hand correlations. For the first run, we tell CASA to make a backup of our visibility flag status up to here, giving us an option to restore them if we choose over-aggresive flagging parameters and consequently over-flag our data. The flag backup file name is reported in the log window, and can be found in the <i>3C129_pband.ms.flagversions</i> directory.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XY,ABS_YX'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XX,ABS_YY'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<p>As a note of caution: When executing flagdata with <i>mode='extend'</i>, all flags that were ever applied to the dataset will get extended. Repeat execution of this command will incrementally flag more and more around already flagged data.
</p><p>Let's get another flag summary to see how much extra data was flagged: 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">summary_2</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1"># </span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning_automatic.png'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/200px-Prbp_tfcropped_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/300px-Prbp_tfcropped_casa_5.5.0.png 1.5x, /images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/400px-Prbp_tfcropped_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5a: <i>plotms</i> output after RFI flagging with tfcrop</div></div></div>
<p>There is quite a bit of RFI that gets missed in RFI-rich spectral windows as can be seen in Fig. 5a. The solution to this is to provide the flagging routines with more contrast between healthy and affected data. For this, we will perform a preliminary bandpass calibration to take out the bandpass shape. We will do some coarse preliminary calibration and apply it to the calibrator before flagging for RFI once more.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'int'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">bandpass</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B0'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span><span class="s1">'3C129_pband.B0'</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
<p>On the command line you should see a notification stating: "FJones (iononsphere) apply now provisionally includes disp. delay." which indicates that both Faraday rotation as well as dispersive delay corrections for the ionosphere are applied.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/200px-Postbandpass_rflag_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/300px-Postbandpass_rflag_casa_5.5.0.png 1.5x, /images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/400px-Postbandpass_rflag_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5b: <i>plotms</i> output after RFI flagging with <i>mode='rflag'</i></div></div></div>
<p>We will now flag the corrected data column that contains the coarsely calibrated visibilities which provide better contrast to the flagging algorithms to remove the RFI present.  We will begin by running the <i>RFLAG</i> algorithm in the task <i>flagdata</i>. We will again use summary mode to see how much more of the observed data was flagged.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">summary_3</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_3</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C147_postbandpass_rflag.png'</span><span class="p">,</span> <span class="n">ydatacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">)</span>
</pre></div>
<p>Taking another visual look at the data using <i>plotms</i>, we examine the effect of the automated flagging on the calibrator (Fig. 5b). We find that most spectral windows are RFI free and that about 37% of the data was flagged. We typically expect between 40-60% of flagging due to interference in a significant fraction of the band. In this example, a more careful RFI flagging approach is likely to recover more usable spectrum.
</p>
<h2><span class="mw-headline" id="Absolute_Flux_Density_Calibration">Absolute Flux Density Calibration</span></h2>
<p>Our flagging has cleaned up most of the stray RFI across the band. This allows us to proceed with the actual calibration of the data. Before we get to the calibration tables, it's essential to do the flux density calibration of our calibrator 3C147. This is done by the <i>setjy</i> task. Before we run the task we first clear the preliminary calibration that was carried out to enable better flagging. We do that by running the <i>clearcal</i> task.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">clearcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">)</span>
</pre></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">setjy</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">standard</span><span class="o">=</span><span class="s1">'Scaife-Heald 2012'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span class="mw-headline" id="Delay_and_bandpass_calibration">Delay and bandpass calibration</span></h2>
<p>First, we use the full bandwidth on a single scan on the primary calibrator to determine a single delay per antenna, per polarization. This will determine a single (approximate) phase slope across frequency, mainly caused by propagation effects in the (time-variable) ionosphere, cable length differences, and electronics in the signal paths from antenna feeds to correlator. Note that for a single short (5-10 minutes) scan on the calibrator, we can get away with solving for a time-invariant delay per antenna, per polarization. We will use scan 3 on 3C147.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/1/1a/Delays_casa_5.5.0.png/200px-Delays_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/1/1a/Delays_casa_5.5.0.png/300px-Delays_casa_5.5.0.png 1.5x, /images/thumb/1/1a/Delays_casa_5.5.0.png/400px-Delays_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 6: Initial per antenna delays derived by <i>gaincal</i>.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span>
   <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">],</span><span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'antenna1'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'delay'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="o">-</span><span class="mf">50.</span><span class="p">,</span><span class="mf">50.</span><span class="p">])</span>
</pre></div>
<p>Since we picked ea09 as our reference antenna, the delays for this antenna ID are arbitrarily set to zero. All other delays should be within 30 nanosec or so (which they should be for this data set; Fig. 6). Larger values, which you can see if you do not force the plotrange, should be treated with suspicion, indicating a problem with the antenna or polarization. We will use the bandpass calibration to verify this in the next step.
</p><p>To determine the bandpass calibration, we use the same source and scan and apply the delay calibration before solving for the bandpass. Note that we request a minimum SNR of 3, which will make the solve fail for the worst, but not all, channels.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>After solving, we inspect the bandpass calibration amplitudes and phase, and flag any obvious residual outliers. Outliers may be found above or below the average bandpass curves, and tend to arise in the same channel (frequency) ranges for all antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Note that the bandpass amplitudes (Fig. 7a) and phases (Fig. 7b) may differ between polarizations of the same antenna. The bandpass phases across frequency should not have an overall gradient (this should be removed by the delay calibration), but they may wrap around from +/-180 to -/+180 degrees. If that is problematic, re-run the phase <i>plotms</i> with <i>plotrange = [ 200.,500.,0.,360. ]</i>. Also note that there are no bandpass solutions for antennas ea19 and ea28, and only a few solutions for ea14.
</p><p>Don't spend more than 1 minute per antenna to find and flag the outliers in this tutorial and don't worry about missing some bad points; these bad channels will likely get flagged in a later stage anyway. We don't set the scale for plotting the bandpass amplitudes, which is convenient when flagging outliers as it will auto-rescale. While plotting the bandpass phases we do fix the scale, as it provides a better feeling for the relevant magnitude of phase outliers. Flagging of outliers is done using the <i>Mark Region</i> and <i>Flag</i> buttons. For more information on interactive flagging, see the topical guide <a rel="nofollow" class="external text" href="http://casaguides.nrao.edu/index.php/VLA_CASA_Flagging">Flagging VLA Data in CASA</a>. We are using this mechanism to efficiently flag data manually, since it is done per antenna rather than per baseline. These 'flags' will not be permanent until we call <i>applycal</i> later on, but are effective while applying the calibration on the fly, as we will do in subsequent calibration steps.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="image"><img alt="" src="/images/thumb/6/67/Initial_bp_amp_casa550.png/200px-Initial_bp_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/6/67/Initial_bp_amp_casa550.png/300px-Initial_bp_amp_casa550.png 1.5x, /images/thumb/6/67/Initial_bp_amp_casa550.png/400px-Initial_bp_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7a: Initial bandpass amplitudes for antenna ea01 after manually flagging the outliers and bad data points (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="image"><img alt="" src="/images/thumb/9/9a/Initial_bp_phase_casa550.png/200px-Initial_bp_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/9/9a/Initial_bp_phase_casa550.png/300px-Initial_bp_phase_casa550.png 1.5x, /images/thumb/9/9a/Initial_bp_phase_casa550.png/400px-Initial_bp_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7b: Initial bandpass phase for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Gain_calibration">Gain calibration</span></h2>
<p>With the delay and bandpass calibration in place, we will now look more closely at the time-variable behavior of the VLA. We use the same scan on our primary calibrator, 3C147, over the full effective bandwidth to determine gain calibrations: one complex value per antenna, per polarization, per integration time. The delay and bandpass tables are applied on the fly.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span> <span class="o">=</span> <span class="s1">'int'</span><span class="p">,</span>
             <span class="n">refant</span> <span class="o">=</span> <span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span> <span class="o">=</span> <span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span> <span class="o">=</span> <span class="s1">'ap'</span><span class="p">,</span>
             <span class="n">gaintable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span> <span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="s1">'3C129_pband.B1'</span> <span class="p">],</span>
             <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span> <span class="p">],</span> <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
</pre></div>
<p>Again, the solutions should be inspected for any outliers. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">],</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Similar to the bandpass flagging, we will flag outlier gain solutions in both amplitude and phase. For the amplitudes, the final scatter around an average close to one should be a few percent (see Fig. 8a,b). Note antennas ea08, ea09 have particularly noisy solutions. Remember that the gain solutions for both polarizations can be flagged together, as we will lose the equivalent data of the surviving polarization anyway.
</p><p>Note that when plotting gains against time, it is convenient to use auto-scaling of the time axis by putting <i>None</i> in the first two fields of <i>plotrange</i>.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_amp_casa550.png" class="image"><img alt="" src="/images/thumb/5/5d/Gain_amp_casa550.png/200px-Gain_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/5/5d/Gain_amp_casa550.png/300px-Gain_amp_casa550.png 1.5x, /images/thumb/5/5d/Gain_amp_casa550.png/400px-Gain_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8a: Initial gain amplitude solutions for antenna ea01 after manually flagging the outlier solutions (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_phase_casa550.png" class="image"><img alt="" src="/images/thumb/3/3e/Gain_phase_casa550.png/200px-Gain_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/3/3e/Gain_phase_casa550.png/300px-Gain_phase_casa550.png 1.5x, /images/thumb/3/3e/Gain_phase_casa550.png/400px-Gain_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8b: Initial gain phase solutions for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<p><br>
Next, we will prepare a smoothed and interpolated version of the gain calibration table, which will be applied later to the target field data. This prevents flagging of target field data when one of the edges of a calibrator scan is flagged for one or more antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">smoothcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">tablein</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">smoothtype</span><span class="o">=</span><span class="s1">'median'</span><span class="p">,</span> <span class="n">smoothtime</span> <span class="o">=</span> <span class="mf">60.</span><span class="o">*</span><span class="mf">60.</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Transfer_of_calibrations_to_the_target_field">Transfer of calibrations to the target field</span></h2>
<p>So far we have used one scan on the primary calibrator 3C147 to derive various calibration tables. These calibrations will now be applied to all scans of all sources in our measurement set, which includes 3C147 itself and our target field 3C129. As described above, the task <i>applycal()</i> creates a <i>CORRECTED_DATA</i> column in which the calibrated visibilities get stored. This may take a while.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span>
              <span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">],</span>
         <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>Now we split off the calibrated target field data, meaning that the visibilities of source 3C129 get copied from the <i>CORRECTED_DATA</i> column to the <i>DATA</i> column of a new measurement set. This is convenient for further processing. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">split</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">)</span>
</pre></div>
<p>It is also helpful to perform additional flagging for any residual RFI left behind in our target after all our calibration steps have been completed and we begin the imaging of our data.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">)</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Statwt">Statwt</span></h2>
<p>Before we go ahead and image our target field we should try to downweight any remaining residual low level RFI. This is done using the task <i>statwt</i>. The task runs through the data and computes the rms of the data weighting down outliers. This makes a big impact for imaging of a target in the presence of low level residual RFI. For our purposes we will bin the data in a time interval larger than the integration time and run <i>statwt</i> as follows.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">statwt</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timebin</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p>With data weights for outliers being set we will now proceed with the imaging and self-calibration of our data.
</p>
<h2><span class="mw-headline" id="Imaging">Imaging</span></h2>
<p>At this point, we're ready to make a first image of our target field. Imaging in CASA is done by means of the <i>tCLEAN</i> task. The task implements algorithms for wide field imaging, such as W-Projection (Cornwell et al. 2008 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/0807.4161">http://arxiv.org/abs/0807.4161</a>) and Multi Term Multi Frequency Synthesis ( Rau et al. 2011 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/1106.2745">http://arxiv.org/abs/1106.2745</a>) both of which we will utilize to make our initial image. Even though our source of concern, the radio galaxy, lies in the centre of our field. The observations were carried out in B configuration resulting in an effective maximum resolution of approximately 5x5 arcsecs. To effectively model the source spectral index in the sky, we will utilize the MTMFS algorithm and use the W-Projection algorithm to make a wide field image (The full beam at P Band is about 3 degrees in diameter). So, going by these requirements, we can now compute the required cell and image size. Consulting the resolution guide of NRAO science page, we can see that the expected HPBW for B - Configuration, P -Band Observation is 18.5 arcsec. So, we can sample it well by using a 5 arcsec cellsize. Having done that, if we decide to make a wide field image to account for all the point sources we will set the image size parameter to 4860 pixels. To enable the wide-field algorithm, we set the <i>gridder='wproject'</i>: this invokes the W-Projection algorithm, upon which we set the number of W-Projection planes to be 128. We set the deconvolution mode as Multi Term Multi Scale Multi Frequency Synthesis using the <i>deconvolver='mtmfs'</i> parameter along with the number of Taylor terms to be considered during imaging to be 2 and choosing three different scales to model the point source and extended emission in our field well, we do this by setting <i> scales=[0,20,30]</i>. This allows for the source spectral variation to be modeled by a second order polynomial. We launch the interactive tclean process, but only for <i>spw='3~8'</i> to begin with. Note, running the first clean call will take at least ~10 min to process.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_initial_clean'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
<p><br>
The <i>tCLEAN</i> command launches an interactive session after a 100 iterations of clean and produces a wide field map with two sources at the center and a lot of bright sources far out in the field (Fig. 9a). As it is a snapshot image, the bright sources have significant side lobes and so tight clean boxing can help. This can be done in the interactive viewer interface that pops up. If we proceed with interactive clean with subsequent steps to keep boxing out the strong sources that pop up in the image, we finally see the extended emission from the target radio galaxy begin to emerge. Continue boxing and cleaning to ensure that the residuals of the boxed cleaning look noise like (~10000 clean iterations). We now stop the interactive task and look at the final image it produced (Fig. 9b).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_initial_clean.image.tt0'</span><span class="p">)</span>
</pre></div>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="image"><img alt="" src="/images/thumb/8/89/3C129_radio_gal_residual.png/200px-3C129_radio_gal_residual.png" decoding="async" width="200" height="152" class="thumbimage" srcset="/images/thumb/8/89/3C129_radio_gal_residual.png/300px-3C129_radio_gal_residual.png 1.5x, /images/thumb/8/89/3C129_radio_gal_residual.png/400px-3C129_radio_gal_residual.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="internal" title="Enlarge"></a></div>Figure 9a: Resulting residuals of 3C129 after first call of interactive <i>clean</i>.</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="image"><img alt="" src="/images/thumb/6/64/3C129_radio_gal_clean.png/200px-3C129_radio_gal_clean.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/6/64/3C129_radio_gal_clean.png/300px-3C129_radio_gal_clean.png 1.5x, /images/thumb/6/64/3C129_radio_gal_clean.png/400px-3C129_radio_gal_clean.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="internal" title="Enlarge"></a></div>Figure 9b: Resulting image of 3C129 after completing the first <i>clean</i>.</div></div></div>
</td></tr></tbody></table>
<p>The recovered structure at the center of the map should resemble what is shown in Fig. 9b. If the image looks worse then boxing of bright features in the map needs to be done more carefully. Note the image has some sources still showing strong side lobes and imaging artifacts around them. We expected this as we have carried out phase calibration only on our flux calibrator and have just transferred the solutions over to our target field. Since we used the <i>usescratch=True</i>, the MODEL_DATA column in the measurement set now contains the initial image model, which we will self calibrate against to produce a better image. Also in clean, do notice that the spw's utilized are the cleanest spectral windows that are totally RFI free.
</p>
<h2><span class="mw-headline" id="Self_Calibration">Self Calibration</span></h2>
<p>We now proceed to compute gain phase solutions for our target field using the <i>gaincal</i> task as the first step in self-calibration.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> 
           <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span><span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>

<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">],</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">)</span>
</pre></div>
<p>Having applied these gain and bandpass solutions, we will once again image the target measurement set which we now expect to have better gain solutions and consequently a better image. We do this by invoking the <i>tCLEAN</i> command once again.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_clean_sc0'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_clean_sc0.image.tt0'</span><span class="p">)</span>
</pre></div>
<p>On boxing and cleaning, we already notice that the imaging artifacts have reduced significantly. We also see that the target source appears to contain more structure and a greater amount of flux. Further self calibration iterations involving an amplitude &amp; phase gain calibration, and target bandpass calibration, are all possible steps that can be explored. Example on the final improvements the self-calibration can provide is shown in Fig. 10.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:402px;"><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="image"><img alt="" src="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/400px-3C129_radio_gal_cselfcal0.png" decoding="async" width="400" height="160" class="thumbimage" srcset="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/600px-3C129_radio_gal_cselfcal0.png 1.5x, /images/thumb/7/75/3C129_radio_gal_cselfcal0.png/800px-3C129_radio_gal_cselfcal0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="internal" title="Enlarge"></a></div>Figure 10: Resulting image of 3C129 after completing two rounds of self calibration is shown in the right panel, along with the pre-selfcal image on the left.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Appendix:_Some_P-band_data_issues_you_may_want_to_know_about">Appendix: Some P-band data issues you may want to know about</span></h2>
<p>Unfortunately, there are a few known issues with the upgraded VLA P-band observing. Most problems were discovered during the P-band commissioning period and have been fixed for newer data sets, but the archive keeps part of this history alive. Here we will go over some of those issues, and (if possible) provide ways of fixing them.
</p>
<h3><span class="mw-headline" id="Polarization_labeling">Polarization labeling</span></h3>
<p>For a long period, P-band feeds have been labeled as being circular (R and L), while they are linear (X and Y). It is still possible to generate data with incorrect polarization labeling, however for standard observations this should not be the case anymore. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem. This may seem mostly harmless, but does make a difference for polarization calibration. The following (non-standard) task will check and fix this (and another related problem of swapped polarizations):
</p><p>Download <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/casa_vla_lowband.tar.gz">this tarball</a> in your CASA working directory, open a shell there, and type the following commands:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>tar -xzvf casa_vla_lowband.tar.gz

buildmytasks
</pre></div>
<p>Now go back to your CASA session and type:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="nb">execfile</span><span class="p">(</span><span class="s1">'mytasks.py'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">fixlowband</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">)</span>
</pre></div>
<p>Re-run the <i>listobs()</i> task to check if the fix was correctly applied.
</p>
<h3><span class="mw-headline" id="Swapped_polarizations">Swapped polarizations</span></h3>
<p>Throughout the whole history of the new VLA low-band system, even up to this day, there have been mistakes in the cabling of the full signal chain. This results in that some antennas have the X-polarization signal come in as Y and vice versa. The way to notice this in visibility data is that for baselines with one swapped antenna most power will be in the cross-hand correlations (XY and YX) rather than the parallel-hand correlations (XX and YY). Once antennas with this feature are manually identified, a contributed task <i>swappol()</i> is available to fix this problem (see under polarization labeling).
</p>
<h3><span class="mw-headline" id="Double_data_descriptor_entries">Double data descriptor entries</span></h3>
<p>The data description table is part of the measurement set, and provides a link between the recorded visibilities, the spectral window information and the polarization information. For some data sets, the data description table contains two entries for each P-band spectral window, one pointing towards a circular (RL) polarization definition, and one pointing towards a linear (XY) polarization definition. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem.
</p>
<h3><span id="Continuous_Radio_Frequency_Interference_(RFI)"></span><span class="mw-headline" id="Continuous_Radio_Frequency_Interference_.28RFI.29">Continuous Radio Frequency Interference (RFI)</span></h3>
<p>The wide bandwidth of the low-band receiver is (unfortunately) guaranteed to contain significant amounts of RFI. There are a few RFI sources that are active all the time, and are visible in all array configurations. The default P-band observing setup of 16 x 16 MHz tries to capture as much of the continuous RFI in as few spectral windows as possible, allowing for a simple RFI mitigation strategy in which these spectral windows (spws 1,2 and 9,10, but possibly more) can be immediately flagged.
</p>
<h3><span class="mw-headline" id="Two_spectral_window_setup">Two spectral window setup</span></h3>
<p>In the early commissioning period of the VLA upgrade, the default setup for P-band observing was to use 2 spectral windows of 1024 channels each to cover 256 MHz of bandwidth from 230 MHz to 486 MHz. However, it was noticed that strong, narrow-band RFI events were causing data to be lost for the whole spectral window in which they occurred. To make the system more robust against data loss from such events, the frequency range was divided into 16 x 16 MHz, and shifted downwards by 6 MHz to capture ever-present RFI into as few spectral windows as possible. If your data has only two P-band spectral windows, please be aware that a higher data loss due to RFI is possible. There is no way to repair this.
</p>
<h3><span class="mw-headline" id="Bandpass_ripples">Bandpass ripples</span></h3>
<p>Due to signal reflections in cables and within the VLA dish, sinusoidal amplitude and phase modulations are always present in P-band data. This is most easily seen in bandpass calibration plots of amplitude versus frequency. In some cases, mostly due to cable &amp; connector problems, these modulations can be very strong (~up to 50 percent of the average amplitude level). These modulations tend not to vary over the duration of an observation and can therefore be removed through bandpass and polarization calibration. If they are found to be variable (e.g., by inspecting bandpass solutions for separate calibrator scans), the offending antenna / polarization should be flagged.
</p>
<h3><span class="mw-headline" id="High_cross-polarization">High cross-polarization</span></h3>
<p>On each antenna, the P-band feed (dipole) is visually aligned with respect to the primary focus support legs. This is normally done within 5-10 degrees accuracy. On rare occasions the dipole on one antenna has accidentally rotated to much larger angles because the locking bolt on the back of the feed was not completely tightened. The result is a high cross-polarization in the baseline visibilities that include this antenna. If this is the case, it is safest to flag this data, since there is a possibility that the dipole has rotated during the observations.
</p>
<h3><span class="mw-headline" id="Instrumental_Polarization_Calibration">Instrumental Polarization Calibration</span></h3>
<p>While polarization leakage calibration has been highlighted in the past reports, it does not directly impact imaging in Stokes I and hence has been dropped from this casaguide.
</p>
<h2><span class="mw-headline" id="Useful_links">Useful links</span></h2>
<ul><li><a rel="nofollow" class="external text" href="http://www.aoc.nrao.edu/lbr">The EVLA Low-Band Receiver System Status &amp; User Pages</a></li>
<li><a rel="nofollow" class="external text" href="https://science.nrao.edu/facilities/vla/docs/manuals/obsguide/topical-guides/vlofreq">VLA Very Low Frequency Observing</a></li></ul>
<p><br>
</p>
<div style="background-color: #CCFF99;">
<p>Last checked on CASA Version 5.7.0.
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20210607154834
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.764 seconds
Real time usage: 10.267 seconds
Preprocessor visited node count: 321/1000000
Postexpand include size: 83/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 65393/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   12.816      1 Template:Checked_5.7.0
100.00%   12.816      1 -total
-->

<!-- Saved in parser cache with key casaguides_nrao_edu-wiki_:pcache:idhash:3925-0!canonical and timestamp 20210607154824 and revision id 29799
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799">https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799</a>"</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php?title=Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/index.php?title=Category:Pages_using_deprecated_source_tags&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages using deprecated source tags (page does not exist)">Pages using deprecated source tags</a></li></ul></div></div><!-- end content --><div class="visualClear"></div></div></div><div class="visualClear"></div></div><div id="column-one" lang="en" dir="ltr"><h2>Navigation menu</h2><div role="navigation" class="portlet" id="p-cactions" aria-labelledby="p-cactions-label"><h3 id="p-cactions-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li><li id="ca-talk" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [alt-shift-t]" accesskey="t">Discussion</a></li><li id="ca-viewsource"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></li><li id="ca-history"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">History</a></li></ul></div></div><div role="navigation" class="portlet" id="p-cactions-mobile" aria-labelledby="p-cactions-mobile-label"><h3 id="p-cactions-mobile-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main-mobile" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="Page">Page</a></li><li id="ca-talk-mobile" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title=" (page does not exist)">Discussion</a></li><li id="ca-more"><a href="#p-cactions">More</a></li><li id="ca-tools"><a href="#p-tb" title="Tools">Tools</a></li><li id="ca-languages"><a href="#p-lang" title="In other languages">In other languages</a></li></ul></div></div><div role="navigation" class="portlet" id="p-personal" aria-labelledby="p-personal-label"><h3 id="p-personal-label" lang="en" dir="ltr">Personal tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=VLA+Radio+galaxy+3C+129%3A+P-band+continuum+tutorial-CASA5.7.0" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li></ul></div></div><div class="portlet" id="p-logo" role="banner"><a href="/index.php?title=Main_Page" class="mw-wiki-logo" title="Visit the main page"></a></div><div id="sidebar"><div role="navigation" class="portlet generated-sidebar" id="p-" aria-labelledby="p--label"><h3 id="p--label" lang="en" dir="ltr"></h3><div class="pBody"><ul lang="en" dir="ltr"><li id="n-Main-Page"><a href="/index.php?title=Main_Page">Main Page</a></li></ul></div></div><div role="search" class="portlet" id="p-search"><h3 id="p-search-label" lang="en" dir="ltr"><label for="searchInput">Search</label></h3><div class="pBody" id="searchBody"><form action="/index.php" id="searchform"><input type="hidden" value="Special:Search" name="title"><input type="search" name="search" placeholder="Search CASA Guides" title="Search CASA Guides [alt-shift-f]" accesskey="f" id="searchInput"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton">&nbsp; <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"></form></div></div><div role="navigation" class="portlet" id="p-tb" aria-labelledby="p-tb-label"><h3 id="p-tb-label" lang="en" dir="ltr">Tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="t-whatlinkshere"><a href="/index.php?title=Special:WhatLinksHere/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/index.php?title=Special:RecentChangesLinked/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" rel="nofollow" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/index.php?title=Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="javascript:print();" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=info" title="More information about this page">Page information</a></li></ul></div></div></div><a href="#sidebar" title="navigation" class="menu-toggle" id="sidebar-toggle"></a><a href="#p-personal" title="user tools" class="menu-toggle" id="p-personal-toggle"></a><a href="#globalWrapper" title="back to top" class="menu-toggle" id="globalWrapper-toggle"></a></div><!-- end of the left (by default at least) column --><div class="visualClear"></div><div id="footer" class="mw-footer" role="contentinfo" lang="en" dir="ltr"><div id="f-poweredbyico" class="footer-icons"><a href="https://www.mediawiki.org/"><img src="/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></div><ul id="f-list"><li id="lastmod"> This page was last edited on 10 November 2020, at 05:09.</li><li id="privacy"><a href="/index.php?title=CASA_Guides:Privacy_policy" title="CASA Guides:Privacy policy">Privacy policy</a></li><li id="about"><a href="/index.php?title=CASA_Guides:About" title="CASA Guides:About">About CASA Guides</a></li><li id="disclaimer"><a href="/index.php?title=CASA_Guides:General_disclaimer" title="CASA Guides:General disclaimer">Disclaimers</a></li></ul></div></div>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.764","walltime":"10.267","ppvisitednodes":{"value":321,"limit":1000000},"postexpandincludesize":{"value":83,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":65393,"limit":5000000},"timingprofile":["100.00%   12.816      1 Template:Checked_5.7.0","100.00%   12.816      1 -total"]},"cachereport":{"timestamp":"20210607154834","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":168});});</script></body></html>
<head>
<meta charset="UTF-8">
<title>Reduction of VLA Sky Survey Measurement Sets - CASA Guides - CASA Guides</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"YL9iAJfPYOs2uRiPjp6bOQAAAAU","wgCSPNonce":!1,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgTitle":"Reduction of VLA Sky Survey Measurement Sets - CASA Guides","wgCurRevisionId":29799,"wgRevisionId":29799,"wgArticleId":3925,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages using deprecated source tags"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgRelevantArticleId":3925,
"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRedirectedFrom":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial","wgSmjUseCdn":!0,"wgSmjUseChem":!0,"wgSmjDisplayMath":[],"wgSmjExtraInlineMath":[],"wgSmjScale":1,"wgSmjEnableMenu":!0,"wgSmjDisplayAlign":"left","wgInternalRedirectTargetUrl":"/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","mediawiki.toc.styles":"ready","mediawiki.skinning.content.externallinks":"ready","skins.monobook.responsive":"ready"};RLPAGEMODULES=["mediawiki.action.view.redirect","site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","skins.monobook.mobile"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.pygments%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.toc.styles%7Cskins.monobook.responsive&amp;only=styles&amp;skin=monobook">
<script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=monobook"></script>
<!--[if lt IE 9]><link rel="stylesheet" href="/skins/MonoBook/resources/screen-desktop.css?d010f" media="screen"/><![endif]-->
<style>
@media screen and (max-width: 550px) {
	#sidebar .generated-sidebar,#p-search-mobilejs,#p-tb-mobilejs,#p-lang-mobilejs,#t-contributions{display:none}#p-cactions,#p-personal,#p-tb,#p-lang,#sidebar-mobilejs{position:absolute;top:-9999px;left:0}#p-cactions.mobile-menu-active,#p-personal.mobile-menu-active,#p-tb.mobile-menu-active,#p-lang.mobile-menu-active,#sidebar-mobilejs.mobile-menu-active{top:2em;left:0}.mobile-menu-active{position:absolute;z-index:10000;background:#ffffff;border:solid 1px #fabd23;border-left:0;padding:2em 2em 0 1.5em;font-size:125%}.mobile-menu-active *[id^='ca-nstab-'],.mobile-menu-active #ca-talk,.mobile-menu-active #ca-edit{position:absolute;top:-9999px;left:0}.mobile-menu-active ul{padding-top:1em}.mobile-menu-active li{white-space:nowrap}.mobile-menu-active a{display:block;padding:0.65em 0}.mobile-menu-active h3:first-child{margin-right:2em}.mobile-menu-active .pBody{margin-bottom:2em}.mobile-menu-active .mobile-close-button{width:20px;height:20px;background-image:url(/skins/MonoBook/resources/images/icon-close.gif?9a868);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-close.svg?a9af1);background-position:0 0;background-repeat:no-repeat;position:absolute;top:1em;right:0.75em;cursor:pointer}.menus-cover{display:none;top:0;left:0;width:100%;height:100%;z-index:9999}.menus-cover.visible{display:block}#menus-cover{position:fixed;opacity:0.45;background-color:#ffffff}#menus-cover-background{position:absolute;background-color:#f9f9f9;background-image:url(/skins/MonoBook/resources/images/headbg.jpg?78766);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/headbg.svg?0be07);background-position:0 0;background-repeat:no-repeat;opacity:0.55}#p-cactions-mobile li#ca-edit-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-edit.gif?a6fe6);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-edit.svg?badf7)}#p-cactions-mobile li#t-contributions-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-user.gif?d13ac);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-user.svg?9bf49)}}
@media screen {
	body{margin:0}main{display:block}hr{box-sizing:content-box;height:0;overflow:visible}abbr[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title]{border-bottom:0;text-decoration:underline dotted}}pre,code,tt,kbd,samp{font-family:monospace,monospace}sub,sup{line-height:1}img{border:0}button::-moz-focus-inner,[type='button']::-moz-focus-inner,[type='reset']::-moz-focus-inner,[type='submit']::-moz-focus-inner{border-style:none;padding:0}legend{color:inherit;padding:0}   a{text-decoration:none;color:#0645ad;background:none}a:not([href]){cursor:pointer; }a:visited{color:#0b0080}a:active{color:#faa700}a:hover,a:focus{text-decoration:underline}a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.stub{color:#723}a.new,#p-personal a.new{color:#d33} a.mw-selflink{color:inherit;font-weight:bold;text-decoration:inherit}a.mw-selflink:hover{cursor:inherit;text-decoration:inherit}a.mw-selflink:active,a.mw-selflink:visited{color:inherit}a.new:visited,#p-personal a.new:visited{color:#a55858} .mw-parser-output a.extiw,.mw-parser-output a.external{color:#36b}.mw-parser-output a.extiw:visited,.mw-parser-output a.external:visited{color:#636; }.mw-parser-output a.extiw:active,.mw-parser-output a.external:active{color:#b63}.mw-parser-output a.external.free{word-wrap:break-word} img{border:0; vertical-align:middle}hr{height:1px;background-color:#a2a9b1;border:0;margin:0.2em 0} h1,h2,h3,h4,h5,h6{color:#000;margin:0;padding-top:0.5em;padding-bottom:0.17em;overflow:hidden}h1,h2{margin-bottom:0.6em;border-bottom:1px solid #a2a9b1}h3,h4,h5{margin-bottom:0.3em}h1{font-size:188%;font-weight:normal}h2{font-size:150%;font-weight:normal}h3{font-size:128%}h4{font-size:116%}h5{font-size:108%}h6{font-size:100%}p{margin:0.4em 0 0.5em 0}p img{margin:0}ul{margin:0.3em 0 0 1.6em;padding:0}ol{margin:0.3em 0 0 3.2em;padding:0;list-style-image:none}li{margin-bottom:0.1em}dt{font-weight:bold;margin-bottom:0.1em}dl{margin-top:0.2em;margin-bottom:0.5em}dd{margin-left:1.6em;margin-bottom:0.1em} pre,code,tt,kbd,samp,.mw-code{ font-family:monospace,monospace}code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;border-radius:2px;padding:1px 4px}pre,.mw-code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;padding:1em; white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} table{font-size:100%} fieldset{border:1px solid #2a4b8d;margin:1em 0 1em 0;padding:0 1em 1em}legend{padding:0.5em;font-size:95%}form{border:0;margin:0}textarea{width:100%;padding:0.1em;display:block;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box} .center{width:100%;text-align:center}*.center *{margin-left:auto;margin-right:auto} .small{font-size:94%}table.small{font-size:100%}   .toc,.mw-warning,.toccolours{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;font-size:95%} .toc{display:table;padding:7px} table.toc{border-collapse:collapse} table.toc td{padding:0}.toc h2{display:inline;border:0;padding:0;font-size:100%;font-weight:bold}.toc .toctitle{text-align:center}.toc ul{list-style-type:none;list-style-image:none;margin-left:0;padding:0;text-align:left}.toc ul ul{margin:0 0 0 2em} .tocnumber,.toctext{display:table-cell; text-decoration:inherit} .tocnumber{color:#202122;padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0} .mw-warning{margin-left:50px;margin-right:50px;text-align:center}  div.floatright,table.floatright{margin:0 0 0.5em 0.5em} div.floatleft,table.floatleft{margin:0 0.5em 0.5em 0} div.thumb{margin-bottom:0.5em;width:auto;background-color:transparent}div.thumbinner{border:1px solid #c8ccd1;padding:3px;background-color:#f8f9fa;font-size:94%;text-align:center; overflow:hidden}html .thumbimage{background-color:#fff;border:1px solid #c8ccd1}html .thumbcaption{border:0;line-height:1.4em;padding:3px;font-size:94%; text-align:left}.magnify{ float:right;margin-left:3px}.magnify a{display:block; text-indent:15px;white-space:nowrap;overflow:hidden; width:15px;height:11px;  background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e); -moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}img.thumbborder{border:1px solid #eaecf0}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right;margin-left:3px;margin-right:0} .mw-content-ltr .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e)} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left;margin-left:0;margin-right:3px} .mw-content-rtl .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.png?a9fb3);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.svg?38fd5)} div.tright{margin:0.5em 0 1.3em 1.4em} div.tleft{margin:0.5em 1.4em 1.3em 0} body.mw-hide-empty-elt .mw-empty-elt{display:none}   .catlinks{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;margin-top:1em;clear:both}textarea{  border:1px solid #c8ccd1}.editOptions{background-color:#eaecf0;color:#202122;border:1px solid #c8ccd1;border-top:0;padding:1em 1em 1.5em 1em;margin-bottom:2em}.usermessage{background-color:#ffce7b;border:1px solid #ffa500;color:#000;font-weight:bold;margin:2em 0 1em;padding:0.5em 1em;vertical-align:middle}#siteNotice{position:relative;text-align:center;margin:0}#localNotice{margin-bottom:0.9em} #siteSub{display:none}#contentSub,#contentSub2{font-size:84%;line-height:1.2em;margin:0 0 1.4em 1em;color:#54595d;width:auto}span.subpages{display:block} .client-nojs #t-print{display:none; }      .mw-content-ltr{ direction:ltr}.mw-content-rtl{ direction:rtl} .sitedir-ltr textarea,.sitedir-ltr input{ direction:ltr}.sitedir-rtl textarea,.sitedir-rtl input{ direction:rtl}.mw-userlink{word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;unicode-bidi:embed} mark{background-color:#ff0;color:#000}  wbr{display:inline-block}  input[type='submit'],input[type='button'],input[type='reset'],input[type='file']{direction:ltr} textarea[dir='ltr'],input[dir='ltr']{ direction:ltr}textarea[dir='rtl'],input[dir='rtl']{ direction:rtl} abbr[title],.explain[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title],.explain[title]{border-bottom:0;text-decoration:underline dotted}} span.comment{font-style:italic;unicode-bidi:-moz-isolate;unicode-bidi:isolate} #editform,#toolbar,#wpTextbox1{clear:both} #toolbar{height:22px} .mw-underline-always a{text-decoration:underline}.mw-underline-never a{text-decoration:none} li span.deleted,span.history-deleted{text-decoration:line-through;color:#72777d;font-style:italic} .not-patrolled{background-color:#ffa}.unpatrolled{font-weight:bold;color:#d33}div.patrollink{font-size:75%;text-align:right} td.mw-label{text-align:right;vertical-align:middle}td.mw-input{text-align:left}td.mw-submit{text-align:left;white-space:nowrap}.mw-input-with-label{white-space:nowrap;display:inline-block}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left} #catlinks{ text-align:left}.catlinks ul{display:inline;margin:0;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.25em;border-left:1px solid #a2a9b1;margin:0.125em 0;padding:0 0.5em}.catlinks li:first-child{padding-left:0.25em;border-left:0} .catlinks li a.mw-redirect{font-style:italic} .mw-hidden-cats-hidden{display:none}.catlinks-allhidden{display:none} p.mw-protect-editreasons,p.mw-filedelete-editreasons,p.mw-delete-editreasons{font-size:90%;text-align:right} .autocomment,.autocomment a,.autocomment a:visited{color:#72777d} .newpage,.minoredit,.botedit{font-weight:bold} .mw-warning-with-logexcerpt{clear:both}.mw-warning-with-logexcerpt ul li{font-size:90%} span.mw-revdelundel-link,strong.mw-revdelundel-link{font-size:90%}span.mw-revdelundel-hidden,input.mw-revdelundel-hidden{visibility:hidden}td.mw-revdel-checkbox,th.mw-revdel-checkbox{padding-right:10px;text-align:center} a.new{color:#ba0000} .plainlinks a.external{background:none !important; padding:0 !important; }  .rtl a.external.free,.rtl a.external.autonumber{direction:ltr;unicode-bidi:embed} .wikitable{background-color:#f8f9fa;color:#202122;margin:1em 0;border:1px solid #a2a9b1;border-collapse:collapse}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td{border:1px solid #a2a9b1;padding:0.2em 0.4em}.wikitable > tr > th,.wikitable > * > tr > th{background-color:#eaecf0;text-align:center}.wikitable > caption{font-weight:bold} .error,.warning,.success{font-size:larger}.error{color:#d33}.warning{color:#ac6600}.success{color:#14866d} .mw-infobox{border:2px solid #fc3;margin:0.5em;clear:left;overflow:hidden}.mw-infobox-left{margin:7px;float:left;width:35px}.mw-infobox-right{margin:0.5em 0.5em 0.5em 49px} .previewnote{margin-bottom:1em}.visualClear{clear:both} .mw-datatable{border:1px solid #a2a9b1;border-collapse:collapse}.mw-datatable td,.mw-datatable th{border:1px solid #a2a9b1;padding:0.2em 0.4em}.mw-datatable th{background-color:#eaeeff}.mw-datatable td{background-color:#fff}.mw-datatable tr:hover td{background-color:#eaf3ff}.mw-ajax-loader{background-image:url(resources/src/mediawiki.skinning/images/ajax-loader.gif?57f34);background-position:center center;background-repeat:no-repeat;padding:16px;position:relative;top:-16px}.mw-small-spinner{padding:10px !important; margin-right:0.6em;background-image:url(resources/src/mediawiki.skinning/images/spinner.gif?ca65b);background-position:center center;background-repeat:no-repeat} .mw-content-ltr ul,.mw-content-rtl .mw-content-ltr ul{ margin:0.3em 0 0 1.6em;padding:0}.mw-content-rtl ul,.mw-content-ltr .mw-content-rtl ul{ margin:0.3em 1.6em 0 0;padding:0}.mw-content-ltr ol,.mw-content-rtl .mw-content-ltr ol{ margin:0.3em 0 0 3.2em;padding:0}.mw-content-rtl ol,.mw-content-ltr .mw-content-rtl ol{ margin:0.3em 3.2em 0 0;padding:0} .mw-content-ltr dd,.mw-content-rtl .mw-content-ltr dd{margin-left:1.6em;margin-right:0} .mw-content-rtl dd,.mw-content-ltr .mw-content-rtl dd{margin-right:1.6em;margin-left:0}  h1:lang(anp),h1:lang(as),h1:lang(bh),h1:lang(bho),h1:lang(bn),h1:lang(gu),h1:lang(hi),h1:lang(kn),h1:lang(ks),h1:lang(ml),h1:lang(mr),h1:lang(my),h1:lang(mai),h1:lang(ne),h1:lang(new),h1:lang(or),h1:lang(pa),h1:lang(pi),h1:lang(sa),h1:lang(ta),h1:lang(te){line-height:1.6em !important; } h2:lang(anp),h3:lang(anp),h4:lang(anp),h5:lang(anp),h6:lang(anp),h2:lang(as),h3:lang(as),h4:lang(as),h5:lang(as),h6:lang(as),h2:lang(bho),h3:lang(bho),h4:lang(bho),h5:lang(bho),h6:lang(bho),h2:lang(bh),h3:lang(bh),h4:lang(bh),h5:lang(bh),h6:lang(bh),h2:lang(bn),h3:lang(bn),h4:lang(bn),h5:lang(bn),h6:lang(bn),h2:lang(gu),h3:lang(gu),h4:lang(gu),h5:lang(gu),h6:lang(gu),h2:lang(hi),h3:lang(hi),h4:lang(hi),h5:lang(hi),h6:lang(hi),h2:lang(kn),h3:lang(kn),h4:lang(kn),h5:lang(kn),h6:lang(kn),h2:lang(ks),h3:lang(ks),h4:lang(ks),h5:lang(ks),h6:lang(ks),h2:lang(ml),h3:lang(ml),h4:lang(ml),h5:lang(ml),h6:lang(ml),h2:lang(mr),h3:lang(mr),h4:lang(mr),h5:lang(mr),h6:lang(mr),h2:lang(my),h3:lang(my),h4:lang(my),h5:lang(my),h6:lang(my),h2:lang(mai),h3:lang(mai),h4:lang(mai),h5:lang(mai),h6:lang(mai),h2:lang(ne),h3:lang(ne),h4:lang(ne),h5:lang(ne),h6:lang(ne),h2:lang(new),h3:lang(new),h4:lang(new),h5:lang(new),h6:lang(new),h2:lang(or),h3:lang(or),h4:lang(or),h5:lang(or),h6:lang(or),h2:lang(pa),h3:lang(pa),h4:lang(pa),h5:lang(pa),h6:lang(pa),h2:lang(pi),h3:lang(pi),h4:lang(pi),h5:lang(pi),h6:lang(pi),h2:lang(sa),h3:lang(sa),h4:lang(sa),h5:lang(sa),h6:lang(sa),h2:lang(ta),h3:lang(ta),h4:lang(ta),h5:lang(ta),h6:lang(ta),h2:lang(te),h3:lang(te),h4:lang(te),h5:lang(te),h6:lang(te){line-height:1.2em}  ol:lang(azb) li,ol:lang(bcc) li,ol:lang(bgn) li,ol:lang(bqi) li,ol:lang(fa) li,ol:lang(glk) li,ol:lang(kk-arab) li,ol:lang(lrc) li,ol:lang(luz) li,ol:lang(mzn) li{list-style-type:persian}ol:lang(ckb) li,ol:lang(sdh) li{list-style-type:arabic-indic}ol:lang(hi) li,ol:lang(mai) li,ol:lang(mr) li,ol:lang(ne) li{list-style-type:devanagari}ol:lang(as) li,ol:lang(bn) li{list-style-type:bengali}ol:lang(or) li{list-style-type:oriya}.toc ul{margin:0.3em 0}  .mw-content-ltr .toc ul,.mw-content-rtl .mw-content-ltr .toc ul{text-align:left} .mw-content-rtl .toc ul,.mw-content-ltr .mw-content-rtl .toc ul{text-align:right} .mw-content-ltr .toc ul ul,.mw-content-rtl .mw-content-ltr .toc ul ul{margin:0 0 0 2em} .mw-content-rtl .toc ul ul,.mw-content-ltr .mw-content-rtl .toc ul ul{margin:0 2em 0 0}.toc .toctitle{direction:ltr}#mw-clearyourcache,#mw-sitecsspreview,#mw-sitejspreview,#mw-usercsspreview,#mw-userjspreview{direction:ltr;unicode-bidi:embed}#mw-revision-info,#mw-revision-info-current,#mw-revision-nav{direction:ltr}  div.tright,div.floatright,table.floatright{clear:right;float:right} div.tleft,div.floatleft,table.floatleft{float:left;clear:left} #mw-credits a{unicode-bidi:embed} .printfooter{display:none} .xdebug-error{position:absolute;z-index:99}.mw-editsection{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none} .mw-editsection,.mw-editsection-like{font-size:small;font-weight:normal;margin-left:1em;vertical-align:baseline; line-height:1em}  .mw-content-ltr .mw-editsection,.mw-content-rtl .mw-content-ltr .mw-editsection{margin-left:1em} .mw-content-rtl .mw-editsection,.mw-content-ltr .mw-content-rtl .mw-editsection{margin-right:1em} sup,sub{line-height:1}}
.messagebox,.errorbox,.warningbox,.successbox{color:#000;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:16px;border:1px solid;padding:12px 24px;word-wrap:break-word; overflow-wrap:break-word;overflow:hidden} .messagebox :only-child,.errorbox :only-child,.warningbox :only-child,.successbox :only-child{margin:0}.messagebox h2,.errorbox h2,.warningbox h2,.successbox h2{color:inherit;display:inline;margin:0 0.5em 0 0;border:0;font-size:1em;font-weight:bold}.messagebox{background-color:#eaecf0;border-color:#a2a9b1}.errorbox{background-color:#fee7e6;border-color:#d33}.warningbox{background-color:#fef6e7;border-color:#fc3}.successbox{background-color:#d5fdf4;border-color:#14866d}
.mw-wiki-logo{background-image:url(/images/casaguides_merged_logo.png?fe0db)}
@media print {
	.noprint, .catlinks,.magnify,.mw-cite-backlink,.mw-editsection,.mw-editsection-like,.mw-hidden-catlinks,.mw-indicators,.mw-redirectedfrom,.patrollink,.usermessage, #column-one,#footer-places,#mw-navigation,#siteNotice, #f-poweredbyico,#f-copyrightico,li#about,li#disclaimer,li#mobileview,li#privacy{display:none} body{background:#fff;color:#000;margin:0;padding:0} a{background:none !important; padding:0 !important; }a,a.external,a.new,a.stub{color:inherit !important; text-decoration:inherit !important; } .mw-parser-output a.external.text:after,.mw-parser-output a.external.autonumber:after{content:' (' attr(href) ')';word-break:break-all;word-wrap:break-word} .mw-parser-output a.external.text[href^='//']:after,.mw-parser-output a.external.autonumber[href^='//']:after{content:' (https:' attr(href) ')'}dt{font-weight:bold}h1,h2,h3,h4,h5,h6{font-weight:bold; page-break-after:avoid;page-break-before:avoid}p{margin:1em 0;line-height:1.2; orphans:3;widows:3}img,figure,.wikitable,.thumb{ page-break-inside:avoid}img{border:0;vertical-align:middle}pre,.mw-code{background:#fff;color:#000;border:1pt dashed #000;padding:1em;font-size:8pt;white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} sup,sub{line-height:1}ul{list-style-type:square} #globalWrapper{width:100% !important; min-width:0 !important; }.mw-body{background:#fff;color:#000;border:0 !important; padding:0 !important; margin:0 !important; direction:ltr}#column-content{margin:0 !important; }#column-content .mw-body{padding:1em;margin:0 !important; }.toc{background-color:#f9f9f9;border:1pt solid #aaa;padding:5px;display:table} .tocnumber,.toctext{display:table-cell} .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0}  table.floatright,div.floatright,div.tright{float:right;clear:right} table.floatleft,div.floatleft,div.tleft{float:left;clear:left} div.tleft{margin:0.5em 1.4em 1.3em 0} div.tright{margin:0.5em 0 1.3em 1.4em} table.floatright,div.floatright{margin:0 0 0.5em 0.5em;border:0} table.floatleft,div.floatleft{margin:0 0.5em 0.5em 0;border:0}.center{text-align:center} div.thumb{background-color:transparent;width:auto}div.thumb a{border-bottom:0}div.thumbinner{background-color:#fff;border:0;border-radius:2px;padding:5px;font-size:10pt;color:#666;text-align:center; overflow:hidden;min-width:100px}html .thumbcaption{text-align:left;line-height:1.4;padding:3px}img.thumbborder{border:1pt solid #ddd}  .wikitable,.mw_metadata{background:#fff;margin:1em 0;border:1pt solid #aaa;border-collapse:collapse;font-size:10pt}.wikitable > caption,.mw_metadata caption{padding:5px;font-size:10pt}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td,.mw_metadata th,.mw_metadata td{ background:#fff !important;  color:#000 !important; border:1pt solid #aaa;padding:0.4em 0.6em}.wikitable > tr > th,.wikitable > * > tr > th,.mw_metadata th{text-align:center}table.listing,table.listing td{border:1pt solid #000;border-collapse:collapse} .catlinks ul{display:inline;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.15;margin:0.1em 0;border-left:1pt solid #aaa;padding:0 0.4em}.catlinks li:first-child{border-left:0;padding-left:0.2em} .printfooter{padding:1em 0}#footer{background:#fff;color:#000;margin-top:1em;border-top:1pt solid #aaa;padding-top:5px;direction:ltr}}
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=monobook">
<meta name="generator" content="MediaWiki 1.35.2">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="CASA Guides (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://casaguides.nrao.edu/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="CASA Guides Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="canonical" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0">
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 rootpage-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 skin-monobook action-view" data-new-gr-c-s-check-loaded="14.1014.0" data-gr-ext-installed=""><div id="globalWrapper"><div id="column-content"><div id="content" class="mw-body" role="main"><a id="top"></a><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Reduction of VLA Sky Survey Measurement Sets - CASA Guides</h1><div id="bodyContent" class="mw-body-content"><div id="siteSub">From CASA Guides</div><div id="contentSub" lang="en" dir="ltr"><span class="mw-redirectedfrom">(Redirected from <a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial&amp;redirect=no" class="mw-redirect" title="VLA Radio galaxy 3C 129: P-band continuum tutorial">VLA Radio galaxy 3C 129: P-band continuum tutorial</a>)</span></div><div id="jump-to-nav"></div><a href="#column-one" class="mw-jump-link">Jump to navigation</a><a href="#searchInput" class="mw-jump-link">Jump to search</a><!-- start content --><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><br>
</p>
<p><b>This CASA Guide is for Version 5.7.0 of CASA.</b></p><p class="mw-empty-elt"></p> 
<p><b> Note: This guide may take up to 2-days to complete </b></p><p class="mw-empty-elt"></p> 
<p>If you are using a later version of CASA and this is the most recent available guide, then you should be able to use most, if not all, of this casaguide, as we try to limit script breaking changes in CASA development. 
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox" style=""></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Obtaining_the_raw_data"><span class="tocnumber">2</span> <span class="toctext">Obtaining the raw data</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Starting_CASA"><span class="tocnumber">3</span> <span class="toctext">Starting CASA</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Importing_the_raw_data_into_CASA"><span class="tocnumber">4</span> <span class="toctext">Importing the raw data into CASA</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Preliminary_data_inspection"><span class="tocnumber">5</span> <span class="toctext">Preliminary data inspection</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction"><span class="tocnumber">6</span> <span class="toctext">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Initial_data_editing"><span class="tocnumber">6.1</span> <span class="toctext">Initial data editing</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Dead_antennas"><span class="tocnumber">6.2</span> <span class="toctext">Dead antennas</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Hanning_smoothing"><span class="tocnumber">6.3</span> <span class="toctext">Hanning smoothing</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Antenna_Position_Corrections"><span class="tocnumber">6.4</span> <span class="toctext">Antenna Position Corrections</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Ionospheric_TEC_Corrections"><span class="tocnumber">6.5</span> <span class="toctext">Ionospheric TEC Corrections</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Requantizer_Gains"><span class="tocnumber">6.6</span> <span class="toctext">Requantizer Gains</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Automatic_flagging"><span class="tocnumber">7</span> <span class="toctext">Automatic flagging</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Absolute_Flux_Density_Calibration"><span class="tocnumber">8</span> <span class="toctext">Absolute Flux Density Calibration</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Delay_and_bandpass_calibration"><span class="tocnumber">9</span> <span class="toctext">Delay and bandpass calibration</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#Gain_calibration"><span class="tocnumber">10</span> <span class="toctext">Gain calibration</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Transfer_of_calibrations_to_the_target_field"><span class="tocnumber">11</span> <span class="toctext">Transfer of calibrations to the target field</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Statwt"><span class="tocnumber">12</span> <span class="toctext">Statwt</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#Imaging"><span class="tocnumber">13</span> <span class="toctext">Imaging</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Self_Calibration"><span class="tocnumber">14</span> <span class="toctext">Self Calibration</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="#Appendix:_Some_P-band_data_issues_you_may_want_to_know_about"><span class="tocnumber">15</span> <span class="toctext">Appendix: Some P-band data issues you may want to know about</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#Polarization_labeling"><span class="tocnumber">15.1</span> <span class="toctext">Polarization labeling</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Swapped_polarizations"><span class="tocnumber">15.2</span> <span class="toctext">Swapped polarizations</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Double_data_descriptor_entries"><span class="tocnumber">15.3</span> <span class="toctext">Double data descriptor entries</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Continuous_Radio_Frequency_Interference_.28RFI.29"><span class="tocnumber">15.4</span> <span class="toctext">Continuous Radio Frequency Interference (RFI)</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Two_spectral_window_setup"><span class="tocnumber">15.5</span> <span class="toctext">Two spectral window setup</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Bandpass_ripples"><span class="tocnumber">15.6</span> <span class="toctext">Bandpass ripples</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#High_cross-polarization"><span class="tocnumber">15.7</span> <span class="toctext">High cross-polarization</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Instrumental_Polarization_Calibration"><span class="tocnumber">15.8</span> <span class="toctext">Instrumental Polarization Calibration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#Useful_links"><span class="tocnumber">16</span> <span class="toctext">Useful links</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>This webpage provides a basic description on how to use CASA to reduce data from the upper part of the new VLA low-band system, also known as P-band, covering roughly 220-480 MHz. The goal is to make a wide-field continuum stokes I image of a typical blank field using the full effective bandwidth. The dataset that will be downloaded in this guide has a size of 26.46 GB and will require a total of ~140 GB of disk space if all generated files are kept. 
</p><p><i>Note: Starting with CASA 5.0 IPython 5.1.0 is used for interactive CASA sessions. This does not allow to readily paste and execute multiple lines of code like in previous versions of the interpreter. If this is needed at any point in this tutorial, we use "%cpaste" to allow the copy/paste of loops, conditions, etc.. Press "Enter" (or "Return") after "--" at the end, this stops (or exits) the copy/paste prompt and will return you to the CASA prompt.</i>
</p>
<h2><span class="mw-headline" id="Obtaining_the_raw_data">Obtaining the raw data</span></h2>
<p>For this guide, we'll use some test data that was taken in B-configuration. To get a copy of the raw data, download <a rel="nofollow" class="external text" href="https://casa.nrao.edu/Data/EVLA/Pband/P_band_3C129.tgz">P_band_3C129.tgz</a> onto your computer running CASA and untar it (i.e. <i>tar -zxvf &lt;filename&gt;</i>).
</p><p><br>
Alternatively, the raw data can also be obtained from the NRAO archive, go to the <a rel="nofollow" class="external text" href="https://archive.nrao.edu/archive/advquery.jsp">NRAO advance archive query page</a>, and enter the following search parameter in the field <i>Archive File ID</i> (leave the rest on default):
</p>
<div style="text-align:justify;">
<pre style="background-color: #gray;">imag-test-copy.57080.956837025464
</pre>
</div>
<p>The search should return a single row for Archive File: imag-test-copy.57080.956837025464, taken on Feb. 27, 2015 (or "15-Feb-27 22:57:52"). Check the box next to it. Next, fill in your email and select the "SDM-BDF dataset (all files)" option. Note, you may find it easier to download a tar file, in which case, you'll want to check the box for Create MS or SDM tar file. Click "Get My Data" and follow the on-screen prompts to reach the next page, where you should click "Retrieve over internet". The next page should report that the data staging is in progress. Wait until you receive an e-mail reporting that your archive data is copied, which should take a few minutes. Download the data onto your computer running CASA and untar it (i.e. <i>tar -xvf &lt;filename&gt;</i>).
</p>
<h2><span class="mw-headline" id="Starting_CASA">Starting CASA</span></h2>
<p>Start CASA by typing 
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>casa -r <span class="m">5</span>.7.0-134
</pre></div>
<p>on the (linux) command line. This should start a CASA 5.7.0 interactive python (iPython) session, and open a separate log window. The CASA version is reported at startup, both in the python session and the log window.
</p>
<h2><span class="mw-headline" id="Importing_the_raw_data_into_CASA">Importing the raw data into CASA</span></h2>
<p>We will begin by importing our data into the measurement set format (CASA standard) from the binary format (SDM-BDF) as downloaded from the archive. We do this by means of the importasdm task. It is important to note that the importevla task has been deprecated.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">importasdm</span><span class="p">(</span><span class="n">asdm</span><span class="o">=</span><span class="s1">'imag-test-copy.57080.956837025464'</span><span class="p">,</span> <span class="n">vis</span> <span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">savecmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">)</span>
</pre></div>
<p>This task calls the external tool <i>asdm2MS</i> to perform the conversion. Together with the visibility data, also the flag commands from the VLA online system are imported. These flags are not directly applied, but stored in the <i>importflags.txt</i> file and applied later.
</p>
<h2><span class="mw-headline" id="Preliminary_data_inspection">Preliminary data inspection</span></h2>
<p>Inspect the observation set up with the <i>listobs</i> task. The following command will save the output to a file. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">listfile</span> <span class="o">=</span> <span class="s1">'3C129.listobs'</span><span class="p">)</span>
</pre></div>
<p>Alternatively, you can also output to the logger by running the command without the listfile argument. The sample listobs output shown has flag <i>verbose=False</i> for the sake of brevity.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<pre style="background-color: #fffacd;">================================================================================
           MeasurementSet Name:  /lustre/aoc/sciops/fschinze/P_band_tutorial/3C129.ms      MS Version 2
================================================================================
   Observer:      Project: uid://evla/sdm/X2
Observation: EVLA(27 antennas)
Data records: 4714983       Total elapsed time = 1422 seconds
   Observed from   27-Feb-2015/22:57:54.0   to   27-Feb-2015/23:21:36.0 (UTC)

Fields: 2
  ID   Code Name                RA               Decl           Epoch   SrcId      nRows
  0    NONE 3C147               05:42:36.127300 +49.51.07.17800 J2000   0        1307124
  1    NONE 3C129               04:48:58.200000 +45.02.01.00000 J2000   1        3407859
Spectral Windows:  (19 unique spectral windows and 1 unique polarization setups)
  SpwID  Name           #Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs
  0      EVLA_P#A0C0#0     128   TOPO     224.000       125.000     16000.0    231.9375       12  XX  XY  YX  YY
  1      EVLA_P#A0C0#1     128   TOPO     240.000       125.000     16000.0    247.9375       12  XX  XY  YX  YY
  2      EVLA_P#A0C0#2     128   TOPO     256.000       125.000     16000.0    263.9375       12  XX  XY  YX  YY
  3      EVLA_P#A0C0#3     128   TOPO     272.000       125.000     16000.0    279.9375       12  XX  XY  YX  YY
  4      EVLA_P#A0C0#4     128   TOPO     288.000       125.000     16000.0    295.9375       12  XX  XY  YX  YY
  5      EVLA_P#A0C0#5     128   TOPO     304.000       125.000     16000.0    311.9375       12  XX  XY  YX  YY
  6      EVLA_P#A0C0#6     128   TOPO     320.000       125.000     16000.0    327.9375       12  XX  XY  YX  YY
  7      EVLA_P#A0C0#7     128   TOPO     336.000       125.000     16000.0    343.9375       12  XX  XY  YX  YY
  8      EVLA_P#A0C0#8     128   TOPO     352.000       125.000     16000.0    359.9375       12  XX  XY  YX  YY
  9      EVLA_P#A0C0#9     128   TOPO     368.000       125.000     16000.0    375.9375       12  XX  XY  YX  YY
  10     EVLA_P#A0C0#10    128   TOPO     384.000       125.000     16000.0    391.9375       12  XX  XY  YX  YY
  11     EVLA_P#A0C0#11    128   TOPO     400.000       125.000     16000.0    407.9375       12  XX  XY  YX  YY
  12     EVLA_P#A0C0#12    128   TOPO     416.000       125.000     16000.0    423.9375       12  XX  XY  YX  YY
  13     EVLA_P#A0C0#13    128   TOPO     432.000       125.000     16000.0    439.9375       12  XX  XY  YX  YY
  14     EVLA_P#A0C0#14    128   TOPO     448.000       125.000     16000.0    455.9375       12  XX  XY  YX  YY
  15     EVLA_P#A0C0#15    128   TOPO     464.000       125.000     16000.0    471.9375       12  XX  XY  YX  YY
  16     EVLA_P#B0D0#16     64   TOPO     310.000       500.000     32000.0    325.7500       15  XX  XY  YX  YY
  17     EVLA_P#B0D0#17   1024   TOPO     310.000        62.500     64000.0    341.9688       15  XX  XY  YX  YY
  18     EVLA_P#B0D0#18     64   TOPO     342.000       500.000     32000.0    357.7500       15  XX  XY  YX  YY
Antennas: 27 'name'='station'
   ID=   0-3: 'ea01'='N12', 'ea02'='N16', 'ea03'='W28', 'ea05'='E20',
   ID=   4-7: 'ea06'='N20', 'ea07'='N32', 'ea08'='E28', 'ea09'='W08',
   ID=  8-11: 'ea10'='E36', 'ea11'='W12', 'ea12'='N36', 'ea13'='W04',
   ID= 12-15: 'ea14'='E08', 'ea15'='E24', 'ea16'='W24', 'ea17'='E04',
   ID= 16-19: 'ea18'='W36', 'ea19'='MAS', 'ea20'='N04', 'ea21'='E32',
   ID= 20-23: 'ea22'='N24', 'ea23'='E16', 'ea24'='W32', 'ea25'='W20',
   ID= 24-26: 'ea26'='E12', 'ea27'='N08', 'ea28'='N28'
 
</pre>
<p>You can inspect the output text file <i>3C129.listobs</i> in your favorite text editor (e.g., <i>gedit</i>). When taking some time to familiarize yourself with the output format, you will see that:
</p>
<ul><li>The observation consists of 5 scans, namely:</li></ul>
<ol><li>3C147 (hardware setup)</li>
<li>3C147 (setting requantizers)</li>
<li>3C147 (primary calibrator)</li>
<li>3C129 (target)</li>
<li>3C129 (target)</li></ol>
<ul><li>The frequency coverage is 222 - 478 MHz, divided into 16 x 16 MHz spectral windows, each having 128 x 0.125 MHz channels. There are also two spectral windows with 64x0.5 MHz and one spectral window with 1024x0.0625 MHz.</li>
<li>Visibilities are recorded every 2 seconds in full polarization (4 polarization products labelled XX,XY,YX,YY).</li>
<li>Of the 28 VLA antennas labelled ea01 - ea028, antenna ea04 is not participating in this observation.</li>
<li>Source, antenna and spectral window IDs start at zero, but scan IDs start at one.</li></ul>
<p><br>
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_plotants.png" class="image"><img alt="" src="/images/thumb/7/77/3C129_pband_plotants.png/200px-3C129_pband_plotants.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/7/77/3C129_pband_plotants.png/300px-3C129_pband_plotants.png 1.5x, /images/thumb/7/77/3C129_pband_plotants.png/400px-3C129_pband_plotants.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_plotants.png" class="internal" title="Enlarge"></a></div>Figure 1: Plotants() figure showing configuration of the antennas in the array.</div></div></div> 
<p>The array configuration can be inspected using:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotants</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">figfile</span><span class="o">=</span><span class="s1">'3C129_pband_plotants.png'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span id="Initial_processing_steps_-_Hanning_smoothing,_Antenna_Position,_Requantizer_Gain,_Ionospheric_Correction"></span><span class="mw-headline" id="Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></h2>
<h3><span class="mw-headline" id="Initial_data_editing">Initial data editing</span></h3>
<p>When importing the data, we saved the flags from the online system to an ASCII text file. This gives us the opportunity to review the flag commands before applying them. For our data set, the flag file is called <i>importflags.txt</i>. Open this file with your favorite text editor. The bulk of the flag commands refer to times when the VLA is slewing (<i>ANTENNA_NOT_ON_SOURCE</i>) or when the movable secondary reflector of the VLA's Cassegrain system is not in place (<i>SUBREFLECTOR_ERROR</i>). The latter can cause antenna gain variations (amplitude and phase), so it is safest to apply all the flags. In order to remove visibilities that are pure zero, and flag antennas that are partly blocked by other antennas (shadowing), which occurs mostly in compact configurations when observing along a VLA arm, two lines need to be appended to <i>importflags.txt</i>. These are:
</p>
<pre>mode='clip' clipzeros=True
mode='shadow' tolerance=0.0
</pre>
<p>After this, execute in CASA:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'list'</span><span class="p">,</span> <span class="n">inpfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">'any'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>This call, before applying the new flags to the data, created a new flagbackup file called flagdata_1 which can be used by the task <i>flagmanager</i> to restore the state of the measurement set prior applying the flags from <i>importflags.txt</i>.
</p>
<h3><span class="mw-headline" id="Dead_antennas">Dead antennas</span></h3><p>
It is important to identify dead antennas / polarizations early on, so we can exclude them from further data processing. A convenient way of doing this is through the <i>plotms</i> task on bright calibrator(s) (see the <i>listobs()</i> output), in our case 3C147 (see Fig. 2a).</p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="image"><img alt="" src="/images/thumb/6/63/3C129_pband_3C147_prebp.png/200px-3C129_pband_3C147_prebp.png" decoding="async" width="200" height="124" class="thumbimage" srcset="/images/thumb/6/63/3C129_pband_3C147_prebp.png/300px-3C129_pband_3C147_prebp.png 1.5x, /images/thumb/6/63/3C129_pband_3C147_prebp.png/400px-3C129_pband_3C147_prebp.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="internal" title="Enlarge"></a></div>Figure 2a: <i>plotms</i> output before RFI flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> 
           <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span><span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> 
           <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp.png'</span><span class="p">)</span>
</pre></div>
<p>This will load the <i>plotms</i> window that will iterate over all the baselines to antenna ea01. The plot will display the amplitude vs frequency plot with the colors representing the different spectral windows. Note that we are only plotting the XX and YY correlation here. This is because we expect most of the power in the linear cross correlation products to be in these two correlations. Notice that some spectral windows in particular are badly affected due to radio frequency interference (RFI). This is the issue that we will deal with after identifying dead antennas. If you page through the baselines using the green forward button in the <i>plotms</i> viewer, you will notice that the amplitude is particularly low when you encounter ea19. If we create a quick plot of the baselines to ea19 (put <i>ea19</i> in the antenna field), we can see that there is no power in any of the polarizations. This indicates that this antenna was dead and should be flagged. It is also good to check for high power levels in cross-hand correlations in comparison to the parallel-hand correlations, which would uncover swapped polarization labels and severely mis-aligned dipoles. At the end of this tutorial we provide some hints on solving for swapped or mislabeled dipole polarizations. In addition to the dead antenna, we also make sure that the first two scans are flagged, which were not labelled as setup scans but were used to set the attenuators and requantizers udring the observations.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea19'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">scan</span><span class="o">=</span><span class="s1">'1~2'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Hanning_smoothing">Hanning smoothing</span></h3><p>
During the data inspection above, we also notice sharp RFI peaks. Often this is due to Gibbs ringing (Gibbs phenomenon), and to prevent this phenomenon it is best to Hanning smooth the data at this juncture. The default P-band setup contains 16x16 MHz spectral windows. For Hanning smoothing we will select the first 16 spectral windows. This will also make the hanning smoothed dataset smaller and faster to process. Now is a good time to get a cup of coffee while the task is hanning smoothing the data. </p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/200px-Prebp_hanning_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/300px-Prebp_hanning_casa_5.5.0.png 1.5x, /images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/400px-Prebp_hanning_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 2b: <i>plotms</i> output after Hanning smooth and first flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">hanningsmooth</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span><span class="n">spw</span><span class="o">=</span><span class="s1">'0~15'</span><span class="p">)</span>
</pre></div>
<p>Once the task is finished we should replot the primary calibrator to see the effect of hanning smoothing on the data and the RFI (Fig. 2b). 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning.png'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Antenna_Position_Corrections">Antenna Position Corrections</span></h3>
<p>It is always a good idea to check if the antenna position offsets need corrections. Antenna positional errors translate to an error in the measured visibilities and, if present, they need to be accounted for before we proceed with any of the other calibration steps. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'antpos'</span><span class="p">)</span>
</pre></div>
<p>The logger output shows that there are 13 antennas with positional offsets: 
</p>
<pre>
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea03&nbsp;:  0.00290   0.00000   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea08&nbsp;:  0.00000   0.00390   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea10&nbsp;: -0.00170   0.00000   0.00400
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea11&nbsp;:  0.00000   0.00160  -0.00170
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea13&nbsp;:  0.00000   0.00050   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea16&nbsp;: -0.00180   0.00680   0.00230
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea18&nbsp;:  0.00470   0.00350   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea21&nbsp;: -0.00160   0.00000   0.00210
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea23&nbsp;:  0.00140   0.00200  -0.00150
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea24&nbsp;:  0.00380   0.00000  -0.00340
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea25&nbsp;:  0.00330   0.00000  -0.00110
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea26&nbsp;:  0.00000   0.00190   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea27&nbsp;: -0.00120   0.00070   0.00000


</pre>
<h3><span class="mw-headline" id="Ionospheric_TEC_Corrections">Ionospheric TEC Corrections</span></h3>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="image"><img alt="" src="/images/thumb/9/95/Pband_vla_tecu_new.png/200px-Pband_vla_tecu_new.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/9/95/Pband_vla_tecu_new.png/300px-Pband_vla_tecu_new.png 1.5x, /images/thumb/9/95/Pband_vla_tecu_new.png/400px-Pband_vla_tecu_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="internal" title="Enlarge"></a></div>Figure 3: TEC value (in units of TEC/m^2) vs time generated by <i>tec_maps.create()</i></div></div></div> 
<p>Low frequency observations are affected by the ionosphere. A delay in the signal path is introduced between the two polarization of light that varies both as a function of time and line of sight (direction dependent). The delay is proportional to the Total Electron Content (TEC) along the line of sight (TEC), and is inversely proportional to the square of the frequency (1/^2). GPS measurements at two different frequencies provide us with an estimate of the TEC per square meter. This correction has been implemented in CASA which we shall apply as a calibration table with the <i>gencal</i> task. The task requires a TEC map that we will generate with CASA recipes. For more information, see the section on <a rel="nofollow" class="external text" href="https://casa.nrao.edu/casadocs/casa-5.0.0/synthesis-calibration/preparing-for-calibration/#title5">ionospheric corrections</a> in the CASA documentation archives. For some versions of CASA, the first plot to the right (Figure 3) may not be generated if you have already run plotants: to generate this plot, you will need to restart CASA. If the IONEX data file was not downloaded, you might be missing the curl package in the environment you are running CASA in. In such a case you can provide the required file manually by downloading: <a rel="nofollow" class="external free" href="ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z">ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z</a> (for the tutorial it is also also available in an unzipped version <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/igsg0580.15i">here</a>), unziping it, and placing it in the directory from which you started CASA. The current implementation in CASA is in the development stage, however since the CASA 5.0 release both the Faraday rotation correction and dispersive delay corrections for the ionosphere are enabled. In previous releases only Faraday rotation corrections are enabled. In this example we will generate the calibration table and apply it throughout calibration. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">tec_maps</span>
<span class="c1">#</span>
<span class="n">tec_image</span><span class="p">,</span> <span class="n">tec_rms_image</span><span class="p">,</span> <span class="n">plotname</span> <span class="o">=</span> <span class="n">tec_maps</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">doplot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#[NOTE: If you are using CASA 5.0.0, or earlier this should be: tec_image, tec_rms_image = tec_maps.create(vis='3C129_pband.ms', doplot=True)]</span>
<span class="c1">#</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'tecim'</span><span class="p">,</span><span class="n">infile</span><span class="o">=</span><span class="n">tec_image</span><span class="p">)</span>
<span class="c1"># Spatial plots like shown in Figure 4 can be looked at using the CASA viewer for the TEC values</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_TEC.im'</span><span class="p">)</span>
<span class="c1"># and for TEC rms</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_RMS_TEC.im'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_tec_new.png" class="image"><img alt="" src="/images/thumb/d/db/Pband_tec_new.png/200px-Pband_tec_new.png" decoding="async" width="200" height="121" class="thumbimage" srcset="/images/thumb/d/db/Pband_tec_new.png/300px-Pband_tec_new.png 1.5x, /images/thumb/d/db/Pband_tec_new.png/400px-Pband_tec_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_tec_new.png" class="internal" title="Enlarge"></a></div>Figure 4: TEC map movie generated by the TEC tasks.</div></div></div> 
<p>A word of caution regarding the TEC map generation: the IGS website updates measurements only two weeks after the date of observation.
</p>
<h3><span class="mw-headline" id="Requantizer_Gains">Requantizer Gains</span></h3>
<p>The next step will correct the visibility amplitudes for the signal leveling (requantizer gains) that occurs at the inputs of the WIDAR correlator. These levels (per antenna, per polarization, per spectral window) are stored with the measurement set (in the <i>SYSPOWER</i> sub-table). This step is currently not essential, since the levels get set only once at the start of an observation and bandpass calibration will correct for this. But it will make your bandpass plots look better if you have multiple spectral windows. And, more importantly, in general it is possible to trigger the setting of requantizers throughout an observation. This is the case for new observations, when a P-band scan is preceded by a P-band setup scan, which itself is preceded by a scan with a different telescope configuration.  
</p><p>The correction is done by means of the <i>gencal</i> task, where information in the <i>SYSPOWER</i> sub-table gets translated into a gain table. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'rq'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.rq'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Automatic_flagging">Automatic flagging</span></h2>
<p>It is worthwhile noting at this juncture that the standard P-band setup will ensure that the worst of the RFI is restricted to four of the spectral windows. This particular dataset is an example of higher than average levels of RFI across the band. Before throwing away bad spectral windows by hand, we'll let the automated flaggers in CASA have a go at it.  The main task for this is <i>flagdata()</i>. While working on your data, <i>flagdata()</i> produces an abundance of output, not all of which is easy to understand. To help with this, we can get the flag status of our data before and after auto-flagging by running <i>flagdata()</i> in the <i>summary</i> mode. This first call provides the flag statistics of the flagging up to now, before any auto-flagging:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">summary_1</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
</pre></div>
<p>This returns a python dictionary with flagged versus total visibilities along various axes (antenna, scan, spw, field, correlation, etc.). For example, if we want to know the percentage flagged per scan, run the following (note that the scans may not appear in sorted order):
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
</pre></div>
<p>For this example, you will notice that scans 1 and 2 (the dummy scans on 3C147) are 100 percent flagged, which is what we did during the initial flagging.
</p><p>We will run <i>flagdata()</i> in the <i>TFCROP</i> mode, which will (per scan, per baseline, per spectral window, per polarization) look for visibility amplitude outliers. It uses a 5-piece polynomial in an attempt to remove any intrinsic bandpass (amplitude) structure (we did not calibrate for bandpass yet). We run the task twice to allow for slightly deeper flagging and separate treatment of the parallel and cross-hand correlations. For the first run, we tell CASA to make a backup of our visibility flag status up to here, giving us an option to restore them if we choose over-aggresive flagging parameters and consequently over-flag our data. The flag backup file name is reported in the log window, and can be found in the <i>3C129_pband.ms.flagversions</i> directory.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XY,ABS_YX'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XX,ABS_YY'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<p>As a note of caution: When executing flagdata with <i>mode='extend'</i>, all flags that were ever applied to the dataset will get extended. Repeat execution of this command will incrementally flag more and more around already flagged data.
</p><p>Let's get another flag summary to see how much extra data was flagged: 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">summary_2</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1"># </span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning_automatic.png'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/200px-Prbp_tfcropped_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/300px-Prbp_tfcropped_casa_5.5.0.png 1.5x, /images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/400px-Prbp_tfcropped_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5a: <i>plotms</i> output after RFI flagging with tfcrop</div></div></div>
<p>There is quite a bit of RFI that gets missed in RFI-rich spectral windows as can be seen in Fig. 5a. The solution to this is to provide the flagging routines with more contrast between healthy and affected data. For this, we will perform a preliminary bandpass calibration to take out the bandpass shape. We will do some coarse preliminary calibration and apply it to the calibrator before flagging for RFI once more.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'int'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">bandpass</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B0'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span><span class="s1">'3C129_pband.B0'</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
<p>On the command line you should see a notification stating: "FJones (iononsphere) apply now provisionally includes disp. delay." which indicates that both Faraday rotation as well as dispersive delay corrections for the ionosphere are applied.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/200px-Postbandpass_rflag_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/300px-Postbandpass_rflag_casa_5.5.0.png 1.5x, /images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/400px-Postbandpass_rflag_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5b: <i>plotms</i> output after RFI flagging with <i>mode='rflag'</i></div></div></div>
<p>We will now flag the corrected data column that contains the coarsely calibrated visibilities which provide better contrast to the flagging algorithms to remove the RFI present.  We will begin by running the <i>RFLAG</i> algorithm in the task <i>flagdata</i>. We will again use summary mode to see how much more of the observed data was flagged.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">summary_3</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_3</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C147_postbandpass_rflag.png'</span><span class="p">,</span> <span class="n">ydatacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">)</span>
</pre></div>
<p>Taking another visual look at the data using <i>plotms</i>, we examine the effect of the automated flagging on the calibrator (Fig. 5b). We find that most spectral windows are RFI free and that about 37% of the data was flagged. We typically expect between 40-60% of flagging due to interference in a significant fraction of the band. In this example, a more careful RFI flagging approach is likely to recover more usable spectrum.
</p>
<h2><span class="mw-headline" id="Absolute_Flux_Density_Calibration">Absolute Flux Density Calibration</span></h2>
<p>Our flagging has cleaned up most of the stray RFI across the band. This allows us to proceed with the actual calibration of the data. Before we get to the calibration tables, it's essential to do the flux density calibration of our calibrator 3C147. This is done by the <i>setjy</i> task. Before we run the task we first clear the preliminary calibration that was carried out to enable better flagging. We do that by running the <i>clearcal</i> task.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">clearcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">)</span>
</pre></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">setjy</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">standard</span><span class="o">=</span><span class="s1">'Scaife-Heald 2012'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span class="mw-headline" id="Delay_and_bandpass_calibration">Delay and bandpass calibration</span></h2>
<p>First, we use the full bandwidth on a single scan on the primary calibrator to determine a single delay per antenna, per polarization. This will determine a single (approximate) phase slope across frequency, mainly caused by propagation effects in the (time-variable) ionosphere, cable length differences, and electronics in the signal paths from antenna feeds to correlator. Note that for a single short (5-10 minutes) scan on the calibrator, we can get away with solving for a time-invariant delay per antenna, per polarization. We will use scan 3 on 3C147.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/1/1a/Delays_casa_5.5.0.png/200px-Delays_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/1/1a/Delays_casa_5.5.0.png/300px-Delays_casa_5.5.0.png 1.5x, /images/thumb/1/1a/Delays_casa_5.5.0.png/400px-Delays_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 6: Initial per antenna delays derived by <i>gaincal</i>.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span>
   <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">],</span><span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'antenna1'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'delay'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="o">-</span><span class="mf">50.</span><span class="p">,</span><span class="mf">50.</span><span class="p">])</span>
</pre></div>
<p>Since we picked ea09 as our reference antenna, the delays for this antenna ID are arbitrarily set to zero. All other delays should be within 30 nanosec or so (which they should be for this data set; Fig. 6). Larger values, which you can see if you do not force the plotrange, should be treated with suspicion, indicating a problem with the antenna or polarization. We will use the bandpass calibration to verify this in the next step.
</p><p>To determine the bandpass calibration, we use the same source and scan and apply the delay calibration before solving for the bandpass. Note that we request a minimum SNR of 3, which will make the solve fail for the worst, but not all, channels.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>After solving, we inspect the bandpass calibration amplitudes and phase, and flag any obvious residual outliers. Outliers may be found above or below the average bandpass curves, and tend to arise in the same channel (frequency) ranges for all antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Note that the bandpass amplitudes (Fig. 7a) and phases (Fig. 7b) may differ between polarizations of the same antenna. The bandpass phases across frequency should not have an overall gradient (this should be removed by the delay calibration), but they may wrap around from +/-180 to -/+180 degrees. If that is problematic, re-run the phase <i>plotms</i> with <i>plotrange = [ 200.,500.,0.,360. ]</i>. Also note that there are no bandpass solutions for antennas ea19 and ea28, and only a few solutions for ea14.
</p><p>Don't spend more than 1 minute per antenna to find and flag the outliers in this tutorial and don't worry about missing some bad points; these bad channels will likely get flagged in a later stage anyway. We don't set the scale for plotting the bandpass amplitudes, which is convenient when flagging outliers as it will auto-rescale. While plotting the bandpass phases we do fix the scale, as it provides a better feeling for the relevant magnitude of phase outliers. Flagging of outliers is done using the <i>Mark Region</i> and <i>Flag</i> buttons. For more information on interactive flagging, see the topical guide <a rel="nofollow" class="external text" href="http://casaguides.nrao.edu/index.php/VLA_CASA_Flagging">Flagging VLA Data in CASA</a>. We are using this mechanism to efficiently flag data manually, since it is done per antenna rather than per baseline. These 'flags' will not be permanent until we call <i>applycal</i> later on, but are effective while applying the calibration on the fly, as we will do in subsequent calibration steps.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="image"><img alt="" src="/images/thumb/6/67/Initial_bp_amp_casa550.png/200px-Initial_bp_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/6/67/Initial_bp_amp_casa550.png/300px-Initial_bp_amp_casa550.png 1.5x, /images/thumb/6/67/Initial_bp_amp_casa550.png/400px-Initial_bp_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7a: Initial bandpass amplitudes for antenna ea01 after manually flagging the outliers and bad data points (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="image"><img alt="" src="/images/thumb/9/9a/Initial_bp_phase_casa550.png/200px-Initial_bp_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/9/9a/Initial_bp_phase_casa550.png/300px-Initial_bp_phase_casa550.png 1.5x, /images/thumb/9/9a/Initial_bp_phase_casa550.png/400px-Initial_bp_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7b: Initial bandpass phase for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Gain_calibration">Gain calibration</span></h2>
<p>With the delay and bandpass calibration in place, we will now look more closely at the time-variable behavior of the VLA. We use the same scan on our primary calibrator, 3C147, over the full effective bandwidth to determine gain calibrations: one complex value per antenna, per polarization, per integration time. The delay and bandpass tables are applied on the fly.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span> <span class="o">=</span> <span class="s1">'int'</span><span class="p">,</span>
             <span class="n">refant</span> <span class="o">=</span> <span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span> <span class="o">=</span> <span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span> <span class="o">=</span> <span class="s1">'ap'</span><span class="p">,</span>
             <span class="n">gaintable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span> <span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="s1">'3C129_pband.B1'</span> <span class="p">],</span>
             <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span> <span class="p">],</span> <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
</pre></div>
<p>Again, the solutions should be inspected for any outliers. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">],</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Similar to the bandpass flagging, we will flag outlier gain solutions in both amplitude and phase. For the amplitudes, the final scatter around an average close to one should be a few percent (see Fig. 8a,b). Note antennas ea08, ea09 have particularly noisy solutions. Remember that the gain solutions for both polarizations can be flagged together, as we will lose the equivalent data of the surviving polarization anyway.
</p><p>Note that when plotting gains against time, it is convenient to use auto-scaling of the time axis by putting <i>None</i> in the first two fields of <i>plotrange</i>.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_amp_casa550.png" class="image"><img alt="" src="/images/thumb/5/5d/Gain_amp_casa550.png/200px-Gain_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/5/5d/Gain_amp_casa550.png/300px-Gain_amp_casa550.png 1.5x, /images/thumb/5/5d/Gain_amp_casa550.png/400px-Gain_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8a: Initial gain amplitude solutions for antenna ea01 after manually flagging the outlier solutions (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_phase_casa550.png" class="image"><img alt="" src="/images/thumb/3/3e/Gain_phase_casa550.png/200px-Gain_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/3/3e/Gain_phase_casa550.png/300px-Gain_phase_casa550.png 1.5x, /images/thumb/3/3e/Gain_phase_casa550.png/400px-Gain_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8b: Initial gain phase solutions for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<p><br>
Next, we will prepare a smoothed and interpolated version of the gain calibration table, which will be applied later to the target field data. This prevents flagging of target field data when one of the edges of a calibrator scan is flagged for one or more antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">smoothcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">tablein</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">smoothtype</span><span class="o">=</span><span class="s1">'median'</span><span class="p">,</span> <span class="n">smoothtime</span> <span class="o">=</span> <span class="mf">60.</span><span class="o">*</span><span class="mf">60.</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Transfer_of_calibrations_to_the_target_field">Transfer of calibrations to the target field</span></h2>
<p>So far we have used one scan on the primary calibrator 3C147 to derive various calibration tables. These calibrations will now be applied to all scans of all sources in our measurement set, which includes 3C147 itself and our target field 3C129. As described above, the task <i>applycal()</i> creates a <i>CORRECTED_DATA</i> column in which the calibrated visibilities get stored. This may take a while.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span>
              <span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">],</span>
         <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>Now we split off the calibrated target field data, meaning that the visibilities of source 3C129 get copied from the <i>CORRECTED_DATA</i> column to the <i>DATA</i> column of a new measurement set. This is convenient for further processing. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">split</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">)</span>
</pre></div>
<p>It is also helpful to perform additional flagging for any residual RFI left behind in our target after all our calibration steps have been completed and we begin the imaging of our data.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">)</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Statwt">Statwt</span></h2>
<p>Before we go ahead and image our target field we should try to downweight any remaining residual low level RFI. This is done using the task <i>statwt</i>. The task runs through the data and computes the rms of the data weighting down outliers. This makes a big impact for imaging of a target in the presence of low level residual RFI. For our purposes we will bin the data in a time interval larger than the integration time and run <i>statwt</i> as follows.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">statwt</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timebin</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p>With data weights for outliers being set we will now proceed with the imaging and self-calibration of our data.
</p>
<h2><span class="mw-headline" id="Imaging">Imaging</span></h2>
<p>At this point, we're ready to make a first image of our target field. Imaging in CASA is done by means of the <i>tCLEAN</i> task. The task implements algorithms for wide field imaging, such as W-Projection (Cornwell et al. 2008 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/0807.4161">http://arxiv.org/abs/0807.4161</a>) and Multi Term Multi Frequency Synthesis ( Rau et al. 2011 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/1106.2745">http://arxiv.org/abs/1106.2745</a>) both of which we will utilize to make our initial image. Even though our source of concern, the radio galaxy, lies in the centre of our field. The observations were carried out in B configuration resulting in an effective maximum resolution of approximately 5x5 arcsecs. To effectively model the source spectral index in the sky, we will utilize the MTMFS algorithm and use the W-Projection algorithm to make a wide field image (The full beam at P Band is about 3 degrees in diameter). So, going by these requirements, we can now compute the required cell and image size. Consulting the resolution guide of NRAO science page, we can see that the expected HPBW for B - Configuration, P -Band Observation is 18.5 arcsec. So, we can sample it well by using a 5 arcsec cellsize. Having done that, if we decide to make a wide field image to account for all the point sources we will set the image size parameter to 4860 pixels. To enable the wide-field algorithm, we set the <i>gridder='wproject'</i>: this invokes the W-Projection algorithm, upon which we set the number of W-Projection planes to be 128. We set the deconvolution mode as Multi Term Multi Scale Multi Frequency Synthesis using the <i>deconvolver='mtmfs'</i> parameter along with the number of Taylor terms to be considered during imaging to be 2 and choosing three different scales to model the point source and extended emission in our field well, we do this by setting <i> scales=[0,20,30]</i>. This allows for the source spectral variation to be modeled by a second order polynomial. We launch the interactive tclean process, but only for <i>spw='3~8'</i> to begin with. Note, running the first clean call will take at least ~10 min to process.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_initial_clean'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
<p><br>
The <i>tCLEAN</i> command launches an interactive session after a 100 iterations of clean and produces a wide field map with two sources at the center and a lot of bright sources far out in the field (Fig. 9a). As it is a snapshot image, the bright sources have significant side lobes and so tight clean boxing can help. This can be done in the interactive viewer interface that pops up. If we proceed with interactive clean with subsequent steps to keep boxing out the strong sources that pop up in the image, we finally see the extended emission from the target radio galaxy begin to emerge. Continue boxing and cleaning to ensure that the residuals of the boxed cleaning look noise like (~10000 clean iterations). We now stop the interactive task and look at the final image it produced (Fig. 9b).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_initial_clean.image.tt0'</span><span class="p">)</span>
</pre></div>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="image"><img alt="" src="/images/thumb/8/89/3C129_radio_gal_residual.png/200px-3C129_radio_gal_residual.png" decoding="async" width="200" height="152" class="thumbimage" srcset="/images/thumb/8/89/3C129_radio_gal_residual.png/300px-3C129_radio_gal_residual.png 1.5x, /images/thumb/8/89/3C129_radio_gal_residual.png/400px-3C129_radio_gal_residual.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="internal" title="Enlarge"></a></div>Figure 9a: Resulting residuals of 3C129 after first call of interactive <i>clean</i>.</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="image"><img alt="" src="/images/thumb/6/64/3C129_radio_gal_clean.png/200px-3C129_radio_gal_clean.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/6/64/3C129_radio_gal_clean.png/300px-3C129_radio_gal_clean.png 1.5x, /images/thumb/6/64/3C129_radio_gal_clean.png/400px-3C129_radio_gal_clean.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="internal" title="Enlarge"></a></div>Figure 9b: Resulting image of 3C129 after completing the first <i>clean</i>.</div></div></div>
</td></tr></tbody></table>
<p>The recovered structure at the center of the map should resemble what is shown in Fig. 9b. If the image looks worse then boxing of bright features in the map needs to be done more carefully. Note the image has some sources still showing strong side lobes and imaging artifacts around them. We expected this as we have carried out phase calibration only on our flux calibrator and have just transferred the solutions over to our target field. Since we used the <i>usescratch=True</i>, the MODEL_DATA column in the measurement set now contains the initial image model, which we will self calibrate against to produce a better image. Also in clean, do notice that the spw's utilized are the cleanest spectral windows that are totally RFI free.
</p>
<h2><span class="mw-headline" id="Self_Calibration">Self Calibration</span></h2>
<p>We now proceed to compute gain phase solutions for our target field using the <i>gaincal</i> task as the first step in self-calibration.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> 
           <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span><span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>

<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">],</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">)</span>
</pre></div>
<p>Having applied these gain and bandpass solutions, we will once again image the target measurement set which we now expect to have better gain solutions and consequently a better image. We do this by invoking the <i>tCLEAN</i> command once again.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_clean_sc0'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_clean_sc0.image.tt0'</span><span class="p">)</span>
</pre></div>
<p>On boxing and cleaning, we already notice that the imaging artifacts have reduced significantly. We also see that the target source appears to contain more structure and a greater amount of flux. Further self calibration iterations involving an amplitude &amp; phase gain calibration, and target bandpass calibration, are all possible steps that can be explored. Example on the final improvements the self-calibration can provide is shown in Fig. 10.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:402px;"><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="image"><img alt="" src="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/400px-3C129_radio_gal_cselfcal0.png" decoding="async" width="400" height="160" class="thumbimage" srcset="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/600px-3C129_radio_gal_cselfcal0.png 1.5x, /images/thumb/7/75/3C129_radio_gal_cselfcal0.png/800px-3C129_radio_gal_cselfcal0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="internal" title="Enlarge"></a></div>Figure 10: Resulting image of 3C129 after completing two rounds of self calibration is shown in the right panel, along with the pre-selfcal image on the left.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Appendix:_Some_P-band_data_issues_you_may_want_to_know_about">Appendix: Some P-band data issues you may want to know about</span></h2>
<p>Unfortunately, there are a few known issues with the upgraded VLA P-band observing. Most problems were discovered during the P-band commissioning period and have been fixed for newer data sets, but the archive keeps part of this history alive. Here we will go over some of those issues, and (if possible) provide ways of fixing them.
</p>
<h3><span class="mw-headline" id="Polarization_labeling">Polarization labeling</span></h3>
<p>For a long period, P-band feeds have been labeled as being circular (R and L), while they are linear (X and Y). It is still possible to generate data with incorrect polarization labeling, however for standard observations this should not be the case anymore. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem. This may seem mostly harmless, but does make a difference for polarization calibration. The following (non-standard) task will check and fix this (and another related problem of swapped polarizations):
</p><p>Download <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/casa_vla_lowband.tar.gz">this tarball</a> in your CASA working directory, open a shell there, and type the following commands:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>tar -xzvf casa_vla_lowband.tar.gz

buildmytasks
</pre></div>
<p>Now go back to your CASA session and type:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="nb">execfile</span><span class="p">(</span><span class="s1">'mytasks.py'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">fixlowband</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">)</span>
</pre></div>
<p>Re-run the <i>listobs()</i> task to check if the fix was correctly applied.
</p>
<h3><span class="mw-headline" id="Swapped_polarizations">Swapped polarizations</span></h3>
<p>Throughout the whole history of the new VLA low-band system, even up to this day, there have been mistakes in the cabling of the full signal chain. This results in that some antennas have the X-polarization signal come in as Y and vice versa. The way to notice this in visibility data is that for baselines with one swapped antenna most power will be in the cross-hand correlations (XY and YX) rather than the parallel-hand correlations (XX and YY). Once antennas with this feature are manually identified, a contributed task <i>swappol()</i> is available to fix this problem (see under polarization labeling).
</p>
<h3><span class="mw-headline" id="Double_data_descriptor_entries">Double data descriptor entries</span></h3>
<p>The data description table is part of the measurement set, and provides a link between the recorded visibilities, the spectral window information and the polarization information. For some data sets, the data description table contains two entries for each P-band spectral window, one pointing towards a circular (RL) polarization definition, and one pointing towards a linear (XY) polarization definition. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem.
</p>
<h3><span id="Continuous_Radio_Frequency_Interference_(RFI)"></span><span class="mw-headline" id="Continuous_Radio_Frequency_Interference_.28RFI.29">Continuous Radio Frequency Interference (RFI)</span></h3>
<p>The wide bandwidth of the low-band receiver is (unfortunately) guaranteed to contain significant amounts of RFI. There are a few RFI sources that are active all the time, and are visible in all array configurations. The default P-band observing setup of 16 x 16 MHz tries to capture as much of the continuous RFI in as few spectral windows as possible, allowing for a simple RFI mitigation strategy in which these spectral windows (spws 1,2 and 9,10, but possibly more) can be immediately flagged.
</p>
<h3><span class="mw-headline" id="Two_spectral_window_setup">Two spectral window setup</span></h3>
<p>In the early commissioning period of the VLA upgrade, the default setup for P-band observing was to use 2 spectral windows of 1024 channels each to cover 256 MHz of bandwidth from 230 MHz to 486 MHz. However, it was noticed that strong, narrow-band RFI events were causing data to be lost for the whole spectral window in which they occurred. To make the system more robust against data loss from such events, the frequency range was divided into 16 x 16 MHz, and shifted downwards by 6 MHz to capture ever-present RFI into as few spectral windows as possible. If your data has only two P-band spectral windows, please be aware that a higher data loss due to RFI is possible. There is no way to repair this.
</p>
<h3><span class="mw-headline" id="Bandpass_ripples">Bandpass ripples</span></h3>
<p>Due to signal reflections in cables and within the VLA dish, sinusoidal amplitude and phase modulations are always present in P-band data. This is most easily seen in bandpass calibration plots of amplitude versus frequency. In some cases, mostly due to cable &amp; connector problems, these modulations can be very strong (~up to 50 percent of the average amplitude level). These modulations tend not to vary over the duration of an observation and can therefore be removed through bandpass and polarization calibration. If they are found to be variable (e.g., by inspecting bandpass solutions for separate calibrator scans), the offending antenna / polarization should be flagged.
</p>
<h3><span class="mw-headline" id="High_cross-polarization">High cross-polarization</span></h3>
<p>On each antenna, the P-band feed (dipole) is visually aligned with respect to the primary focus support legs. This is normally done within 5-10 degrees accuracy. On rare occasions the dipole on one antenna has accidentally rotated to much larger angles because the locking bolt on the back of the feed was not completely tightened. The result is a high cross-polarization in the baseline visibilities that include this antenna. If this is the case, it is safest to flag this data, since there is a possibility that the dipole has rotated during the observations.
</p>
<h3><span class="mw-headline" id="Instrumental_Polarization_Calibration">Instrumental Polarization Calibration</span></h3>
<p>While polarization leakage calibration has been highlighted in the past reports, it does not directly impact imaging in Stokes I and hence has been dropped from this casaguide.
</p>
<h2><span class="mw-headline" id="Useful_links">Useful links</span></h2>
<ul><li><a rel="nofollow" class="external text" href="http://www.aoc.nrao.edu/lbr">The EVLA Low-Band Receiver System Status &amp; User Pages</a></li>
<li><a rel="nofollow" class="external text" href="https://science.nrao.edu/facilities/vla/docs/manuals/obsguide/topical-guides/vlofreq">VLA Very Low Frequency Observing</a></li></ul>
<p><br>
</p>
<div style="background-color: #CCFF99;">
<p>Last checked on CASA Version 5.7.0.
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20210607154834
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.764 seconds
Real time usage: 10.267 seconds
Preprocessor visited node count: 321/1000000
Postexpand include size: 83/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 65393/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   12.816      1 Template:Checked_5.7.0
100.00%   12.816      1 -total
-->

<!-- Saved in parser cache with key casaguides_nrao_edu-wiki_:pcache:idhash:3925-0!canonical and timestamp 20210607154824 and revision id 29799
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799">https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799</a>"</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php?title=Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/index.php?title=Category:Pages_using_deprecated_source_tags&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages using deprecated source tags (page does not exist)">Pages using deprecated source tags</a></li></ul></div></div><!-- end content --><div class="visualClear"></div></div></div><div class="visualClear"></div></div><div id="column-one" lang="en" dir="ltr"><h2>Navigation menu</h2><div role="navigation" class="portlet" id="p-cactions" aria-labelledby="p-cactions-label"><h3 id="p-cactions-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li><li id="ca-talk" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [alt-shift-t]" accesskey="t">Discussion</a></li><li id="ca-viewsource"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></li><li id="ca-history"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">History</a></li></ul></div></div><div role="navigation" class="portlet" id="p-cactions-mobile" aria-labelledby="p-cactions-mobile-label"><h3 id="p-cactions-mobile-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main-mobile" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="Page">Page</a></li><li id="ca-talk-mobile" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title=" (page does not exist)">Discussion</a></li><li id="ca-more"><a href="#p-cactions">More</a></li><li id="ca-tools"><a href="#p-tb" title="Tools">Tools</a></li><li id="ca-languages"><a href="#p-lang" title="In other languages">In other languages</a></li></ul></div></div><div role="navigation" class="portlet" id="p-personal" aria-labelledby="p-personal-label"><h3 id="p-personal-label" lang="en" dir="ltr">Personal tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=VLA+Radio+galaxy+3C+129%3A+P-band+continuum+tutorial-CASA5.7.0" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li></ul></div></div><div class="portlet" id="p-logo" role="banner"><a href="/index.php?title=Main_Page" class="mw-wiki-logo" title="Visit the main page"></a></div><div id="sidebar"><div role="navigation" class="portlet generated-sidebar" id="p-" aria-labelledby="p--label"><h3 id="p--label" lang="en" dir="ltr"></h3><div class="pBody"><ul lang="en" dir="ltr"><li id="n-Main-Page"><a href="/index.php?title=Main_Page">Main Page</a></li></ul></div></div><div role="search" class="portlet" id="p-search"><h3 id="p-search-label" lang="en" dir="ltr"><label for="searchInput">Search</label></h3><div class="pBody" id="searchBody"><form action="/index.php" id="searchform"><input type="hidden" value="Special:Search" name="title"><input type="search" name="search" placeholder="Search CASA Guides" title="Search CASA Guides [alt-shift-f]" accesskey="f" id="searchInput"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton">&nbsp; <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"></form></div></div><div role="navigation" class="portlet" id="p-tb" aria-labelledby="p-tb-label"><h3 id="p-tb-label" lang="en" dir="ltr">Tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="t-whatlinkshere"><a href="/index.php?title=Special:WhatLinksHere/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/index.php?title=Special:RecentChangesLinked/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" rel="nofollow" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/index.php?title=Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="javascript:print();" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=info" title="More information about this page">Page information</a></li></ul></div></div></div><a href="#sidebar" title="navigation" class="menu-toggle" id="sidebar-toggle"></a><a href="#p-personal" title="user tools" class="menu-toggle" id="p-personal-toggle"></a><a href="#globalWrapper" title="back to top" class="menu-toggle" id="globalWrapper-toggle"></a></div><!-- end of the left (by default at least) column --><div class="visualClear"></div><div id="footer" class="mw-footer" role="contentinfo" lang="en" dir="ltr"><div id="f-poweredbyico" class="footer-icons"><a href="https://www.mediawiki.org/"><img src="/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></div><ul id="f-list"><li id="lastmod"> This page was last edited on 10 November 2020, at 05:09.</li><li id="privacy"><a href="/index.php?title=CASA_Guides:Privacy_policy" title="CASA Guides:Privacy policy">Privacy policy</a></li><li id="about"><a href="/index.php?title=CASA_Guides:About" title="CASA Guides:About">About CASA Guides</a></li><li id="disclaimer"><a href="/index.php?title=CASA_Guides:General_disclaimer" title="CASA Guides:General disclaimer">Disclaimers</a></li></ul></div></div>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.764","walltime":"10.267","ppvisitednodes":{"value":321,"limit":1000000},"postexpandincludesize":{"value":83,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":65393,"limit":5000000},"timingprofile":["100.00%   12.816      1 Template:Checked_5.7.0","100.00%   12.816      1 -total"]},"cachereport":{"timestamp":"20210607154834","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":168});});</script></body>
<html class="client-js" lang="en" dir="ltr"><head>
<meta charset="UTF-8">
<title>Reduction of VLA Sky Survey Measurement Sets - CASA Guides - CASA Guides</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"YL9iAJfPYOs2uRiPjp6bOQAAAAU","wgCSPNonce":!1,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgTitle":"Reduction of VLA Sky Survey Measurement Sets - CASA Guides","wgCurRevisionId":29799,"wgRevisionId":29799,"wgArticleId":3925,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages using deprecated source tags"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0","wgRelevantArticleId":3925,
"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRedirectedFrom":"VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial","wgSmjUseCdn":!0,"wgSmjUseChem":!0,"wgSmjDisplayMath":[],"wgSmjExtraInlineMath":[],"wgSmjScale":1,"wgSmjEnableMenu":!0,"wgSmjDisplayAlign":"left","wgInternalRedirectTargetUrl":"/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","mediawiki.toc.styles":"ready","mediawiki.skinning.content.externallinks":"ready","skins.monobook.responsive":"ready"};RLPAGEMODULES=["mediawiki.action.view.redirect","site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","skins.monobook.mobile"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.pygments%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.toc.styles%7Cskins.monobook.responsive&amp;only=styles&amp;skin=monobook">
<script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=monobook"></script>
<!--[if lt IE 9]><link rel="stylesheet" href="/skins/MonoBook/resources/screen-desktop.css?d010f" media="screen"/><![endif]-->
<style>
@media screen and (max-width: 550px) {
	#sidebar .generated-sidebar,#p-search-mobilejs,#p-tb-mobilejs,#p-lang-mobilejs,#t-contributions{display:none}#p-cactions,#p-personal,#p-tb,#p-lang,#sidebar-mobilejs{position:absolute;top:-9999px;left:0}#p-cactions.mobile-menu-active,#p-personal.mobile-menu-active,#p-tb.mobile-menu-active,#p-lang.mobile-menu-active,#sidebar-mobilejs.mobile-menu-active{top:2em;left:0}.mobile-menu-active{position:absolute;z-index:10000;background:#ffffff;border:solid 1px #fabd23;border-left:0;padding:2em 2em 0 1.5em;font-size:125%}.mobile-menu-active *[id^='ca-nstab-'],.mobile-menu-active #ca-talk,.mobile-menu-active #ca-edit{position:absolute;top:-9999px;left:0}.mobile-menu-active ul{padding-top:1em}.mobile-menu-active li{white-space:nowrap}.mobile-menu-active a{display:block;padding:0.65em 0}.mobile-menu-active h3:first-child{margin-right:2em}.mobile-menu-active .pBody{margin-bottom:2em}.mobile-menu-active .mobile-close-button{width:20px;height:20px;background-image:url(/skins/MonoBook/resources/images/icon-close.gif?9a868);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-close.svg?a9af1);background-position:0 0;background-repeat:no-repeat;position:absolute;top:1em;right:0.75em;cursor:pointer}.menus-cover{display:none;top:0;left:0;width:100%;height:100%;z-index:9999}.menus-cover.visible{display:block}#menus-cover{position:fixed;opacity:0.45;background-color:#ffffff}#menus-cover-background{position:absolute;background-color:#f9f9f9;background-image:url(/skins/MonoBook/resources/images/headbg.jpg?78766);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/headbg.svg?0be07);background-position:0 0;background-repeat:no-repeat;opacity:0.55}#p-cactions-mobile li#ca-edit-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-edit.gif?a6fe6);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-edit.svg?badf7)}#p-cactions-mobile li#t-contributions-mobile a{background-image:url(/skins/MonoBook/resources/images/icon-user.gif?d13ac);background-image:linear-gradient(transparent,transparent),url(/skins/MonoBook/resources/images/icon-user.svg?9bf49)}}
@media screen {
	body{margin:0}main{display:block}hr{box-sizing:content-box;height:0;overflow:visible}abbr[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title]{border-bottom:0;text-decoration:underline dotted}}pre,code,tt,kbd,samp{font-family:monospace,monospace}sub,sup{line-height:1}img{border:0}button::-moz-focus-inner,[type='button']::-moz-focus-inner,[type='reset']::-moz-focus-inner,[type='submit']::-moz-focus-inner{border-style:none;padding:0}legend{color:inherit;padding:0}   a{text-decoration:none;color:#0645ad;background:none}a:not([href]){cursor:pointer; }a:visited{color:#0b0080}a:active{color:#faa700}a:hover,a:focus{text-decoration:underline}a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.stub{color:#723}a.new,#p-personal a.new{color:#d33} a.mw-selflink{color:inherit;font-weight:bold;text-decoration:inherit}a.mw-selflink:hover{cursor:inherit;text-decoration:inherit}a.mw-selflink:active,a.mw-selflink:visited{color:inherit}a.new:visited,#p-personal a.new:visited{color:#a55858} .mw-parser-output a.extiw,.mw-parser-output a.external{color:#36b}.mw-parser-output a.extiw:visited,.mw-parser-output a.external:visited{color:#636; }.mw-parser-output a.extiw:active,.mw-parser-output a.external:active{color:#b63}.mw-parser-output a.external.free{word-wrap:break-word} img{border:0; vertical-align:middle}hr{height:1px;background-color:#a2a9b1;border:0;margin:0.2em 0} h1,h2,h3,h4,h5,h6{color:#000;margin:0;padding-top:0.5em;padding-bottom:0.17em;overflow:hidden}h1,h2{margin-bottom:0.6em;border-bottom:1px solid #a2a9b1}h3,h4,h5{margin-bottom:0.3em}h1{font-size:188%;font-weight:normal}h2{font-size:150%;font-weight:normal}h3{font-size:128%}h4{font-size:116%}h5{font-size:108%}h6{font-size:100%}p{margin:0.4em 0 0.5em 0}p img{margin:0}ul{margin:0.3em 0 0 1.6em;padding:0}ol{margin:0.3em 0 0 3.2em;padding:0;list-style-image:none}li{margin-bottom:0.1em}dt{font-weight:bold;margin-bottom:0.1em}dl{margin-top:0.2em;margin-bottom:0.5em}dd{margin-left:1.6em;margin-bottom:0.1em} pre,code,tt,kbd,samp,.mw-code{ font-family:monospace,monospace}code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;border-radius:2px;padding:1px 4px}pre,.mw-code{color:#000;background-color:#f8f9fa;border:1px solid #eaecf0;padding:1em; white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} table{font-size:100%} fieldset{border:1px solid #2a4b8d;margin:1em 0 1em 0;padding:0 1em 1em}legend{padding:0.5em;font-size:95%}form{border:0;margin:0}textarea{width:100%;padding:0.1em;display:block;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box} .center{width:100%;text-align:center}*.center *{margin-left:auto;margin-right:auto} .small{font-size:94%}table.small{font-size:100%}   .toc,.mw-warning,.toccolours{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;font-size:95%} .toc{display:table;padding:7px} table.toc{border-collapse:collapse} table.toc td{padding:0}.toc h2{display:inline;border:0;padding:0;font-size:100%;font-weight:bold}.toc .toctitle{text-align:center}.toc ul{list-style-type:none;list-style-image:none;margin-left:0;padding:0;text-align:left}.toc ul ul{margin:0 0 0 2em} .tocnumber,.toctext{display:table-cell; text-decoration:inherit} .tocnumber{color:#202122;padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0} .mw-warning{margin-left:50px;margin-right:50px;text-align:center}  div.floatright,table.floatright{margin:0 0 0.5em 0.5em} div.floatleft,table.floatleft{margin:0 0.5em 0.5em 0} div.thumb{margin-bottom:0.5em;width:auto;background-color:transparent}div.thumbinner{border:1px solid #c8ccd1;padding:3px;background-color:#f8f9fa;font-size:94%;text-align:center; overflow:hidden}html .thumbimage{background-color:#fff;border:1px solid #c8ccd1}html .thumbcaption{border:0;line-height:1.4em;padding:3px;font-size:94%; text-align:left}.magnify{ float:right;margin-left:3px}.magnify a{display:block; text-indent:15px;white-space:nowrap;overflow:hidden; width:15px;height:11px;  background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e); -moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}img.thumbborder{border:1px solid #eaecf0}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right;margin-left:3px;margin-right:0} .mw-content-ltr .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.png?4f704);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-ltr.svg?8330e)} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left;margin-left:0;margin-right:3px} .mw-content-rtl .magnify a{ background-image:url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.png?a9fb3);background-image:linear-gradient(transparent,transparent),url(resources/src/mediawiki.skinning/images/magnify-clip-rtl.svg?38fd5)} div.tright{margin:0.5em 0 1.3em 1.4em} div.tleft{margin:0.5em 1.4em 1.3em 0} body.mw-hide-empty-elt .mw-empty-elt{display:none}   .catlinks{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;margin-top:1em;clear:both}textarea{  border:1px solid #c8ccd1}.editOptions{background-color:#eaecf0;color:#202122;border:1px solid #c8ccd1;border-top:0;padding:1em 1em 1.5em 1em;margin-bottom:2em}.usermessage{background-color:#ffce7b;border:1px solid #ffa500;color:#000;font-weight:bold;margin:2em 0 1em;padding:0.5em 1em;vertical-align:middle}#siteNotice{position:relative;text-align:center;margin:0}#localNotice{margin-bottom:0.9em} #siteSub{display:none}#contentSub,#contentSub2{font-size:84%;line-height:1.2em;margin:0 0 1.4em 1em;color:#54595d;width:auto}span.subpages{display:block} .client-nojs #t-print{display:none; }      .mw-content-ltr{ direction:ltr}.mw-content-rtl{ direction:rtl} .sitedir-ltr textarea,.sitedir-ltr input{ direction:ltr}.sitedir-rtl textarea,.sitedir-rtl input{ direction:rtl}.mw-userlink{word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;unicode-bidi:embed} mark{background-color:#ff0;color:#000}  wbr{display:inline-block}  input[type='submit'],input[type='button'],input[type='reset'],input[type='file']{direction:ltr} textarea[dir='ltr'],input[dir='ltr']{ direction:ltr}textarea[dir='rtl'],input[dir='rtl']{ direction:rtl} abbr[title],.explain[title]{border-bottom:1px dotted;cursor:help}@supports (text-decoration:underline dotted){abbr[title],.explain[title]{border-bottom:0;text-decoration:underline dotted}} span.comment{font-style:italic;unicode-bidi:-moz-isolate;unicode-bidi:isolate} #editform,#toolbar,#wpTextbox1{clear:both} #toolbar{height:22px} .mw-underline-always a{text-decoration:underline}.mw-underline-never a{text-decoration:none} li span.deleted,span.history-deleted{text-decoration:line-through;color:#72777d;font-style:italic} .not-patrolled{background-color:#ffa}.unpatrolled{font-weight:bold;color:#d33}div.patrollink{font-size:75%;text-align:right} td.mw-label{text-align:right;vertical-align:middle}td.mw-input{text-align:left}td.mw-submit{text-align:left;white-space:nowrap}.mw-input-with-label{white-space:nowrap;display:inline-block}  .mw-content-ltr .thumbcaption{text-align:left} .mw-content-ltr .magnify{float:right} .mw-content-rtl .thumbcaption{text-align:right} .mw-content-rtl .magnify{float:left} #catlinks{ text-align:left}.catlinks ul{display:inline;margin:0;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.25em;border-left:1px solid #a2a9b1;margin:0.125em 0;padding:0 0.5em}.catlinks li:first-child{padding-left:0.25em;border-left:0} .catlinks li a.mw-redirect{font-style:italic} .mw-hidden-cats-hidden{display:none}.catlinks-allhidden{display:none} p.mw-protect-editreasons,p.mw-filedelete-editreasons,p.mw-delete-editreasons{font-size:90%;text-align:right} .autocomment,.autocomment a,.autocomment a:visited{color:#72777d} .newpage,.minoredit,.botedit{font-weight:bold} .mw-warning-with-logexcerpt{clear:both}.mw-warning-with-logexcerpt ul li{font-size:90%} span.mw-revdelundel-link,strong.mw-revdelundel-link{font-size:90%}span.mw-revdelundel-hidden,input.mw-revdelundel-hidden{visibility:hidden}td.mw-revdel-checkbox,th.mw-revdel-checkbox{padding-right:10px;text-align:center} a.new{color:#ba0000} .plainlinks a.external{background:none !important; padding:0 !important; }  .rtl a.external.free,.rtl a.external.autonumber{direction:ltr;unicode-bidi:embed} .wikitable{background-color:#f8f9fa;color:#202122;margin:1em 0;border:1px solid #a2a9b1;border-collapse:collapse}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td{border:1px solid #a2a9b1;padding:0.2em 0.4em}.wikitable > tr > th,.wikitable > * > tr > th{background-color:#eaecf0;text-align:center}.wikitable > caption{font-weight:bold} .error,.warning,.success{font-size:larger}.error{color:#d33}.warning{color:#ac6600}.success{color:#14866d} .mw-infobox{border:2px solid #fc3;margin:0.5em;clear:left;overflow:hidden}.mw-infobox-left{margin:7px;float:left;width:35px}.mw-infobox-right{margin:0.5em 0.5em 0.5em 49px} .previewnote{margin-bottom:1em}.visualClear{clear:both} .mw-datatable{border:1px solid #a2a9b1;border-collapse:collapse}.mw-datatable td,.mw-datatable th{border:1px solid #a2a9b1;padding:0.2em 0.4em}.mw-datatable th{background-color:#eaeeff}.mw-datatable td{background-color:#fff}.mw-datatable tr:hover td{background-color:#eaf3ff}.mw-ajax-loader{background-image:url(resources/src/mediawiki.skinning/images/ajax-loader.gif?57f34);background-position:center center;background-repeat:no-repeat;padding:16px;position:relative;top:-16px}.mw-small-spinner{padding:10px !important; margin-right:0.6em;background-image:url(resources/src/mediawiki.skinning/images/spinner.gif?ca65b);background-position:center center;background-repeat:no-repeat} .mw-content-ltr ul,.mw-content-rtl .mw-content-ltr ul{ margin:0.3em 0 0 1.6em;padding:0}.mw-content-rtl ul,.mw-content-ltr .mw-content-rtl ul{ margin:0.3em 1.6em 0 0;padding:0}.mw-content-ltr ol,.mw-content-rtl .mw-content-ltr ol{ margin:0.3em 0 0 3.2em;padding:0}.mw-content-rtl ol,.mw-content-ltr .mw-content-rtl ol{ margin:0.3em 3.2em 0 0;padding:0} .mw-content-ltr dd,.mw-content-rtl .mw-content-ltr dd{margin-left:1.6em;margin-right:0} .mw-content-rtl dd,.mw-content-ltr .mw-content-rtl dd{margin-right:1.6em;margin-left:0}  h1:lang(anp),h1:lang(as),h1:lang(bh),h1:lang(bho),h1:lang(bn),h1:lang(gu),h1:lang(hi),h1:lang(kn),h1:lang(ks),h1:lang(ml),h1:lang(mr),h1:lang(my),h1:lang(mai),h1:lang(ne),h1:lang(new),h1:lang(or),h1:lang(pa),h1:lang(pi),h1:lang(sa),h1:lang(ta),h1:lang(te){line-height:1.6em !important; } h2:lang(anp),h3:lang(anp),h4:lang(anp),h5:lang(anp),h6:lang(anp),h2:lang(as),h3:lang(as),h4:lang(as),h5:lang(as),h6:lang(as),h2:lang(bho),h3:lang(bho),h4:lang(bho),h5:lang(bho),h6:lang(bho),h2:lang(bh),h3:lang(bh),h4:lang(bh),h5:lang(bh),h6:lang(bh),h2:lang(bn),h3:lang(bn),h4:lang(bn),h5:lang(bn),h6:lang(bn),h2:lang(gu),h3:lang(gu),h4:lang(gu),h5:lang(gu),h6:lang(gu),h2:lang(hi),h3:lang(hi),h4:lang(hi),h5:lang(hi),h6:lang(hi),h2:lang(kn),h3:lang(kn),h4:lang(kn),h5:lang(kn),h6:lang(kn),h2:lang(ks),h3:lang(ks),h4:lang(ks),h5:lang(ks),h6:lang(ks),h2:lang(ml),h3:lang(ml),h4:lang(ml),h5:lang(ml),h6:lang(ml),h2:lang(mr),h3:lang(mr),h4:lang(mr),h5:lang(mr),h6:lang(mr),h2:lang(my),h3:lang(my),h4:lang(my),h5:lang(my),h6:lang(my),h2:lang(mai),h3:lang(mai),h4:lang(mai),h5:lang(mai),h6:lang(mai),h2:lang(ne),h3:lang(ne),h4:lang(ne),h5:lang(ne),h6:lang(ne),h2:lang(new),h3:lang(new),h4:lang(new),h5:lang(new),h6:lang(new),h2:lang(or),h3:lang(or),h4:lang(or),h5:lang(or),h6:lang(or),h2:lang(pa),h3:lang(pa),h4:lang(pa),h5:lang(pa),h6:lang(pa),h2:lang(pi),h3:lang(pi),h4:lang(pi),h5:lang(pi),h6:lang(pi),h2:lang(sa),h3:lang(sa),h4:lang(sa),h5:lang(sa),h6:lang(sa),h2:lang(ta),h3:lang(ta),h4:lang(ta),h5:lang(ta),h6:lang(ta),h2:lang(te),h3:lang(te),h4:lang(te),h5:lang(te),h6:lang(te){line-height:1.2em}  ol:lang(azb) li,ol:lang(bcc) li,ol:lang(bgn) li,ol:lang(bqi) li,ol:lang(fa) li,ol:lang(glk) li,ol:lang(kk-arab) li,ol:lang(lrc) li,ol:lang(luz) li,ol:lang(mzn) li{list-style-type:persian}ol:lang(ckb) li,ol:lang(sdh) li{list-style-type:arabic-indic}ol:lang(hi) li,ol:lang(mai) li,ol:lang(mr) li,ol:lang(ne) li{list-style-type:devanagari}ol:lang(as) li,ol:lang(bn) li{list-style-type:bengali}ol:lang(or) li{list-style-type:oriya}.toc ul{margin:0.3em 0}  .mw-content-ltr .toc ul,.mw-content-rtl .mw-content-ltr .toc ul{text-align:left} .mw-content-rtl .toc ul,.mw-content-ltr .mw-content-rtl .toc ul{text-align:right} .mw-content-ltr .toc ul ul,.mw-content-rtl .mw-content-ltr .toc ul ul{margin:0 0 0 2em} .mw-content-rtl .toc ul ul,.mw-content-ltr .mw-content-rtl .toc ul ul{margin:0 2em 0 0}.toc .toctitle{direction:ltr}#mw-clearyourcache,#mw-sitecsspreview,#mw-sitejspreview,#mw-usercsspreview,#mw-userjspreview{direction:ltr;unicode-bidi:embed}#mw-revision-info,#mw-revision-info-current,#mw-revision-nav{direction:ltr}  div.tright,div.floatright,table.floatright{clear:right;float:right} div.tleft,div.floatleft,table.floatleft{float:left;clear:left} #mw-credits a{unicode-bidi:embed} .printfooter{display:none} .xdebug-error{position:absolute;z-index:99}.mw-editsection{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none} .mw-editsection,.mw-editsection-like{font-size:small;font-weight:normal;margin-left:1em;vertical-align:baseline; line-height:1em}  .mw-content-ltr .mw-editsection,.mw-content-rtl .mw-content-ltr .mw-editsection{margin-left:1em} .mw-content-rtl .mw-editsection,.mw-content-ltr .mw-content-rtl .mw-editsection{margin-right:1em} sup,sub{line-height:1}}
.messagebox,.errorbox,.warningbox,.successbox{color:#000;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin-bottom:16px;border:1px solid;padding:12px 24px;word-wrap:break-word; overflow-wrap:break-word;overflow:hidden} .messagebox :only-child,.errorbox :only-child,.warningbox :only-child,.successbox :only-child{margin:0}.messagebox h2,.errorbox h2,.warningbox h2,.successbox h2{color:inherit;display:inline;margin:0 0.5em 0 0;border:0;font-size:1em;font-weight:bold}.messagebox{background-color:#eaecf0;border-color:#a2a9b1}.errorbox{background-color:#fee7e6;border-color:#d33}.warningbox{background-color:#fef6e7;border-color:#fc3}.successbox{background-color:#d5fdf4;border-color:#14866d}
.mw-wiki-logo{background-image:url(/images/casaguides_merged_logo.png?fe0db)}
@media print {
	.noprint, .catlinks,.magnify,.mw-cite-backlink,.mw-editsection,.mw-editsection-like,.mw-hidden-catlinks,.mw-indicators,.mw-redirectedfrom,.patrollink,.usermessage, #column-one,#footer-places,#mw-navigation,#siteNotice, #f-poweredbyico,#f-copyrightico,li#about,li#disclaimer,li#mobileview,li#privacy{display:none} body{background:#fff;color:#000;margin:0;padding:0} a{background:none !important; padding:0 !important; }a,a.external,a.new,a.stub{color:inherit !important; text-decoration:inherit !important; } .mw-parser-output a.external.text:after,.mw-parser-output a.external.autonumber:after{content:' (' attr(href) ')';word-break:break-all;word-wrap:break-word} .mw-parser-output a.external.text[href^='//']:after,.mw-parser-output a.external.autonumber[href^='//']:after{content:' (https:' attr(href) ')'}dt{font-weight:bold}h1,h2,h3,h4,h5,h6{font-weight:bold; page-break-after:avoid;page-break-before:avoid}p{margin:1em 0;line-height:1.2; orphans:3;widows:3}img,figure,.wikitable,.thumb{ page-break-inside:avoid}img{border:0;vertical-align:middle}pre,.mw-code{background:#fff;color:#000;border:1pt dashed #000;padding:1em;font-size:8pt;white-space:pre-wrap; overflow-x:hidden; word-wrap:break-word} sup,sub{line-height:1}ul{list-style-type:square} #globalWrapper{width:100% !important; min-width:0 !important; }.mw-body{background:#fff;color:#000;border:0 !important; padding:0 !important; margin:0 !important; direction:ltr}#column-content{margin:0 !important; }#column-content .mw-body{padding:1em;margin:0 !important; }.toc{background-color:#f9f9f9;border:1pt solid #aaa;padding:5px;display:table} .tocnumber,.toctext{display:table-cell} .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em} .mw-content-rtl .tocnumber{padding-left:0.5em;padding-right:0}  table.floatright,div.floatright,div.tright{float:right;clear:right} table.floatleft,div.floatleft,div.tleft{float:left;clear:left} div.tleft{margin:0.5em 1.4em 1.3em 0} div.tright{margin:0.5em 0 1.3em 1.4em} table.floatright,div.floatright{margin:0 0 0.5em 0.5em;border:0} table.floatleft,div.floatleft{margin:0 0.5em 0.5em 0;border:0}.center{text-align:center} div.thumb{background-color:transparent;width:auto}div.thumb a{border-bottom:0}div.thumbinner{background-color:#fff;border:0;border-radius:2px;padding:5px;font-size:10pt;color:#666;text-align:center; overflow:hidden;min-width:100px}html .thumbcaption{text-align:left;line-height:1.4;padding:3px}img.thumbborder{border:1pt solid #ddd}  .wikitable,.mw_metadata{background:#fff;margin:1em 0;border:1pt solid #aaa;border-collapse:collapse;font-size:10pt}.wikitable > caption,.mw_metadata caption{padding:5px;font-size:10pt}.wikitable > tr > th,.wikitable > tr > td,.wikitable > * > tr > th,.wikitable > * > tr > td,.mw_metadata th,.mw_metadata td{ background:#fff !important;  color:#000 !important; border:1pt solid #aaa;padding:0.4em 0.6em}.wikitable > tr > th,.wikitable > * > tr > th,.mw_metadata th{text-align:center}table.listing,table.listing td{border:1pt solid #000;border-collapse:collapse} .catlinks ul{display:inline;padding:0;list-style:none none}.catlinks li{display:inline-block;line-height:1.15;margin:0.1em 0;border-left:1pt solid #aaa;padding:0 0.4em}.catlinks li:first-child{border-left:0;padding-left:0.2em} .printfooter{padding:1em 0}#footer{background:#fff;color:#000;margin-top:1em;border-top:1pt solid #aaa;padding-top:5px;direction:ltr}}
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=monobook">
<meta name="generator" content="MediaWiki 1.35.2">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="CASA Guides (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://casaguides.nrao.edu/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="CASA Guides Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="canonical" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0">
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 rootpage-VLA_Radio_galaxy_3C_129_P-band_continuum_tutorial-CASA5_7_0 skin-monobook action-view" data-new-gr-c-s-check-loaded="14.1014.0" data-gr-ext-installed=""><div id="globalWrapper"><div id="column-content"><div id="content" class="mw-body" role="main"><a id="top"></a><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">Reduction of VLA Sky Survey Measurement Sets - CASA Guides</h1><div id="bodyContent" class="mw-body-content"><div id="siteSub">From CASA Guides</div><div id="contentSub" lang="en" dir="ltr"><span class="mw-redirectedfrom">(Redirected from <a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial&amp;redirect=no" class="mw-redirect" title="VLA Radio galaxy 3C 129: P-band continuum tutorial">VLA Radio galaxy 3C 129: P-band continuum tutorial</a>)</span></div><div id="jump-to-nav"></div><a href="#column-one" class="mw-jump-link">Jump to navigation</a><a href="#searchInput" class="mw-jump-link">Jump to search</a><!-- start content --><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p><br>
</p>
<p><b>This CASA Guide is for Version 5.7.0 of CASA.</b></p><p class="mw-empty-elt"></p> 
<p><b> Note: This guide may take up to 2-days to complete </b></p><p class="mw-empty-elt"></p> 
<p>If you are using a later version of CASA and this is the most recent available guide, then you should be able to use most, if not all, of this casaguide, as we try to limit script breaking changes in CASA development. 
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox" style=""></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Obtaining_the_raw_data"><span class="tocnumber">2</span> <span class="toctext">Obtaining the raw data</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Starting_CASA"><span class="tocnumber">3</span> <span class="toctext">Starting CASA</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Importing_the_raw_data_into_CASA"><span class="tocnumber">4</span> <span class="toctext">Importing the raw data into CASA</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Preliminary_data_inspection"><span class="tocnumber">5</span> <span class="toctext">Preliminary data inspection</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction"><span class="tocnumber">6</span> <span class="toctext">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Initial_data_editing"><span class="tocnumber">6.1</span> <span class="toctext">Initial data editing</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Dead_antennas"><span class="tocnumber">6.2</span> <span class="toctext">Dead antennas</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Hanning_smoothing"><span class="tocnumber">6.3</span> <span class="toctext">Hanning smoothing</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Antenna_Position_Corrections"><span class="tocnumber">6.4</span> <span class="toctext">Antenna Position Corrections</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Ionospheric_TEC_Corrections"><span class="tocnumber">6.5</span> <span class="toctext">Ionospheric TEC Corrections</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Requantizer_Gains"><span class="tocnumber">6.6</span> <span class="toctext">Requantizer Gains</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Automatic_flagging"><span class="tocnumber">7</span> <span class="toctext">Automatic flagging</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Absolute_Flux_Density_Calibration"><span class="tocnumber">8</span> <span class="toctext">Absolute Flux Density Calibration</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Delay_and_bandpass_calibration"><span class="tocnumber">9</span> <span class="toctext">Delay and bandpass calibration</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#Gain_calibration"><span class="tocnumber">10</span> <span class="toctext">Gain calibration</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#Transfer_of_calibrations_to_the_target_field"><span class="tocnumber">11</span> <span class="toctext">Transfer of calibrations to the target field</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Statwt"><span class="tocnumber">12</span> <span class="toctext">Statwt</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#Imaging"><span class="tocnumber">13</span> <span class="toctext">Imaging</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Self_Calibration"><span class="tocnumber">14</span> <span class="toctext">Self Calibration</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="#Appendix:_Some_P-band_data_issues_you_may_want_to_know_about"><span class="tocnumber">15</span> <span class="toctext">Appendix: Some P-band data issues you may want to know about</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#Polarization_labeling"><span class="tocnumber">15.1</span> <span class="toctext">Polarization labeling</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Swapped_polarizations"><span class="tocnumber">15.2</span> <span class="toctext">Swapped polarizations</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Double_data_descriptor_entries"><span class="tocnumber">15.3</span> <span class="toctext">Double data descriptor entries</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Continuous_Radio_Frequency_Interference_.28RFI.29"><span class="tocnumber">15.4</span> <span class="toctext">Continuous Radio Frequency Interference (RFI)</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Two_spectral_window_setup"><span class="tocnumber">15.5</span> <span class="toctext">Two spectral window setup</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Bandpass_ripples"><span class="tocnumber">15.6</span> <span class="toctext">Bandpass ripples</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#High_cross-polarization"><span class="tocnumber">15.7</span> <span class="toctext">High cross-polarization</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Instrumental_Polarization_Calibration"><span class="tocnumber">15.8</span> <span class="toctext">Instrumental Polarization Calibration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#Useful_links"><span class="tocnumber">16</span> <span class="toctext">Useful links</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>This webpage provides a basic description on how to use CASA to reduce data from the upper part of the new VLA low-band system, also known as P-band, covering roughly 220-480 MHz. The goal is to make a wide-field continuum stokes I image of a typical blank field using the full effective bandwidth. The dataset that will be downloaded in this guide has a size of 26.46 GB and will require a total of ~140 GB of disk space if all generated files are kept. 
</p><p><i>Note: Starting with CASA 5.0 IPython 5.1.0 is used for interactive CASA sessions. This does not allow to readily paste and execute multiple lines of code like in previous versions of the interpreter. If this is needed at any point in this tutorial, we use "%cpaste" to allow the copy/paste of loops, conditions, etc.. Press "Enter" (or "Return") after "--" at the end, this stops (or exits) the copy/paste prompt and will return you to the CASA prompt.</i>
</p>
<h2><span class="mw-headline" id="Obtaining_the_raw_data">Obtaining the raw data</span></h2>
<p>For this guide, we'll use some test data that was taken in B-configuration. To get a copy of the raw data, download <a rel="nofollow" class="external text" href="https://casa.nrao.edu/Data/EVLA/Pband/P_band_3C129.tgz">P_band_3C129.tgz</a> onto your computer running CASA and untar it (i.e. <i>tar -zxvf &lt;filename&gt;</i>).
</p><p><br>
Alternatively, the raw data can also be obtained from the NRAO archive, go to the <a rel="nofollow" class="external text" href="https://archive.nrao.edu/archive/advquery.jsp">NRAO advance archive query page</a>, and enter the following search parameter in the field <i>Archive File ID</i> (leave the rest on default):
</p>
<div style="text-align:justify;">
<pre style="background-color: #gray;">imag-test-copy.57080.956837025464
</pre>
</div>
<p>The search should return a single row for Archive File: imag-test-copy.57080.956837025464, taken on Feb. 27, 2015 (or "15-Feb-27 22:57:52"). Check the box next to it. Next, fill in your email and select the "SDM-BDF dataset (all files)" option. Note, you may find it easier to download a tar file, in which case, you'll want to check the box for Create MS or SDM tar file. Click "Get My Data" and follow the on-screen prompts to reach the next page, where you should click "Retrieve over internet". The next page should report that the data staging is in progress. Wait until you receive an e-mail reporting that your archive data is copied, which should take a few minutes. Download the data onto your computer running CASA and untar it (i.e. <i>tar -xvf &lt;filename&gt;</i>).
</p>
<h2><span class="mw-headline" id="Starting_CASA">Starting CASA</span></h2>
<p>Start CASA by typing 
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>casa -r <span class="m">5</span>.7.0-134
</pre></div>
<p>on the (linux) command line. This should start a CASA 5.7.0 interactive python (iPython) session, and open a separate log window. The CASA version is reported at startup, both in the python session and the log window.
</p>
<h2><span class="mw-headline" id="Importing_the_raw_data_into_CASA">Importing the raw data into CASA</span></h2>
<p>We will begin by importing our data into the measurement set format (CASA standard) from the binary format (SDM-BDF) as downloaded from the archive. We do this by means of the importasdm task. It is important to note that the importevla task has been deprecated.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">importasdm</span><span class="p">(</span><span class="n">asdm</span><span class="o">=</span><span class="s1">'imag-test-copy.57080.956837025464'</span><span class="p">,</span> <span class="n">vis</span> <span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">savecmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">)</span>
</pre></div>
<p>This task calls the external tool <i>asdm2MS</i> to perform the conversion. Together with the visibility data, also the flag commands from the VLA online system are imported. These flags are not directly applied, but stored in the <i>importflags.txt</i> file and applied later.
</p>
<h2><span class="mw-headline" id="Preliminary_data_inspection">Preliminary data inspection</span></h2>
<p>Inspect the observation set up with the <i>listobs</i> task. The following command will save the output to a file. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">listfile</span> <span class="o">=</span> <span class="s1">'3C129.listobs'</span><span class="p">)</span>
</pre></div>
<p>Alternatively, you can also output to the logger by running the command without the listfile argument. The sample listobs output shown has flag <i>verbose=False</i> for the sake of brevity.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">listobs</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<pre style="background-color: #fffacd;">================================================================================
           MeasurementSet Name:  /lustre/aoc/sciops/fschinze/P_band_tutorial/3C129.ms      MS Version 2
================================================================================
   Observer:      Project: uid://evla/sdm/X2
Observation: EVLA(27 antennas)
Data records: 4714983       Total elapsed time = 1422 seconds
   Observed from   27-Feb-2015/22:57:54.0   to   27-Feb-2015/23:21:36.0 (UTC)

Fields: 2
  ID   Code Name                RA               Decl           Epoch   SrcId      nRows
  0    NONE 3C147               05:42:36.127300 +49.51.07.17800 J2000   0        1307124
  1    NONE 3C129               04:48:58.200000 +45.02.01.00000 J2000   1        3407859
Spectral Windows:  (19 unique spectral windows and 1 unique polarization setups)
  SpwID  Name           #Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs
  0      EVLA_P#A0C0#0     128   TOPO     224.000       125.000     16000.0    231.9375       12  XX  XY  YX  YY
  1      EVLA_P#A0C0#1     128   TOPO     240.000       125.000     16000.0    247.9375       12  XX  XY  YX  YY
  2      EVLA_P#A0C0#2     128   TOPO     256.000       125.000     16000.0    263.9375       12  XX  XY  YX  YY
  3      EVLA_P#A0C0#3     128   TOPO     272.000       125.000     16000.0    279.9375       12  XX  XY  YX  YY
  4      EVLA_P#A0C0#4     128   TOPO     288.000       125.000     16000.0    295.9375       12  XX  XY  YX  YY
  5      EVLA_P#A0C0#5     128   TOPO     304.000       125.000     16000.0    311.9375       12  XX  XY  YX  YY
  6      EVLA_P#A0C0#6     128   TOPO     320.000       125.000     16000.0    327.9375       12  XX  XY  YX  YY
  7      EVLA_P#A0C0#7     128   TOPO     336.000       125.000     16000.0    343.9375       12  XX  XY  YX  YY
  8      EVLA_P#A0C0#8     128   TOPO     352.000       125.000     16000.0    359.9375       12  XX  XY  YX  YY
  9      EVLA_P#A0C0#9     128   TOPO     368.000       125.000     16000.0    375.9375       12  XX  XY  YX  YY
  10     EVLA_P#A0C0#10    128   TOPO     384.000       125.000     16000.0    391.9375       12  XX  XY  YX  YY
  11     EVLA_P#A0C0#11    128   TOPO     400.000       125.000     16000.0    407.9375       12  XX  XY  YX  YY
  12     EVLA_P#A0C0#12    128   TOPO     416.000       125.000     16000.0    423.9375       12  XX  XY  YX  YY
  13     EVLA_P#A0C0#13    128   TOPO     432.000       125.000     16000.0    439.9375       12  XX  XY  YX  YY
  14     EVLA_P#A0C0#14    128   TOPO     448.000       125.000     16000.0    455.9375       12  XX  XY  YX  YY
  15     EVLA_P#A0C0#15    128   TOPO     464.000       125.000     16000.0    471.9375       12  XX  XY  YX  YY
  16     EVLA_P#B0D0#16     64   TOPO     310.000       500.000     32000.0    325.7500       15  XX  XY  YX  YY
  17     EVLA_P#B0D0#17   1024   TOPO     310.000        62.500     64000.0    341.9688       15  XX  XY  YX  YY
  18     EVLA_P#B0D0#18     64   TOPO     342.000       500.000     32000.0    357.7500       15  XX  XY  YX  YY
Antennas: 27 'name'='station'
   ID=   0-3: 'ea01'='N12', 'ea02'='N16', 'ea03'='W28', 'ea05'='E20',
   ID=   4-7: 'ea06'='N20', 'ea07'='N32', 'ea08'='E28', 'ea09'='W08',
   ID=  8-11: 'ea10'='E36', 'ea11'='W12', 'ea12'='N36', 'ea13'='W04',
   ID= 12-15: 'ea14'='E08', 'ea15'='E24', 'ea16'='W24', 'ea17'='E04',
   ID= 16-19: 'ea18'='W36', 'ea19'='MAS', 'ea20'='N04', 'ea21'='E32',
   ID= 20-23: 'ea22'='N24', 'ea23'='E16', 'ea24'='W32', 'ea25'='W20',
   ID= 24-26: 'ea26'='E12', 'ea27'='N08', 'ea28'='N28'
 
</pre>
<p>You can inspect the output text file <i>3C129.listobs</i> in your favorite text editor (e.g., <i>gedit</i>). When taking some time to familiarize yourself with the output format, you will see that:
</p>
<ul><li>The observation consists of 5 scans, namely:</li></ul>
<ol><li>3C147 (hardware setup)</li>
<li>3C147 (setting requantizers)</li>
<li>3C147 (primary calibrator)</li>
<li>3C129 (target)</li>
<li>3C129 (target)</li></ol>
<ul><li>The frequency coverage is 222 - 478 MHz, divided into 16 x 16 MHz spectral windows, each having 128 x 0.125 MHz channels. There are also two spectral windows with 64x0.5 MHz and one spectral window with 1024x0.0625 MHz.</li>
<li>Visibilities are recorded every 2 seconds in full polarization (4 polarization products labelled XX,XY,YX,YY).</li>
<li>Of the 28 VLA antennas labelled ea01 - ea028, antenna ea04 is not participating in this observation.</li>
<li>Source, antenna and spectral window IDs start at zero, but scan IDs start at one.</li></ul>
<p><br>
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_plotants.png" class="image"><img alt="" src="/images/thumb/7/77/3C129_pband_plotants.png/200px-3C129_pband_plotants.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/7/77/3C129_pband_plotants.png/300px-3C129_pband_plotants.png 1.5x, /images/thumb/7/77/3C129_pband_plotants.png/400px-3C129_pband_plotants.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_plotants.png" class="internal" title="Enlarge"></a></div>Figure 1: Plotants() figure showing configuration of the antennas in the array.</div></div></div> 
<p>The array configuration can be inspected using:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotants</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">figfile</span><span class="o">=</span><span class="s1">'3C129_pband_plotants.png'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span id="Initial_processing_steps_-_Hanning_smoothing,_Antenna_Position,_Requantizer_Gain,_Ionospheric_Correction"></span><span class="mw-headline" id="Initial_processing_steps_-_Hanning_smoothing.2C_Antenna_Position.2C_Requantizer_Gain.2C_Ionospheric_Correction">Initial processing steps - Hanning smoothing, Antenna Position, Requantizer Gain, Ionospheric Correction</span></h2>
<h3><span class="mw-headline" id="Initial_data_editing">Initial data editing</span></h3>
<p>When importing the data, we saved the flags from the online system to an ASCII text file. This gives us the opportunity to review the flag commands before applying them. For our data set, the flag file is called <i>importflags.txt</i>. Open this file with your favorite text editor. The bulk of the flag commands refer to times when the VLA is slewing (<i>ANTENNA_NOT_ON_SOURCE</i>) or when the movable secondary reflector of the VLA's Cassegrain system is not in place (<i>SUBREFLECTOR_ERROR</i>). The latter can cause antenna gain variations (amplitude and phase), so it is safest to apply all the flags. In order to remove visibilities that are pure zero, and flag antennas that are partly blocked by other antennas (shadowing), which occurs mostly in compact configurations when observing along a VLA arm, two lines need to be appended to <i>importflags.txt</i>. These are:
</p>
<pre>mode='clip' clipzeros=True
mode='shadow' tolerance=0.0
</pre>
<p>After this, execute in CASA:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'list'</span><span class="p">,</span> <span class="n">inpfile</span><span class="o">=</span><span class="s1">'importflags.txt'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">'any'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>This call, before applying the new flags to the data, created a new flagbackup file called flagdata_1 which can be used by the task <i>flagmanager</i> to restore the state of the measurement set prior applying the flags from <i>importflags.txt</i>.
</p>
<h3><span class="mw-headline" id="Dead_antennas">Dead antennas</span></h3><p>
It is important to identify dead antennas / polarizations early on, so we can exclude them from further data processing. A convenient way of doing this is through the <i>plotms</i> task on bright calibrator(s) (see the <i>listobs()</i> output), in our case 3C147 (see Fig. 2a).</p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="image"><img alt="" src="/images/thumb/6/63/3C129_pband_3C147_prebp.png/200px-3C129_pband_3C147_prebp.png" decoding="async" width="200" height="124" class="thumbimage" srcset="/images/thumb/6/63/3C129_pband_3C147_prebp.png/300px-3C129_pband_3C147_prebp.png 1.5x, /images/thumb/6/63/3C129_pband_3C147_prebp.png/400px-3C129_pband_3C147_prebp.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_pband_3C147_prebp.png" class="internal" title="Enlarge"></a></div>Figure 2a: <i>plotms</i> output before RFI flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> 
           <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span><span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> 
           <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp.png'</span><span class="p">)</span>
</pre></div>
<p>This will load the <i>plotms</i> window that will iterate over all the baselines to antenna ea01. The plot will display the amplitude vs frequency plot with the colors representing the different spectral windows. Note that we are only plotting the XX and YY correlation here. This is because we expect most of the power in the linear cross correlation products to be in these two correlations. Notice that some spectral windows in particular are badly affected due to radio frequency interference (RFI). This is the issue that we will deal with after identifying dead antennas. If you page through the baselines using the green forward button in the <i>plotms</i> viewer, you will notice that the amplitude is particularly low when you encounter ea19. If we create a quick plot of the baselines to ea19 (put <i>ea19</i> in the antenna field), we can see that there is no power in any of the polarizations. This indicates that this antenna was dead and should be flagged. It is also good to check for high power levels in cross-hand correlations in comparison to the parallel-hand correlations, which would uncover swapped polarization labels and severely mis-aligned dipoles. At the end of this tutorial we provide some hints on solving for swapped or mislabeled dipole polarizations. In addition to the dead antenna, we also make sure that the first two scans are flagged, which were not labelled as setup scans but were used to set the attenuators and requantizers udring the observations.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea19'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'manual'</span><span class="p">,</span><span class="n">scan</span><span class="o">=</span><span class="s1">'1~2'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Hanning_smoothing">Hanning smoothing</span></h3><p>
During the data inspection above, we also notice sharp RFI peaks. Often this is due to Gibbs ringing (Gibbs phenomenon), and to prevent this phenomenon it is best to Hanning smooth the data at this juncture. The default P-band setup contains 16x16 MHz spectral windows. For Hanning smoothing we will select the first 16 spectral windows. This will also make the hanning smoothed dataset smaller and faster to process. Now is a good time to get a cup of coffee while the task is hanning smoothing the data. </p><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/200px-Prebp_hanning_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/300px-Prebp_hanning_casa_5.5.0.png 1.5x, /images/thumb/0/02/Prebp_hanning_casa_5.5.0.png/400px-Prebp_hanning_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prebp_hanning_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 2b: <i>plotms</i> output after Hanning smooth and first flagging.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">hanningsmooth</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">,</span><span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span><span class="n">spw</span><span class="o">=</span><span class="s1">'0~15'</span><span class="p">)</span>
</pre></div>
<p>Once the task is finished we should replot the primary calibrator to see the effect of hanning smoothing on the data and the RFI (Fig. 2b). 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning.png'</span><span class="p">)</span>
</pre></div>
<h3><span class="mw-headline" id="Antenna_Position_Corrections">Antenna Position Corrections</span></h3>
<p>It is always a good idea to check if the antenna position offsets need corrections. Antenna positional errors translate to an error in the measured visibilities and, if present, they need to be accounted for before we proceed with any of the other calibration steps. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'antpos'</span><span class="p">)</span>
</pre></div>
<p>The logger output shows that there are 13 antennas with positional offsets: 
</p>
<pre>
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea03&nbsp;:  0.00290   0.00000   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea08&nbsp;:  0.00000   0.00390   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea10&nbsp;: -0.00170   0.00000   0.00400
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea11&nbsp;:  0.00000   0.00160  -0.00170
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea13&nbsp;:  0.00000   0.00050   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea16&nbsp;: -0.00180   0.00680   0.00230
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea18&nbsp;:  0.00470   0.00350   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea21&nbsp;: -0.00160   0.00000   0.00210
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea23&nbsp;:  0.00140   0.00200  -0.00150
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea24&nbsp;:  0.00380   0.00000  -0.00340
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea25&nbsp;:  0.00330   0.00000  -0.00110
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea26&nbsp;:  0.00000   0.00190   0.00000
2016-11-28 22:51:37 INFO gencal	offsets for antenna ea27&nbsp;: -0.00120   0.00070   0.00000


</pre>
<h3><span class="mw-headline" id="Ionospheric_TEC_Corrections">Ionospheric TEC Corrections</span></h3>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="image"><img alt="" src="/images/thumb/9/95/Pband_vla_tecu_new.png/200px-Pband_vla_tecu_new.png" decoding="async" width="200" height="151" class="thumbimage" srcset="/images/thumb/9/95/Pband_vla_tecu_new.png/300px-Pband_vla_tecu_new.png 1.5x, /images/thumb/9/95/Pband_vla_tecu_new.png/400px-Pband_vla_tecu_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_vla_tecu_new.png" class="internal" title="Enlarge"></a></div>Figure 3: TEC value (in units of TEC/m^2) vs time generated by <i>tec_maps.create()</i></div></div></div> 
<p>Low frequency observations are affected by the ionosphere. A delay in the signal path is introduced between the two polarization of light that varies both as a function of time and line of sight (direction dependent). The delay is proportional to the Total Electron Content (TEC) along the line of sight (TEC), and is inversely proportional to the square of the frequency (1/^2). GPS measurements at two different frequencies provide us with an estimate of the TEC per square meter. This correction has been implemented in CASA which we shall apply as a calibration table with the <i>gencal</i> task. The task requires a TEC map that we will generate with CASA recipes. For more information, see the section on <a rel="nofollow" class="external text" href="https://casa.nrao.edu/casadocs/casa-5.0.0/synthesis-calibration/preparing-for-calibration/#title5">ionospheric corrections</a> in the CASA documentation archives. For some versions of CASA, the first plot to the right (Figure 3) may not be generated if you have already run plotants: to generate this plot, you will need to restart CASA. If the IONEX data file was not downloaded, you might be missing the curl package in the environment you are running CASA in. In such a case you can provide the required file manually by downloading: <a rel="nofollow" class="external free" href="ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z">ftp://cddis.gsfc.nasa.gov/gnss/products/ionex/2015/058/igsg0580.15i.Z</a> (for the tutorial it is also also available in an unzipped version <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/igsg0580.15i">here</a>), unziping it, and placing it in the directory from which you started CASA. The current implementation in CASA is in the development stage, however since the CASA 5.0 release both the Faraday rotation correction and dispersive delay corrections for the ionosphere are enabled. In previous releases only Faraday rotation corrections are enabled. In this example we will generate the calibration table and apply it throughout calibration. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="kn">from</span> <span class="nn">recipes</span> <span class="kn">import</span> <span class="n">tec_maps</span>
<span class="c1">#</span>
<span class="n">tec_image</span><span class="p">,</span> <span class="n">tec_rms_image</span><span class="p">,</span> <span class="n">plotname</span> <span class="o">=</span> <span class="n">tec_maps</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">doplot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#[NOTE: If you are using CASA 5.0.0, or earlier this should be: tec_image, tec_rms_image = tec_maps.create(vis='3C129_pband.ms', doplot=True)]</span>
<span class="c1">#</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'tecim'</span><span class="p">,</span><span class="n">infile</span><span class="o">=</span><span class="n">tec_image</span><span class="p">)</span>
<span class="c1"># Spatial plots like shown in Figure 4 can be looked at using the CASA viewer for the TEC values</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_TEC.im'</span><span class="p">)</span>
<span class="c1"># and for TEC rms</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_pband.ms.IGS_RMS_TEC.im'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Pband_tec_new.png" class="image"><img alt="" src="/images/thumb/d/db/Pband_tec_new.png/200px-Pband_tec_new.png" decoding="async" width="200" height="121" class="thumbimage" srcset="/images/thumb/d/db/Pband_tec_new.png/300px-Pband_tec_new.png 1.5x, /images/thumb/d/db/Pband_tec_new.png/400px-Pband_tec_new.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Pband_tec_new.png" class="internal" title="Enlarge"></a></div>Figure 4: TEC map movie generated by the TEC tasks.</div></div></div> 
<p>A word of caution regarding the TEC map generation: the IGS website updates measurements only two weeks after the date of observation.
</p>
<h3><span class="mw-headline" id="Requantizer_Gains">Requantizer Gains</span></h3>
<p>The next step will correct the visibility amplitudes for the signal leveling (requantizer gains) that occurs at the inputs of the WIDAR correlator. These levels (per antenna, per polarization, per spectral window) are stored with the measurement set (in the <i>SYSPOWER</i> sub-table). This step is currently not essential, since the levels get set only once at the start of an observation and bandpass calibration will correct for this. But it will make your bandpass plots look better if you have multiple spectral windows. And, more importantly, in general it is possible to trigger the setting of requantizers throughout an observation. This is the case for new observations, when a P-band scan is preceded by a P-band setup scan, which itself is preceded by a scan with a different telescope configuration.  
</p><p>The correction is done by means of the <i>gencal</i> task, where information in the <i>SYSPOWER</i> sub-table gets translated into a gain table. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gencal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">caltype</span><span class="o">=</span><span class="s1">'rq'</span><span class="p">,</span><span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.rq'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Automatic_flagging">Automatic flagging</span></h2>
<p>It is worthwhile noting at this juncture that the standard P-band setup will ensure that the worst of the RFI is restricted to four of the spectral windows. This particular dataset is an example of higher than average levels of RFI across the band. Before throwing away bad spectral windows by hand, we'll let the automated flaggers in CASA have a go at it.  The main task for this is <i>flagdata()</i>. While working on your data, <i>flagdata()</i> produces an abundance of output, not all of which is easy to understand. To help with this, we can get the flag status of our data before and after auto-flagging by running <i>flagdata()</i> in the <i>summary</i> mode. This first call provides the flag statistics of the flagging up to now, before any auto-flagging:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">summary_1</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
</pre></div>
<p>This returns a python dictionary with flagged versus total visibilities along various axes (antenna, scan, spw, field, correlation, etc.). For example, if we want to know the percentage flagged per scan, run the following (note that the scans may not appear in sorted order):
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
</pre></div>
<p>For this example, you will notice that scans 1 and 2 (the dummy scans on 3C147) are 100 percent flagged, which is what we did during the initial flagging.
</p><p>We will run <i>flagdata()</i> in the <i>TFCROP</i> mode, which will (per scan, per baseline, per spectral window, per polarization) look for visibility amplitude outliers. It uses a 5-piece polynomial in an attempt to remove any intrinsic bandpass (amplitude) structure (we did not calibrate for bandpass yet). We run the task twice to allow for slightly deeper flagging and separate treatment of the parallel and cross-hand correlations. For the first run, we tell CASA to make a backup of our visibility flag status up to here, giving us an option to restore them if we choose over-aggresive flagging parameters and consequently over-flag our data. The flag backup file name is reported in the log window, and can be found in the <i>3C129_pband.ms.flagversions</i> directory.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XY,ABS_YX'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'tfcrop'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timecutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">freqcutoff</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">maxnpieces</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">'report'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">,</span> <span class="n">correlation</span><span class="o">=</span><span class="s1">'ABS_XX,ABS_YY'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<p>As a note of caution: When executing flagdata with <i>mode='extend'</i>, all flags that were ever applied to the dataset will get extended. Repeat execution of this command will incrementally flag more and more around already flagged data.
</p><p>Let's get another flag summary to see how much extra data was flagged: 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">summary_2</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1"># </span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_1</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C129_pband_3C147_prebp_hanning_automatic.png'</span><span class="p">)</span>
</pre></div>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/200px-Prbp_tfcropped_casa_5.5.0.png" decoding="async" width="200" height="149" class="thumbimage" srcset="/images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/300px-Prbp_tfcropped_casa_5.5.0.png 1.5x, /images/thumb/3/3f/Prbp_tfcropped_casa_5.5.0.png/400px-Prbp_tfcropped_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Prbp_tfcropped_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5a: <i>plotms</i> output after RFI flagging with tfcrop</div></div></div>
<p>There is quite a bit of RFI that gets missed in RFI-rich spectral windows as can be seen in Fig. 5a. The solution to this is to provide the flagging routines with more contrast between healthy and affected data. For this, we will perform a preliminary bandpass calibration to take out the bandpass shape. We will do some coarse preliminary calibration and apply it to the calibrator before flagging for RFI once more.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'int'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">bandpass</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B0'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span><span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">])</span>
<span class="c1">#</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span>
  <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.G0'</span><span class="p">,</span><span class="s1">'3C129_pband.K0'</span><span class="p">,</span><span class="s1">'3C129_pband.B0'</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
<p>On the command line you should see a notification stating: "FJones (iononsphere) apply now provisionally includes disp. delay." which indicates that both Faraday rotation as well as dispersive delay corrections for the ionosphere are applied.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/200px-Postbandpass_rflag_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/300px-Postbandpass_rflag_casa_5.5.0.png 1.5x, /images/thumb/8/8c/Postbandpass_rflag_casa_5.5.0.png/400px-Postbandpass_rflag_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Postbandpass_rflag_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 5b: <i>plotms</i> output after RFI flagging with <i>mode='rflag'</i></div></div></div>
<p>We will now flag the corrected data column that contains the coarsely calibrated visibilities which provide better contrast to the flagging algorithms to remove the RFI present.  We will begin by running the <i>RFLAG</i> algorithm in the task <i>flagdata</i>. We will again use summary mode to see how much more of the observed data was flagged.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">timedevscale</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">freqdevscale</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span>
  <span class="n">action</span><span class="o">=</span><span class="s1">'apply'</span><span class="p">,</span>  <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">combinescans</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ntime</span><span class="o">=</span><span class="s1">'3600s'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">summary_3</span> <span class="o">=</span> <span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span> <span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'summary'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="o">%</span><span class="n">cpaste</span>

<span class="c1"># Press Enter or Return, then copy/paste the following:</span>
<span class="n">axis</span> <span class="o">=</span> <span class="s1">'scan'</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">summary_3</span><span class="p">[</span> <span class="n">axis</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
  <span class="n">old_stats</span> <span class="o">=</span> <span class="n">summary_2</span><span class="p">[</span> <span class="n">axis</span> <span class="p">][</span> <span class="n">value</span> <span class="p">]</span>
  <span class="k">print</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="si">%5.1f</span><span class="s1"> percent flagged additionally'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="o">-</span> <span class="n">old_stats</span><span class="p">[</span> <span class="s1">'flagged'</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span> <span class="s1">'total'</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">--</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span><span class="n">antenna</span><span class="o">=</span><span class="s1">'ea01'</span><span class="p">,</span><span class="n">correlation</span><span class="o">=</span><span class="s1">'XX,YY'</span><span class="p">,</span>
           <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span> <span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Frequency'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Amplitude'</span><span class="p">,</span>
           <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'baseline'</span><span class="p">,</span> <span class="n">plotfile</span><span class="o">=</span><span class="s1">'3C147_postbandpass_rflag.png'</span><span class="p">,</span> <span class="n">ydatacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">)</span>
</pre></div>
<p>Taking another visual look at the data using <i>plotms</i>, we examine the effect of the automated flagging on the calibrator (Fig. 5b). We find that most spectral windows are RFI free and that about 37% of the data was flagged. We typically expect between 40-60% of flagging due to interference in a significant fraction of the band. In this example, a more careful RFI flagging approach is likely to recover more usable spectrum.
</p>
<h2><span class="mw-headline" id="Absolute_Flux_Density_Calibration">Absolute Flux Density Calibration</span></h2>
<p>Our flagging has cleaned up most of the stray RFI across the band. This allows us to proceed with the actual calibration of the data. Before we get to the calibration tables, it's essential to do the flux density calibration of our calibrator 3C147. This is done by the <i>setjy</i> task. Before we run the task we first clear the preliminary calibration that was carried out to enable better flagging. We do that by running the <i>clearcal</i> task.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">clearcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">)</span>
</pre></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">setjy</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">standard</span><span class="o">=</span><span class="s1">'Scaife-Heald 2012'</span><span class="p">)</span>
</pre></div>
<p><br>
</p>
<h2><span class="mw-headline" id="Delay_and_bandpass_calibration">Delay and bandpass calibration</span></h2>
<p>First, we use the full bandwidth on a single scan on the primary calibrator to determine a single delay per antenna, per polarization. This will determine a single (approximate) phase slope across frequency, mainly caused by propagation effects in the (time-variable) ionosphere, cable length differences, and electronics in the signal paths from antenna feeds to correlator. Note that for a single short (5-10 minutes) scan on the calibrator, we can get away with solving for a time-invariant delay per antenna, per polarization. We will use scan 3 on 3C147.
</p>
<div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="image"><img alt="" src="/images/thumb/1/1a/Delays_casa_5.5.0.png/200px-Delays_casa_5.5.0.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/1/1a/Delays_casa_5.5.0.png/300px-Delays_casa_5.5.0.png 1.5x, /images/thumb/1/1a/Delays_casa_5.5.0.png/400px-Delays_casa_5.5.0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Delays_casa_5.5.0.png" class="internal" title="Enlarge"></a></div>Figure 6: Initial per antenna delays derived by <i>gaincal</i>.</div></div></div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'K'</span><span class="p">,</span>
   <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">],</span><span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s1">'antenna1'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'delay'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="o">-</span><span class="mf">50.</span><span class="p">,</span><span class="mf">50.</span><span class="p">])</span>
</pre></div>
<p>Since we picked ea09 as our reference antenna, the delays for this antenna ID are arbitrarily set to zero. All other delays should be within 30 nanosec or so (which they should be for this data set; Fig. 6). Larger values, which you can see if you do not force the plotrange, should be treated with suspicion, indicating a problem with the antenna or polarization. We will use the bandpass calibration to verify this in the next step.
</p><p>To determine the bandpass calibration, we use the same source and scan and apply the delay calibration before solving for the bandpass. Note that we request a minimum SNR of 3, which will make the solve fail for the worst, but not all, channels.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>After solving, we inspect the bandpass calibration amplitudes and phase, and flag any obvious residual outliers. Outliers may be found above or below the average bandpass curves, and tend to arise in the same channel (frequency) ranges for all antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'freq'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Note that the bandpass amplitudes (Fig. 7a) and phases (Fig. 7b) may differ between polarizations of the same antenna. The bandpass phases across frequency should not have an overall gradient (this should be removed by the delay calibration), but they may wrap around from +/-180 to -/+180 degrees. If that is problematic, re-run the phase <i>plotms</i> with <i>plotrange = [ 200.,500.,0.,360. ]</i>. Also note that there are no bandpass solutions for antennas ea19 and ea28, and only a few solutions for ea14.
</p><p>Don't spend more than 1 minute per antenna to find and flag the outliers in this tutorial and don't worry about missing some bad points; these bad channels will likely get flagged in a later stage anyway. We don't set the scale for plotting the bandpass amplitudes, which is convenient when flagging outliers as it will auto-rescale. While plotting the bandpass phases we do fix the scale, as it provides a better feeling for the relevant magnitude of phase outliers. Flagging of outliers is done using the <i>Mark Region</i> and <i>Flag</i> buttons. For more information on interactive flagging, see the topical guide <a rel="nofollow" class="external text" href="http://casaguides.nrao.edu/index.php/VLA_CASA_Flagging">Flagging VLA Data in CASA</a>. We are using this mechanism to efficiently flag data manually, since it is done per antenna rather than per baseline. These 'flags' will not be permanent until we call <i>applycal</i> later on, but are effective while applying the calibration on the fly, as we will do in subsequent calibration steps.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="image"><img alt="" src="/images/thumb/6/67/Initial_bp_amp_casa550.png/200px-Initial_bp_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/6/67/Initial_bp_amp_casa550.png/300px-Initial_bp_amp_casa550.png 1.5x, /images/thumb/6/67/Initial_bp_amp_casa550.png/400px-Initial_bp_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7a: Initial bandpass amplitudes for antenna ea01 after manually flagging the outliers and bad data points (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="image"><img alt="" src="/images/thumb/9/9a/Initial_bp_phase_casa550.png/200px-Initial_bp_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/9/9a/Initial_bp_phase_casa550.png/300px-Initial_bp_phase_casa550.png 1.5x, /images/thumb/9/9a/Initial_bp_phase_casa550.png/400px-Initial_bp_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Initial_bp_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 7b: Initial bandpass phase for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Gain_calibration">Gain calibration</span></h2>
<p>With the delay and bandpass calibration in place, we will now look more closely at the time-variable behavior of the VLA. We use the same scan on our primary calibrator, 3C147, over the full effective bandwidth to determine gain calibrations: one complex value per antenna, per polarization, per integration time. The delay and bandpass tables are applied on the fly.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C147'</span><span class="p">,</span> <span class="n">solint</span> <span class="o">=</span> <span class="s1">'int'</span><span class="p">,</span>
             <span class="n">refant</span> <span class="o">=</span> <span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span> <span class="o">=</span> <span class="s1">'G'</span><span class="p">,</span> <span class="n">calmode</span> <span class="o">=</span> <span class="s1">'ap'</span><span class="p">,</span>
             <span class="n">gaintable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span><span class="s1">'3C129_pband.tecim'</span><span class="p">,</span> <span class="s1">'3C129_pband.K1'</span><span class="p">,</span> <span class="s1">'3C129_pband.B1'</span> <span class="p">],</span>
             <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span> <span class="p">],</span> <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
</pre></div>
<p>Again, the solutions should be inspected for any outliers. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">],</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<p>Similar to the bandpass flagging, we will flag outlier gain solutions in both amplitude and phase. For the amplitudes, the final scatter around an average close to one should be a few percent (see Fig. 8a,b). Note antennas ea08, ea09 have particularly noisy solutions. Remember that the gain solutions for both polarizations can be flagged together, as we will lose the equivalent data of the surviving polarization anyway.
</p><p>Note that when plotting gains against time, it is convenient to use auto-scaling of the time axis by putting <i>None</i> in the first two fields of <i>plotrange</i>.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_amp_casa550.png" class="image"><img alt="" src="/images/thumb/5/5d/Gain_amp_casa550.png/200px-Gain_amp_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/5/5d/Gain_amp_casa550.png/300px-Gain_amp_casa550.png 1.5x, /images/thumb/5/5d/Gain_amp_casa550.png/400px-Gain_amp_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_amp_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8a: Initial gain amplitude solutions for antenna ea01 after manually flagging the outlier solutions (within <i>plotms</i>).</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:Gain_phase_casa550.png" class="image"><img alt="" src="/images/thumb/3/3e/Gain_phase_casa550.png/200px-Gain_phase_casa550.png" decoding="async" width="200" height="157" class="thumbimage" srcset="/images/thumb/3/3e/Gain_phase_casa550.png/300px-Gain_phase_casa550.png 1.5x, /images/thumb/3/3e/Gain_phase_casa550.png/400px-Gain_phase_casa550.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:Gain_phase_casa550.png" class="internal" title="Enlarge"></a></div>Figure 8b: Initial gain phase solutions for antenna ea01.</div></div></div>
</td></tr></tbody></table>
<p><br>
Next, we will prepare a smoothed and interpolated version of the gain calibration table, which will be applied later to the target field data. This prevents flagging of target field data when one of the edges of a calibrator scan is flagged for one or more antennas. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">smoothcal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">tablein</span><span class="o">=</span><span class="s1">'3C129_pband.G1'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">smoothtype</span><span class="o">=</span><span class="s1">'median'</span><span class="p">,</span> <span class="n">smoothtime</span> <span class="o">=</span> <span class="mf">60.</span><span class="o">*</span><span class="mf">60.</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'amp'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plotms</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s1">'phase'</span><span class="p">,</span> <span class="n">iteraxis</span><span class="o">=</span><span class="s1">'antenna'</span><span class="p">,</span><span class="n">plotrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.</span> <span class="p">],</span><span class="n">coloraxis</span><span class="o">=</span><span class="s1">'spw'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Transfer_of_calibrations_to_the_target_field">Transfer of calibrations to the target field</span></h2>
<p>So far we have used one scan on the primary calibrator 3C147 to derive various calibration tables. These calibrations will now be applied to all scans of all sources in our measurement set, which includes 3C147 itself and our target field 3C129. As described above, the task <i>applycal()</i> creates a <i>CORRECTED_DATA</i> column in which the calibrated visibilities get stored. This may take a while.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">,</span> <span class="n">flagbackup</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband.antpos'</span><span class="p">,</span><span class="s1">'3C129_pband.rq'</span><span class="p">,</span>
              <span class="s1">'3C129_pband.tecim'</span><span class="p">,</span><span class="s1">'3C129_pband.K1'</span><span class="p">,</span><span class="s1">'3C129_pband.B1'</span><span class="p">,</span><span class="s1">'3C129_pband.Gs1'</span><span class="p">],</span>
         <span class="n">interp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">,</span> <span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
</pre></div>
<p>Now we split off the calibrated target field data, meaning that the visibilities of source 3C129 get copied from the <i>CORRECTED_DATA</i> column to the <i>DATA</i> column of a new measurement set. This is convenient for further processing. 
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">split</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband.ms'</span><span class="p">,</span> <span class="n">outputvis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'corrected'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">)</span>
</pre></div>
<p>It is also helpful to perform additional flagging for any residual RFI left behind in our target after all our calibration steps have been completed and we begin the imaging of our data.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'rflag'</span><span class="p">)</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'extend'</span><span class="p">)</span>
</pre></div>
<h2><span class="mw-headline" id="Statwt">Statwt</span></h2>
<p>Before we go ahead and image our target field we should try to downweight any remaining residual low level RFI. This is done using the task <i>statwt</i>. The task runs through the data and computes the rms of the data weighting down outliers. This makes a big impact for imaging of a target in the presence of low level residual RFI. For our purposes we will bin the data in a time interval larger than the integration time and run <i>statwt</i> as follows.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">statwt</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">timebin</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p>With data weights for outliers being set we will now proceed with the imaging and self-calibration of our data.
</p>
<h2><span class="mw-headline" id="Imaging">Imaging</span></h2>
<p>At this point, we're ready to make a first image of our target field. Imaging in CASA is done by means of the <i>tCLEAN</i> task. The task implements algorithms for wide field imaging, such as W-Projection (Cornwell et al. 2008 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/0807.4161">http://arxiv.org/abs/0807.4161</a>) and Multi Term Multi Frequency Synthesis ( Rau et al. 2011 <a rel="nofollow" class="external free" href="http://arxiv.org/abs/1106.2745">http://arxiv.org/abs/1106.2745</a>) both of which we will utilize to make our initial image. Even though our source of concern, the radio galaxy, lies in the centre of our field. The observations were carried out in B configuration resulting in an effective maximum resolution of approximately 5x5 arcsecs. To effectively model the source spectral index in the sky, we will utilize the MTMFS algorithm and use the W-Projection algorithm to make a wide field image (The full beam at P Band is about 3 degrees in diameter). So, going by these requirements, we can now compute the required cell and image size. Consulting the resolution guide of NRAO science page, we can see that the expected HPBW for B - Configuration, P -Band Observation is 18.5 arcsec. So, we can sample it well by using a 5 arcsec cellsize. Having done that, if we decide to make a wide field image to account for all the point sources we will set the image size parameter to 4860 pixels. To enable the wide-field algorithm, we set the <i>gridder='wproject'</i>: this invokes the W-Projection algorithm, upon which we set the number of W-Projection planes to be 128. We set the deconvolution mode as Multi Term Multi Scale Multi Frequency Synthesis using the <i>deconvolver='mtmfs'</i> parameter along with the number of Taylor terms to be considered during imaging to be 2 and choosing three different scales to model the point source and extended emission in our field well, we do this by setting <i> scales=[0,20,30]</i>. This allows for the source spectral variation to be modeled by a second order polynomial. We launch the interactive tclean process, but only for <i>spw='3~8'</i> to begin with. Note, running the first clean call will take at least ~10 min to process.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_initial_clean'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
<p><br>
The <i>tCLEAN</i> command launches an interactive session after a 100 iterations of clean and produces a wide field map with two sources at the center and a lot of bright sources far out in the field (Fig. 9a). As it is a snapshot image, the bright sources have significant side lobes and so tight clean boxing can help. This can be done in the interactive viewer interface that pops up. If we proceed with interactive clean with subsequent steps to keep boxing out the strong sources that pop up in the image, we finally see the extended emission from the target radio galaxy begin to emerge. Continue boxing and cleaning to ensure that the residuals of the boxed cleaning look noise like (~10000 clean iterations). We now stop the interactive task and look at the final image it produced (Fig. 9b).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_initial_clean.image.tt0'</span><span class="p">)</span>
</pre></div>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="image"><img alt="" src="/images/thumb/8/89/3C129_radio_gal_residual.png/200px-3C129_radio_gal_residual.png" decoding="async" width="200" height="152" class="thumbimage" srcset="/images/thumb/8/89/3C129_radio_gal_residual.png/300px-3C129_radio_gal_residual.png 1.5x, /images/thumb/8/89/3C129_radio_gal_residual.png/400px-3C129_radio_gal_residual.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_residual.png" class="internal" title="Enlarge"></a></div>Figure 9a: Resulting residuals of 3C129 after first call of interactive <i>clean</i>.</div></div></div>
</td>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:202px;"><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="image"><img alt="" src="/images/thumb/6/64/3C129_radio_gal_clean.png/200px-3C129_radio_gal_clean.png" decoding="async" width="200" height="140" class="thumbimage" srcset="/images/thumb/6/64/3C129_radio_gal_clean.png/300px-3C129_radio_gal_clean.png 1.5x, /images/thumb/6/64/3C129_radio_gal_clean.png/400px-3C129_radio_gal_clean.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_clean.png" class="internal" title="Enlarge"></a></div>Figure 9b: Resulting image of 3C129 after completing the first <i>clean</i>.</div></div></div>
</td></tr></tbody></table>
<p>The recovered structure at the center of the map should resemble what is shown in Fig. 9b. If the image looks worse then boxing of bright features in the map needs to be done more carefully. Note the image has some sources still showing strong side lobes and imaging artifacts around them. We expected this as we have carried out phase calibration only on our flux calibrator and have just transferred the solutions over to our target field. Since we used the <i>usescratch=True</i>, the MODEL_DATA column in the measurement set now contains the initial image model, which we will self calibrate against to produce a better image. Also in clean, do notice that the spw's utilized are the cleanest spectral windows that are totally RFI free.
</p>
<h2><span class="mw-headline" id="Self_Calibration">Self Calibration</span></h2>
<p>We now proceed to compute gain phase solutions for our target field using the <i>gaincal</i> task as the first step in self-calibration.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">gaincal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> 
           <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span><span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">gaintype</span><span class="o">=</span><span class="s1">'G'</span><span class="p">,</span> <span class="n">parang</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">calmode</span><span class="o">=</span><span class="s1">'p'</span><span class="p">)</span>

<span class="n">bandpass</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">caltable</span><span class="o">=</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">'3C129'</span><span class="p">,</span> <span class="n">solint</span><span class="o">=</span><span class="s1">'inf'</span><span class="p">,</span> <span class="n">refant</span><span class="o">=</span><span class="s1">'ea09'</span><span class="p">,</span> <span class="n">minsnr</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span>
                <span class="n">parang</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">],</span>
                <span class="n">interp</span><span class="o">=</span><span class="p">[</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'nearest,nearestflag'</span><span class="p">])</span>
<span class="n">applycal</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">gaintable</span><span class="o">=</span><span class="p">[</span><span class="s1">'3C129_pband_target.ScG0'</span><span class="p">,</span><span class="s1">'3C129_pband_target.ScB0'</span><span class="p">],</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">applymode</span><span class="o">=</span><span class="s1">'calflagstrict'</span><span class="p">)</span>
</pre></div>
<p>Having applied these gain and bandpass solutions, we will once again image the target measurement set which we now expect to have better gain solutions and consequently a better image. We do this by invoking the <i>tCLEAN</i> command once again.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="n">tclean</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129_pband_target.ms'</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">'3C129_clean_sc0'</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="s1">'5.0arcsec'</span><span class="p">,</span><span class="s1">'5.0arcsec'</span><span class="p">],</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4860</span><span class="p">,</span><span class="mi">4860</span><span class="p">],</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">'mtmfs'</span><span class="p">,</span>
         <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">'wproject'</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">'I'</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">'3~8'</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
         <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">savemodel</span><span class="o">=</span><span class="s1">'modelcolumn'</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">'briggs'</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">viewer</span><span class="p">(</span><span class="s1">'3C129_clean_sc0.image.tt0'</span><span class="p">)</span>
</pre></div>
<p>On boxing and cleaning, we already notice that the imaging artifacts have reduced significantly. We also see that the target source appears to contain more structure and a greater amount of flux. Further self calibration iterations involving an amplitude &amp; phase gain calibration, and target bandpass calibration, are all possible steps that can be explored. Example on the final improvements the self-calibration can provide is shown in Fig. 10.
</p>
<table>
<tbody><tr>
<td><div class="thumb tright" style=""><div class="thumbinner" style="width:402px;"><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="image"><img alt="" src="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/400px-3C129_radio_gal_cselfcal0.png" decoding="async" width="400" height="160" class="thumbimage" srcset="/images/thumb/7/75/3C129_radio_gal_cselfcal0.png/600px-3C129_radio_gal_cselfcal0.png 1.5x, /images/thumb/7/75/3C129_radio_gal_cselfcal0.png/800px-3C129_radio_gal_cselfcal0.png 2x"></a>  <div class="thumbcaption"><div class="magnify" style=""><a href="/index.php?title=File:3C129_radio_gal_cselfcal0.png" class="internal" title="Enlarge"></a></div>Figure 10: Resulting image of 3C129 after completing two rounds of self calibration is shown in the right panel, along with the pre-selfcal image on the left.</div></div></div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Appendix:_Some_P-band_data_issues_you_may_want_to_know_about">Appendix: Some P-band data issues you may want to know about</span></h2>
<p>Unfortunately, there are a few known issues with the upgraded VLA P-band observing. Most problems were discovered during the P-band commissioning period and have been fixed for newer data sets, but the archive keeps part of this history alive. Here we will go over some of those issues, and (if possible) provide ways of fixing them.
</p>
<h3><span class="mw-headline" id="Polarization_labeling">Polarization labeling</span></h3>
<p>For a long period, P-band feeds have been labeled as being circular (R and L), while they are linear (X and Y). It is still possible to generate data with incorrect polarization labeling, however for standard observations this should not be the case anymore. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem. This may seem mostly harmless, but does make a difference for polarization calibration. The following (non-standard) task will check and fix this (and another related problem of swapped polarizations):
</p><p>Download <a rel="nofollow" class="external text" href="http://casa.nrao.edu/Data/EVLA/Pband/casa_vla_lowband.tar.gz">this tarball</a> in your CASA working directory, open a shell there, and type the following commands:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>tar -xzvf casa_vla_lowband.tar.gz

buildmytasks
</pre></div>
<p>Now go back to your CASA session and type:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># In CASA</span>
<span class="nb">execfile</span><span class="p">(</span><span class="s1">'mytasks.py'</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">fixlowband</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">'3C129.ms'</span><span class="p">)</span>
</pre></div>
<p>Re-run the <i>listobs()</i> task to check if the fix was correctly applied.
</p>
<h3><span class="mw-headline" id="Swapped_polarizations">Swapped polarizations</span></h3>
<p>Throughout the whole history of the new VLA low-band system, even up to this day, there have been mistakes in the cabling of the full signal chain. This results in that some antennas have the X-polarization signal come in as Y and vice versa. The way to notice this in visibility data is that for baselines with one swapped antenna most power will be in the cross-hand correlations (XY and YX) rather than the parallel-hand correlations (XX and YY). Once antennas with this feature are manually identified, a contributed task <i>swappol()</i> is available to fix this problem (see under polarization labeling).
</p>
<h3><span class="mw-headline" id="Double_data_descriptor_entries">Double data descriptor entries</span></h3>
<p>The data description table is part of the measurement set, and provides a link between the recorded visibilities, the spectral window information and the polarization information. For some data sets, the data description table contains two entries for each P-band spectral window, one pointing towards a circular (RL) polarization definition, and one pointing towards a linear (XY) polarization definition. A contributed task <i>fixlowband()</i> is available to recognize and fix this problem.
</p>
<h3><span id="Continuous_Radio_Frequency_Interference_(RFI)"></span><span class="mw-headline" id="Continuous_Radio_Frequency_Interference_.28RFI.29">Continuous Radio Frequency Interference (RFI)</span></h3>
<p>The wide bandwidth of the low-band receiver is (unfortunately) guaranteed to contain significant amounts of RFI. There are a few RFI sources that are active all the time, and are visible in all array configurations. The default P-band observing setup of 16 x 16 MHz tries to capture as much of the continuous RFI in as few spectral windows as possible, allowing for a simple RFI mitigation strategy in which these spectral windows (spws 1,2 and 9,10, but possibly more) can be immediately flagged.
</p>
<h3><span class="mw-headline" id="Two_spectral_window_setup">Two spectral window setup</span></h3>
<p>In the early commissioning period of the VLA upgrade, the default setup for P-band observing was to use 2 spectral windows of 1024 channels each to cover 256 MHz of bandwidth from 230 MHz to 486 MHz. However, it was noticed that strong, narrow-band RFI events were causing data to be lost for the whole spectral window in which they occurred. To make the system more robust against data loss from such events, the frequency range was divided into 16 x 16 MHz, and shifted downwards by 6 MHz to capture ever-present RFI into as few spectral windows as possible. If your data has only two P-band spectral windows, please be aware that a higher data loss due to RFI is possible. There is no way to repair this.
</p>
<h3><span class="mw-headline" id="Bandpass_ripples">Bandpass ripples</span></h3>
<p>Due to signal reflections in cables and within the VLA dish, sinusoidal amplitude and phase modulations are always present in P-band data. This is most easily seen in bandpass calibration plots of amplitude versus frequency. In some cases, mostly due to cable &amp; connector problems, these modulations can be very strong (~up to 50 percent of the average amplitude level). These modulations tend not to vary over the duration of an observation and can therefore be removed through bandpass and polarization calibration. If they are found to be variable (e.g., by inspecting bandpass solutions for separate calibrator scans), the offending antenna / polarization should be flagged.
</p>
<h3><span class="mw-headline" id="High_cross-polarization">High cross-polarization</span></h3>
<p>On each antenna, the P-band feed (dipole) is visually aligned with respect to the primary focus support legs. This is normally done within 5-10 degrees accuracy. On rare occasions the dipole on one antenna has accidentally rotated to much larger angles because the locking bolt on the back of the feed was not completely tightened. The result is a high cross-polarization in the baseline visibilities that include this antenna. If this is the case, it is safest to flag this data, since there is a possibility that the dipole has rotated during the observations.
</p>
<h3><span class="mw-headline" id="Instrumental_Polarization_Calibration">Instrumental Polarization Calibration</span></h3>
<p>While polarization leakage calibration has been highlighted in the past reports, it does not directly impact imaging in Stokes I and hence has been dropped from this casaguide.
</p>
<h2><span class="mw-headline" id="Useful_links">Useful links</span></h2>
<ul><li><a rel="nofollow" class="external text" href="http://www.aoc.nrao.edu/lbr">The EVLA Low-Band Receiver System Status &amp; User Pages</a></li>
<li><a rel="nofollow" class="external text" href="https://science.nrao.edu/facilities/vla/docs/manuals/obsguide/topical-guides/vlofreq">VLA Very Low Frequency Observing</a></li></ul>
<p><br>
</p>
<div style="background-color: #CCFF99;">
<p>Last checked on CASA Version 5.7.0.
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20210607154834
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.764 seconds
Real time usage: 10.267 seconds
Preprocessor visited node count: 321/1000000
Postexpand include size: 83/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 65393/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   12.816      1 Template:Checked_5.7.0
100.00%   12.816      1 -total
-->

<!-- Saved in parser cache with key casaguides_nrao_edu-wiki_:pcache:idhash:3925-0!canonical and timestamp 20210607154824 and revision id 29799
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799">https://casaguides.nrao.edu/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799</a>"</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php?title=Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/index.php?title=Category:Pages_using_deprecated_source_tags&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages using deprecated source tags (page does not exist)">Pages using deprecated source tags</a></li></ul></div></div><!-- end content --><div class="visualClear"></div></div></div><div class="visualClear"></div></div><div id="column-one" lang="en" dir="ltr"><h2>Navigation menu</h2><div role="navigation" class="portlet" id="p-cactions" aria-labelledby="p-cactions-label"><h3 id="p-cactions-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="View the content page [alt-shift-c]" accesskey="c">Page</a></li><li id="ca-talk" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [alt-shift-t]" accesskey="t">Discussion</a></li><li id="ca-viewsource"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></li><li id="ca-history"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">History</a></li></ul></div></div><div role="navigation" class="portlet" id="p-cactions-mobile" aria-labelledby="p-cactions-mobile-label"><h3 id="p-cactions-mobile-label" lang="en" dir="ltr">Page actions</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="ca-nstab-main-mobile" class="selected"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="Page">Page</a></li><li id="ca-talk-mobile" class="new"><a href="/index.php?title=Talk:VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=edit&amp;redlink=1" rel="discussion" title=" (page does not exist)">Discussion</a></li><li id="ca-more"><a href="#p-cactions">More</a></li><li id="ca-tools"><a href="#p-tb" title="Tools">Tools</a></li><li id="ca-languages"><a href="#p-lang" title="In other languages">In other languages</a></li></ul></div></div><div role="navigation" class="portlet" id="p-personal" aria-labelledby="p-personal-label"><h3 id="p-personal-label" lang="en" dir="ltr">Personal tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=VLA+Radio+galaxy+3C+129%3A+P-band+continuum+tutorial-CASA5.7.0" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li></ul></div></div><div class="portlet" id="p-logo" role="banner"><a href="/index.php?title=Main_Page" class="mw-wiki-logo" title="Visit the main page"></a></div><div id="sidebar"><div role="navigation" class="portlet generated-sidebar" id="p-" aria-labelledby="p--label"><h3 id="p--label" lang="en" dir="ltr"></h3><div class="pBody"><ul lang="en" dir="ltr"><li id="n-Main-Page"><a href="/index.php?title=Main_Page">Main Page</a></li></ul></div></div><div role="search" class="portlet" id="p-search"><h3 id="p-search-label" lang="en" dir="ltr"><label for="searchInput">Search</label></h3><div class="pBody" id="searchBody"><form action="/index.php" id="searchform"><input type="hidden" value="Special:Search" name="title"><input type="search" name="search" placeholder="Search CASA Guides" title="Search CASA Guides [alt-shift-f]" accesskey="f" id="searchInput"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton">&nbsp; <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"></form></div></div><div role="navigation" class="portlet" id="p-tb" aria-labelledby="p-tb-label"><h3 id="p-tb-label" lang="en" dir="ltr">Tools</h3><div class="pBody"><ul lang="en" dir="ltr"><li id="t-whatlinkshere"><a href="/index.php?title=Special:WhatLinksHere/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/index.php?title=Special:RecentChangesLinked/VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0" rel="nofollow" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/index.php?title=Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="javascript:print();" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;oldid=29799" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/index.php?title=VLA_Radio_galaxy_3C_129:_P-band_continuum_tutorial-CASA5.7.0&amp;action=info" title="More information about this page">Page information</a></li></ul></div></div></div><a href="#sidebar" title="navigation" class="menu-toggle" id="sidebar-toggle"></a><a href="#p-personal" title="user tools" class="menu-toggle" id="p-personal-toggle"></a><a href="#globalWrapper" title="back to top" class="menu-toggle" id="globalWrapper-toggle"></a></div><!-- end of the left (by default at least) column --><div class="visualClear"></div><div id="footer" class="mw-footer" role="contentinfo" lang="en" dir="ltr"><div id="f-poweredbyico" class="footer-icons"><a href="https://www.mediawiki.org/"><img src="/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></div><ul id="f-list"><li id="lastmod"> This page was last edited on 10 November 2020, at 05:09.</li><li id="privacy"><a href="/index.php?title=CASA_Guides:Privacy_policy" title="CASA Guides:Privacy policy">Privacy policy</a></li><li id="about"><a href="/index.php?title=CASA_Guides:About" title="CASA Guides:About">About CASA Guides</a></li><li id="disclaimer"><a href="/index.php?title=CASA_Guides:General_disclaimer" title="CASA Guides:General disclaimer">Disclaimers</a></li></ul></div></div>
<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.764","walltime":"10.267","ppvisitednodes":{"value":321,"limit":1000000},"postexpandincludesize":{"value":83,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":65393,"limit":5000000},"timingprofile":["100.00%   12.816      1 Template:Checked_5.7.0","100.00%   12.816      1 -total"]},"cachereport":{"timestamp":"20210607154834","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":168});});</script></body></html>
